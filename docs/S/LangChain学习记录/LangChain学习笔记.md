# LangChainå¿«é€Ÿå…¥é—¨

## LangChainçš„å®šä¹‰

LangChain æ˜¯ä¸€ä¸ªå¼€æºçš„å¼€å‘æ¡†æ¶ï¼Œçš†åœ¨å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ„å»ºåŸºäºå¤§æ¨¡å‹(LLM)çš„åº”ç”¨ç¨‹åºï¼Œå®ƒé€šè¿‡æ¨¡å—åŒ–è®¾è®¡ç®€åŒ–äº†ä¸å¤§æ¨¡å‹äº¤äº’çš„å¤æ‚æ€§,æ”¯æŒçµæ´»é›†æˆå¤–éƒ¨å·¥

å…·å’Œæ•°æ®æºï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿé«˜æ•ˆå®ç°å¤æ‚çš„AIåº”ç”¨é€»è¾‘ã€‚

![image-20250525182647438](../å›¾ç‰‡/image-20250525182647438.png)

LangChainæ¡†æ¶ç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼ŒåŒ…æ‹¬ï¼š

- LangChainåº“ï¼šPythonå’ŒJavaScriptåº“ã€‚åŒ…æ‹¬æ¥å£å’Œé›†æˆå¤šç§ç»„ä»¶çš„è¿è¡ŒåŸºç¡€ï¼Œä»¥åŠç°æˆçš„é“¾å’Œä»£ç†çš„å®ç°ã€‚
- LangChainæ¨¡ç‰ˆï¼šLangChainå®˜æ–¹æä¾›ä¸€äº›AIä»»åŠ¡æ¨¡ç‰ˆã€‚
- LangServeï¼šåŸºäºFastApiå¯ä»¥å°†LangChainå®šä¹‰é“¾ï¼Œå‘å¸ƒç§°ä¸ºREST APIã€‚
- LangSmithï¼šå¼€å‘å¹³å°ï¼Œæ˜¯ä¸ªäº‘æœåŠ¡ï¼Œæ”¯æŒLangChain Debugã€ä»»åŠ¡ç›‘æ§ã€‚

LangChainåº“ï¼ˆLibrariesï¼‰ï¼š

LangChainåº“æœ¬èº«ç”±å‡ ä¸ªä¸åŒçš„åŒ…ç»„æˆï¼š

- Langchain-coreï¼šåŸºç¡€æŠ½è±¡çš„LangChainè¡¨è¾¾è¯­è¨€ã€‚
- langchain-communityï¼šç¬¬ä¸‰æ–¹ç»§æ‰¿ã€‚
  - åˆä½œä¼™ä¼´åŒ…ï¼ˆä¾‹å¦‚langchain-openaiï¼Œlangchain-anthropicç­‰ï¼‰ï¼šä¸€äº›é›†æˆå·²è¿›ä¸€æ­¥æ‹†åˆ†ä¸ºä»…ä¾èµ–äºlangchain-coreçš„è½»é‡çº§åŒ…ã€‚
- langchainï¼šæ„å»ºåº”ç”¨ç¨‹åºè®¤çŸ¥æ¶æ„çš„é“¾ã€ä»£ç†å’Œæ£€ç´¢ç­–ç•¥ã€‚

LangChainä»»åŠ¡å¤„ç†æµç¨‹

![image-20250525190108913](../å›¾ç‰‡/image-20250525190108913.png)

å¦‚ä¸Šå›¾ï¼ŒLangChainæä¾›ä¸€å¥—æç¤ºè¯æ¨¡ç‰ˆç®¡ç†å·¥å…·ï¼Œè´Ÿè´£å¤„ç†æç¤ºè¯ï¼Œç„¶åä¼ é€’ç»™å¤§æ¨¡å‹å¤„ç†ï¼Œæœ€åå¤„ç†å¤§æ¨¡å‹è¿”å›çš„ç»“æœã€‚

LangChainå¯¹å¤§æ¨¡å‹çš„å°è£…ä¸»è¦åŒ…æ‹¬LLMå’ŒChat Modelä¸¤ç§ç±»å‹ï¼š

- LLM-é—®ç­”æ¨¡å‹ï¼Œæ¨¡å‹æ¥æ”¶ä¸€ä¸ªæ–‡æœ¬è¾“å…¥ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡æœ¬ç»“æœã€‚
- Chat Model-å¯¹è¯æ¨¡å‹ï¼Œæ¥æ”¶ä¸€ç»„å¯¹è¯æ¶ˆæ¯ï¼Œç„¶åè¿”æ²ªå¯¹è¯æ¶ˆæ¯ï¼Œç±»ä¼¼èŠå¤©ä¿¡æ¯ä¸€æ ·ã€‚

## æ ¸å¿ƒæ¦‚å¿µ

1. LLMs

   LangChainå°è£…çš„åŸºç¡€æ¨¡å‹ï¼Œæ¨¡å‹æ¥æ”¶ä¸€ä¸ªæ–‡æœ¬è¾“å…¥ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ–‡æœ¬ç»“æœã€‚

2. Chat Modelsï¼ˆèŠå¤©æ¨¡å‹ï¼‰

   èŠå¤©ç±»å‹ï¼Œä¸LLMsä¸åŒï¼Œè¿™äº›æ¨¡å‹ä¸“ä¸ºå¯¹è¯åœºæ™¯è€Œè®¾è®¡ï¼Œæ¨¡å‹å¯ä»¥æ¥æ”¶ä¸€ç»„å¯¹è¯æ¶ˆæ¯ï¼Œç„¶åè¿”å›å¯¹è¯æ¶ˆæ¯ï¼Œç±»ä¼¼èŠå¤©æ¶ˆæ¯ä¸€æ ·ã€‚

3. æ¶ˆæ¯ï¼ˆMessageï¼‰

   æŒ‡çš„æ˜¯èŠå¤©æ¨¡å‹çš„æ¶ˆæ¯å†…å®¹ï¼Œæ¶ˆæ¯ç±»å‹åŒ…æ‹¬HumanMessageã€ALMessgaeã€SystemMessageã€FunctionMessageå’ŒToolMessageç­‰å¤šç§ç±»å‹çš„æ¶ˆæ¯ã€‚

4. æç¤ºï¼ˆpromptsï¼‰

   LangChainå°è£…äº†ä¸€ç»„ä¸“é—¨ç”¨äºæç¤ºè¯ï¼ˆpromptsï¼‰ç®¡ç†çš„å·¥å…·ç±»ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ ¼å¼åŒ–æç¤ºè¯å†…å®¹ã€‚

5. è¾“å‡ºè§£æå™¨ï¼ˆOutput Parersï¼‰

   å¦‚ä¸Šå›¾ä»‹ç»ï¼ŒLangChainæ¥æ”¶å¤§æ¨¡å‹è¿”å›çš„æ–‡æœ¬å†…å®¹ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä¸“é—¨çš„è¾“å‡ºè§£æå™¨å¯¹æ–‡æœ¬å†…å®¹è¿›è¡Œæ ¼å¼åŒ–ï¼Œä¾‹å¦‚è§£æJsonã€pythonå¯¹è±¡ã€‚

6. Retrievers

   ä¸ºæ–¹ä¾¿æˆ‘ä»¬å°†ç§æœ‰æ•°æ®å¯¼å…¥åˆ°å¤§æ¨¡å‹ï¼Œæé«˜æ¨¡å‹å›ç­”é—®é¢˜çš„è´¨é‡ï¼ŒLangChainå°è£…äº†æ£€ç´¢æ¡†æ¶ï¼Œæ–¹ä¾¿æˆ‘ä»¬åŠ è½½æ–‡æ¡£ã€åˆ‡å‰²ã€å­˜å‚¨å’Œæ£€ç´¢æ–‡æ¡£æ•°æ®ã€‚

7. å‘é‡å­˜å‚¨ï¼ˆVector storesï¼‰

   ä¸ºæ”¯æŒç§æœ‰æ•°æ®çš„è¯­ä¹‰ç›¸ä¼¼æœç´¢ï¼Œlangchainæ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ã€‚

8. Agents

   æ™ºèƒ½ä½“ï¼Œé€šå¸¸æŒ‡ä»¥å¤§æ¨¡å‹ä¸ºå†³ç­–å¼•æ“ï¼Œæ ¹æ®ç”¨æˆ·è¾“å…¥çš„ä»»åŠ¡ï¼Œè‡ªåŠ¨è°ƒç”¨å¤–éƒ¨ç³»ç»Ÿã€ç¡¬ä»¶è®¾å¤‡å…±åŒå®Œæˆç”¨æˆ·ä»»åŠ¡ï¼Œæ˜¯ä¸€ç§ä»¥å¤§æ¨¡å‹ä¸ºæ ¸å¿ƒçš„åº”ç”¨è®¾è®¡æ¨¡å¼ã€‚

## æ ¸å¿ƒåŠŸèƒ½

ï¼ˆ1ï¼‰æ¨¡å—é›†æˆï¼ˆModelsï¼‰

- ä½œç”¨ï¼šç»Ÿä¸€æ¥å£å¯¹æ¥å¤šç§å¤§æ¨¡å‹ï¼ˆå¦‚OpenAI GPTã€Anthropicã€Hugging Faceç­‰ï¼‰ï¼Œé¿å…å‚å•†é”å®šã€‚
- ç¤ºä¾‹ï¼šé€šè¿‡ChatOpenAIæˆ–CharAnthropicç±»å¿«é€Ÿåˆ‡æ¢ä¸åŒæ¨¡å‹ï¼Œå®ç°å¯¹è¯ã€æ–‡æœ¬ç”Ÿæˆç­‰ä»»åŠ¡ã€‚

ï¼ˆ2ï¼‰æ¨¡å—åŒ–ç»„ä»¶ï¼ˆComponentsï¼‰

- æç¤ºæ¨¡å—ï¼ˆPromptsï¼‰ï¼šæ ‡å‡†åŒ–æç¤ºè¯ç®¡ç†ï¼Œæ”¯æŒå˜é‡æ³¨å…¥å’ŒåŠ¨æ€ç”Ÿæˆï¼ˆå¦‚Few-shot Learningï¼‰
- æ–‡æ¡£åŠ è½½å™¨ï¼ˆDocument Loadersï¼‰ï¼šæ”¯æŒPDFã€ç½‘é¡µã€æ•°æ®åº“ç­‰æ•°æ®æºçš„åŠ è½½ä¸é¢„å¤„ç†ã€‚
- æ–‡æ¡£åˆ†å‰²å™¨ï¼ˆText Splittersï¼‰ï¼šå°†é•¿æ–‡æœ¬åˆ‡åˆ†ä»¥é€‚åº”æ¨¡å‹è¾“å…¥é™åˆ¶ã€‚
- å‘é‡å­˜å‚¨ï¼ˆVector Storesï¼‰ï¼šé›†æˆFAISSã€Chromaç­‰å·¥å…·ï¼Œå®ç°æ–‡æœ¬å‘é‡åŒ–ä¸ç›¸ä¼¼æ€§æ£€ç´¢ã€‚

ï¼ˆ3ï¼‰é“¾å¼è°ƒç”¨ï¼ˆChainsï¼‰

- ä½œç”¨ï¼šå°†å¤šä¸ªæ­¥éª¤ç»„åˆæˆå¯é‡å¤çš„æµç¨‹ï¼Œå¤„ç†å¤æ‚ä»»åŠ¡ã€‚
- å…¸å‹é“¾ï¼šRetrievalQAï¼ˆæ£€ç´¢+ç”Ÿæˆï¼‰ã€SequentialChainï¼ˆé¡ºåºæ‰§è¡Œå¤šä¸ªæ¨¡å‹è°ƒç”¨ï¼‰ã€‚
- åœºæ™¯ï¼šæ„å»ºé—®ç­”ç³»ç»Ÿæ—¶ï¼Œå…ˆæ£€ç´¢çŸ¥è¯†åº“ï¼Œåœ¨ç”Ÿæˆå›ç­”ã€‚

ï¼ˆ4ï¼‰è®°å¿†æœºåˆ¶ï¼ˆMemoryï¼‰

- ä½œç”¨ï¼šç»´æŠ¤å¯¹è¯å†å²æˆ–ä¸Šä¸‹æ–‡çŠ¶æ€ï¼Œæ”¯æŒå¤šè½®äº¤äº’ã€‚
- å®ç°æ–¹å¼ï¼šé€šè¿‡ConversationBufferMemoryæˆ–ConversationSummaryMemoryå­˜å‚¨å’Œç®¡ç†å†å²ä¿¡æ¯ã€‚

ï¼ˆ5ï¼‰ä»£ç†ä¸å·¥å…·ï¼ˆAgents & Toolsï¼‰

- ä»£ç†ï¼ˆAgentsï¼‰ï¼šè®©LLMåŠ¨æ€é€‰æ‹©è°ƒç”¨å·¥å…·ï¼Œå®ç°æ™ºèƒ½å†³ç­–ï¼ˆå¦‚â€œä½¿ç”¨æœç´¢APIæŸ¥è¯¢å¤©æ°”ï¼Œå†ç”¨è®¡ç®—å™¨è½¬åŒ–å•ä½â€ï¼‰ã€‚
- å·¥å…·ï¼ˆToolsï¼‰ï¼šé¢„ç½®æœç´¢å¼•æ“ã€Python REPLã€APIè°ƒç”¨ç­‰å·¥å…·ï¼Œæ”¯æŒè‡ªå®šä¹‰æ‰©å±•ã€‚

ï¼ˆ6ï¼‰æ•°æ®å¢å¼ºï¼ˆRAGï¼‰

- ä½œç”¨ï¼šå°†å¤–éƒ¨æ•°æ®ï¼ˆå¦‚æ–‡æ¡£ã€æ•°æ®åº“ï¼‰ä¸LLMç»“åˆæå‡ç”Ÿæˆå†…å®¹çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚
- æµç¨‹ï¼šåŠ è½½æ•°æ®->å‘é‡åŒ–->æ£€ç´¢ç›¸å…³ç‰‡æ®µ->æ³¨å…¥æç¤ºè¯->ç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚

## å…¸å‹åº”ç”¨åœºæ™¯

- æ™ºèƒ½é—®ç­”ç³»ç»Ÿï¼šç»“åˆRAGå¤„ç†é¢†åŸŸçŸ¥è¯†åº“ã€‚
- å¯¹è¯æœºå™¨äººï¼šæ”¯æŒå¤šè½®ä¼šè¯ã€ä¸ªæ€§åŒ–è®°å¿†ã€‚
- æ–‡æ¡£åˆ†æï¼šè‡ªåŠ¨æ€»ç»“é•¿æ–‡æœ¬ï¼Œæå–å…³é”®ä¿¡æ¯ã€‚
- è‡ªåŠ¨åŒ–æµç¨‹ï¼šé€šè¿‡ä»£ç†è°ƒç”¨å·¥å…·æ‰§è¡Œä»£ç ã€å‘é€é‚®ä»¶ç­‰æ“ä½œã€‚
- ä»£ç ç”Ÿæˆï¼šæ ¹æ®éœ€è¦æè¿°ç”Ÿæˆå¹¶éªŒè¯ä»£ç ç‰‡æ®µã€‚

## å¿«é€Ÿå…¥é—¨

### å®‰è£…LangChain

```python
pip install langchain
```

### åˆå§‹åŒ–æ¨¡å‹

åœ¨ä½¿ç”¨langchainä¹‹å‰ï¼Œéœ€è¦å¯¼å…¥LangChain X OpenAIé›†æˆåŒ…ï¼Œå¹¶è®¾ç½®APIå¯†é’¥ä½œä¸ºç¯å¢ƒå˜é‡æˆ–ç›´æ¥ä¼ é€’ç»™OpenAI LLMç±»ã€‚

é¦–å…ˆï¼Œè·å–OpenAIçš„apiå¯†é’¥ï¼Œå¯ä»¥é€šè¿‡åˆ›å»ºè´¦æˆ·å¹¶è®¿é—®é“¾æ¥è·å–ï¼Œç„¶åå°†APIå¯†é’¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼š

```
export OPENAI_API_KEY = ""
from langchain_openai import ChatOpenAI
llm = ChatOpenAI()
```

### è¾“å‡ºè½¬åŒ–

LLMçš„è¾“å‡ºé€šå¸¸æ˜¯ä¸€æ¡æ¶ˆæ¯ï¼Œä¸ºäº†æ›´æ–¹ä¾¿å¤„ç†ç»“æœï¼Œå¯ä»¥å°†æ¶ˆæ¯è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚

```python
from langchain_core.output_parsers import StrOutputParser
output_parser = StrOutputParser()
```

### ç›¸å…³ä»£ç 

```python
from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI

llm = ChatOpenAI(
    temperature=0,
    model="gpt-4o",
    base_url="********",
    api_key="********"
)

# å®šä¹‰ä¸€ä¸ªè¾“å‡ºè§£æå™¨
output_parser = StrOutputParser()

# å®šä¹‰æç¤ºè¯
prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªæ•°æ®åº“ä¸“å®¶"),
    ("user", "{input}")
])

# æ„å»ºé“¾
chain = prompt | llm | output_parser

result = chain.invoke({"input": "å¸®æˆ‘å†™ä¸€ç¯‡æŠ€æœ¯æ–‡æ¡£ï¼Œ100å­—å·¦å³"})

print(result)
```

```
æ ‡é¢˜: æ•°æ®åº“ä¼˜åŒ–æŠ€æœ¯æ¦‚è¿°

ç®€ä»‹: æœ¬æ–‡æ¡£æ—¨åœ¨ä»‹ç»æ•°æ®åº“ä¼˜åŒ–çš„åŸºæœ¬æŠ€æœ¯ï¼Œä»¥æé«˜æ•°æ®åº“æ€§èƒ½å’Œæ•ˆç‡ã€‚

å†…å®¹:
1. ç´¢å¼•ä¼˜åŒ–: é€šè¿‡åˆ›å»ºé€‚å½“çš„ç´¢å¼•æ¥åŠ é€ŸæŸ¥è¯¢æ“ä½œï¼Œå‡å°‘æ•°æ®æ£€ç´¢æ—¶é—´ã€‚
2. æŸ¥è¯¢ä¼˜åŒ–: ä½¿ç”¨EXPLAINåˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ï¼Œé‡æ„å¤æ‚æŸ¥è¯¢ä»¥å‡å°‘èµ„æºæ¶ˆè€—ã€‚
3. ç¼“å­˜æœºåˆ¶: å®æ–½ç¼“å­˜ç­–ç•¥ä»¥å‡å°‘æ•°æ®åº“è´Ÿè½½ï¼Œæé«˜æ•°æ®è®¿é—®é€Ÿåº¦ã€‚
4. åˆ†åŒºæŠ€æœ¯: å°†å¤§å‹è¡¨åˆ†åŒºä»¥æé«˜æŸ¥è¯¢æ€§èƒ½å’Œç®¡ç†æ•ˆç‡ã€‚
5. è¿æ¥æ± ç®¡ç†: ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± ä»¥å‡å°‘è¿æ¥å¼€é”€ï¼Œæé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚

ç»“è®º: é€šè¿‡å®æ–½ä¸Šè¿°ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ•°æ®åº“çš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚
```

# LangChainæç¤ºè¯å·¥ç¨‹åº”ç”¨å®è·µ

## Prompt templatesï¼ˆæç¤ºè¯æ¨¡ç‰ˆï¼‰

è¯­è¨€æ¨¡å‹ä»¥æ–‡æœ¬ä½œä¸ºè¾“å…¥ - è¿™ä¸ªæ–‡æœ¬é€šå¸¸è¢«ç§°ä¸ºæç¤ºè¯ï¼ˆpromptï¼‰ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæç¤ºè¯é€šå¸¸ä¸èƒ½ç›´æ¥ç¡¬ç¼–ç ï¼Œä¸åˆ©äºæç¤ºè¯ç®¡ç†ï¼Œè€Œæ˜¯é€šè¿‡æç¤ºè¯æ¨¡ç‰ˆ

è¿›è¡Œç»´æŠ¤ï¼Œç±»ä¼¼å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°çš„çŸ­ä¿¡æ¨¡ç‰ˆã€é‚®ä»¶æ¨¡ç‰ˆç­‰ç­‰ã€‚

![image-20250525190108913](../å›¾ç‰‡/image-20250525190108913.png)

## ä»€ä¹ˆæ˜¯æç¤ºè¯æ¨¡ç‰ˆï¼Ÿ

æç¤ºè¯æ¨¡ç‰ˆæœ¬è´¨ä¸Šè·Ÿå¹³æ—¶å¤§å®¶ä½¿ç”¨çš„é‚®ä»¶ã€çŸ­ä¿¡æ¨¡ç‰ˆæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ¨¡ç‰ˆï¼Œæ¨¡ç‰ˆå¯ä»¥åŒ…å«ä¸€ç»„æ¨¡ç‰ˆå‚æ•°ï¼Œé€šè¿‡æ¨¡ç‰ˆå‚æ•°å¯ä»¥æ›¿æ¢æ¨¡ç‰ˆå¯¹åº”çš„å‚æ•°ã€‚

ä¸€ä¸ªæç¤ºè¯æ¨¡ç‰ˆå¯ä»¥åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

- å‘ç»™å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æŒ‡ä»¤ã€‚
- ä¸€ç»„é—®ç­”ç¤ºä¾‹ï¼Œä»¥æé†’AIä»¥ä»€ä¹ˆæ ¼å¼è¿”å›è¯·æ±‚ã€‚
- å‘ç»™è¯­è¨€æ¨¡å‹çš„é—®é¢˜ã€‚

## åˆ›å»ºä¸€ä¸ªæç¤ºè¯æ¨¡ç‰ˆï¼ˆprompt templateï¼‰

å¯ä»¥ä½¿ç”¨PromptTemplateç±»åˆ›å»ºç®€å•çš„æç¤ºè¯ã€‚æç¤ºè¯æ¨¡ç‰ˆå¯ä»¥å†…åµŒä»»æ„æ•°é‡çš„æ¨¡ç‰ˆå‚æ•°ï¼Œç„¶åé€šè¿‡å‚æ•°å€¼æ ¼å¼åŒ–æ¨¡ç‰ˆå†…å®¹ã€‚

```python
from langchain_core.prompts import PromptTemplate

prompt_template = PromptTemplate.from_template(
    "ç»™æˆ‘è®²ä¸€ä¸ªå…³äº{content}çš„{adjective}ç¬‘è¯"
)

result = prompt_template.format(adjective="å®Œæ•´", content="çŒ«")

print(result)
```

```
ç»™æˆ‘è®²ä¸€ä¸ªå…³äºçŒ«çš„å®Œæ•´ç¬‘è¯
```

## èŠå¤©æ¶ˆæ¯æç¤ºè¯æ¨¡ç‰ˆ(chat prompt template)

èŠå¤©æ¨¡å‹ï¼ˆChat Modelï¼‰ä»¥èŠå¤©æ¶ˆæ¯åˆ—è¡¨ä½œä¸ºè¾“å…¥ï¼Œè¿™ä¸ªèŠå¤©æ¶ˆæ¯åˆ—è¡¨çš„æ¶ˆæ¯å†…å®¹ä¹Ÿå¯ä»¥é€šè¿‡æç¤ºè¯æ¨¡ç‰ˆè¿›è¡Œç®¡ç†ã€‚è¿™äº›èŠå¤©æ¶ˆæ¯ä¸åŸå§‹å­—ç¬¦ä¸²ä¸åŒï¼Œå› ä¸ºæ¯ä¸ª

æ¶ˆæ¯éƒ½ä¸â€œè§’è‰²â€ç›¸å…³è”ã€‚

ä¾‹å¦‚ï¼Œåœ¨OpenAIçš„Chat Completion APIä¸­ï¼ŒOpenAiçš„èŠå¤©æ¨¡å‹ï¼Œç»™ä¸åŒçš„èŠå¤©æ¶ˆæ¯å®šä¹‰äº†ä¸‰ç§è§’è‰²ç±»å‹åˆ†åˆ«æ˜¯åŠ©æ‰‹(assistant)ã€äººç±» (human)ã€ç³»ç»Ÿ (system)

è§’è‰²ï¼š

- åŠ©æ‰‹(assistant)æ¶ˆæ¯æŒ‡çš„æ˜¯å½“å‰æ¶ˆæ¯æ˜¯AIå›ç­”çš„å†…å®¹ã€‚
- äººç±» (human)æ¶ˆæ¯æŒ‡çš„æ˜¯ä½ å‘ç»™AIçš„å†…å®¹ã€‚
- ç³»ç»Ÿ (system)æ¶ˆæ¯é€šå¸¸æ˜¯ç”¨æ¥ç»™AIèº«ä»½è¿›è¡Œæè¿°ã€‚

```python
from langchain_core.prompts import ChatPromptTemplate
chat_prompt = ChatPromptTemplate.from_messages(
    [
        ("system", "ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œä½ çš„åå­—æ˜¯{name}"),
        ("human", "ä½ å¥½"),
        ("assistant", "æˆ‘å¾ˆå¥½ï¼Œè°¢è°¢ï¼"),
        ("human", "{user_input}")
    ]
)

messages = chat_prompt.format_messages(name="zs", user_input="ä½ çš„åå­—æ˜¯ä»€ä¹ˆ")

print(messages)
```

```
[SystemMessage(content='ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œä½ çš„åå­—æ˜¯zs', additional_kwargs={}, response_metadata={}), HumanMessage(content='ä½ å¥½', additional_kwargs={}, response_metadata={}), AIMessage(content='æˆ‘å¾ˆå¥½ï¼Œè°¢è°¢ï¼', additional_kwargs={}, response_metadata={}), HumanMessage(content='ä½ çš„åå­—æ˜¯ä»€ä¹ˆ', additional_kwargs={}, response_metadata={})]
```

å¦ä¸€ç§æ¶ˆæ¯æ ¼å¼ä¾‹å­ï¼š 

```python
from langchain_core.messages import SystemMessage
from langchain_core.prompts import ChatPromptTemplate, HumanMessagePromptTemplate

chat_template = ChatPromptTemplate.from_messages(
    [
        SystemMessage(
            content=(
                "ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼Œå¯ä»¥å…¥è‰²å†…å®¹ï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´ç®€å•æ˜“è¯»ã€‚"
            )
        ),
        HumanMessagePromptTemplate.from_template("{text}")
    ]
)

messages = chat_template.format_messages(text="æˆ‘æœ€è¿‘ä¸ºäº†å­¦ä¹ å¤´ç–¼")

print(messages)
```

```
[SystemMessage(content='ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼Œå¯ä»¥å…¥è‰²å†…å®¹ï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´ç®€å•æ˜“è¯»ã€‚', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘æœ€è¿‘ä¸ºäº†å­¦ä¹ å¤´ç–¼', additional_kwargs={}, response_metadata={})]
```

é€šå¸¸æˆ‘ä»¬ä¸ä¼šç›´æ¥ä½¿ç”¨format_messageså‡½æ•°æ ¼å¼åŒ–æç¤ºè¯æ¨¡ç‰ˆå†…å®¹ï¼Œè€Œæ˜¯äº¤ç»™LangChainæ¡†æ¶è‡ªåŠ¨å¤„ç†ã€‚

## MessagesPlaceholder

è¿™ä¸ªæç¤ºæ¨¡ç‰ˆè´Ÿè´£åœ¨ç‰¹å®šä½ç½®æ·»åŠ æ¶ˆæ¯åˆ—è¡¨ï¼Œåœ¨ä¸Šé¢ChatPromptTemplateä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•æ ¼å¼åŒ–ä¸¤æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ç”¨æˆ·ä¼ 

å…¥ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†å…¶æ’å…¥åˆ°ç‰¹å®šçš„ä½ç½®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¿™å°±æ˜¯ä½¿ç”¨MessagesPlaceholderçš„æ–¹å¼ã€‚

```python
from langchain_core.messages import HumanMessage
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder

prompt_template = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹"),
    MessagesPlaceholder("msgs")
])

result = prompt_template.invoke({
    "msgs": [HumanMessage(content="ä½ å¥½ï¼")]
})

print(result)
```

```
messages=[SystemMessage(content='ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹', additional_kwargs={}, response_metadata={}), HumanMessage(content='ä½ å¥½ï¼', additional_kwargs={}, response_metadata={})]
```

è¿™å°†ç”Ÿæˆä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ˜¯ç³»ç»Ÿæ¶ˆæ¯ï¼Œç¬¬äºŒæ¡æ˜¯æˆ‘ä»¬ä¼ å…¥çš„HumanMessageã€‚å¦‚æœæˆ‘ä»¬ä¼ å…¥äº†5æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ€»å…±ä¼šç”Ÿæˆ6æ¡æ¶ˆæ¯(ç³»ç»Ÿæ¶ˆæ¯åŠ ä¸Šä¼ å…¥çš„5æ¡æ¯)ã€‚

è¿™å¯¹äºå°†ä¸€ç³»åˆ—æ¶ˆæ¯æ’å…¥åˆ°ç‰¹å®šä½ç½®éå¸¸æœ‰ç”¨ã€‚

å¦ä¸€ç§å®ç°ç›¸åŒæ•ˆæœï¼Œä½¿ç”¨placeholderï¼š

```python
prompt_template = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹"),
    MessagesPlaceholder("msgs"),
    ("placeholder", "{msgs}")
])

result = prompt_template.invoke({
    "msgs": [HumanMessage(content="ä½ å¥½ï¼")]
})

print(result)
```

```python
messages=[SystemMessage(content='ä½ æ˜¯ä¸€ä¸ªäººå·¥æ™ºèƒ½åŠ©æ‰‹', additional_kwargs={}, response_metadata={}), HumanMessage(content='ä½ å¥½ï¼', additional_kwargs={}, response_metadata={}), HumanMessage(content='ä½ å¥½ï¼', additional_kwargs={}, response_metadata={})]
```

## æç¤ºè¯è¿½åŠ ç¤ºä¾‹ï¼ˆFew-shot prompt templatesï¼‰

æç¤ºè¯ä¸­åŒ…å«äº¤äº’æ ·æœ¬çš„ä½œç”¨æ˜¯ä¸ºäº†å¸®åŠ©æ¨¡å‹æ›´å¥½çš„ç†è§£ç”¨æˆ·çš„æ„å›¾ï¼Œä»è€Œæ›´å¥½çš„å›ç­”é—®é¢˜æˆ–æ‰§è¡Œä»»åŠ¡ã€‚å°æ ·æœ¬æç¤ºæ¨¡ç‰ˆæ˜¯æŒ‡ä½¿ç”¨ä¸€ç»„å°‘é‡çš„ç¤ºä¾‹æ¥æŒ‡å¯¼æ¨¡å‹å¤„ç†

æ–°çš„è¾“å…¥ã€‚è¿™äº›å®ä¾‹å¯ä»¥ç”¨æ¥è®­ç»ƒæ¨¡å‹ï¼Œä»¥ä¾¿æ¨¡å‹å¯ä»¥æ›´å¥½çš„ç†è§£å’Œå›ç­”ç±»ä¼¼çš„é—®é¢˜ã€‚

## ä½¿ç”¨ç¤ºä¾‹é›†

### åˆ›å»ºç¤ºä¾‹é›†

å®šä¹‰ä¸€ä¸ªexamplesç¤ºä¾‹æ•°ç»„ï¼ŒåŒ…å«ä¸€ç»„é—®ç­”æ ·ä¾‹ã€‚

```python
from langchain.prompts.few_shot import FewShotPromptTemplate
from langchain.prompts.prompt import PromptTemplate


examples = [
  {
    "question": "è°çš„å¯¿å‘½æ›´é•¿ï¼Œç©†ç½•é»˜å¾·Â·é˜¿é‡Œè¿˜æ˜¯è‰¾ä¼¦Â·å›¾çµï¼Ÿ",
    "answer": """
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶74å²ã€‚
        è·Ÿè¿›ï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶41å²ã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œ
    """
  },
  {
    "question": "craigslistçš„åˆ›å§‹äººæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ",
    "answer": """
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šcraigslistçš„åˆ›å§‹äººæ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šcraigslistç”±Craig Newmarkåˆ›ç«‹ã€‚
        è·Ÿè¿›ï¼šCraig Newmarkæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šCraig Newmarkäº1952å¹´12æœˆ6æ—¥å‡ºç”Ÿã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼š1952å¹´12æœˆ6æ—¥
    """
  },
  {
    "question": "ä¹”æ²»Â·åç››é¡¿çš„ç¥–çˆ¶æ¯ä¸­çš„æ¯äº²æ˜¯è°ï¼Ÿ",
    "answer": """
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šä¹”æ²»Â·åç››é¡¿çš„æ¯äº²æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šä¹”æ²»Â·åç››é¡¿çš„æ¯äº²æ˜¯Mary Ball Washingtonã€‚
        è·Ÿè¿›ï¼šMary Ball Washingtonçš„çˆ¶äº²æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šMary Ball Washingtonçš„çˆ¶äº²æ˜¯Joseph Ballã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šJoseph Ball
    """
  },
  {
    "question": "ã€Šå¤§ç™½é²¨ã€‹å’Œã€Šçš‡å®¶èµŒåœºã€‹çš„å¯¼æ¼”éƒ½æ¥è‡ªåŒä¸€ä¸ªå›½å®¶å—ï¼Ÿ",
    "answer": """
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šã€Šå¤§ç™½é²¨ã€‹çš„å¯¼æ¼”æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šã€Šå¤§ç™½é²¨ã€‹çš„å¯¼æ¼”æ˜¯Steven Spielbergã€‚
        è·Ÿè¿›ï¼šSteven Spielbergæ¥è‡ªå“ªé‡Œï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šç¾å›½ã€‚
        è·Ÿè¿›ï¼šã€Šçš‡å®¶èµŒåœºã€‹çš„å¯¼æ¼”æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šã€Šçš‡å®¶èµŒåœºã€‹çš„å¯¼æ¼”æ˜¯Martin Campbellã€‚
        è·Ÿè¿›ï¼šMartin Campbellæ¥è‡ªå“ªé‡Œï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šæ–°è¥¿å…°ã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šä¸æ˜¯
    """
  }
]
```

### åˆ›å»ºå°æ ·æœ¬ç¤ºä¾‹çš„æ ¼å¼åŒ–ç¨‹åº

é€šè¿‡`PromptTemplate`å¯¹è±¡ï¼Œç®€å•çš„åœ¨æç¤ºè¯æ¨¡æ¿ä¸­æ’å…¥æ ·ä¾‹ã€‚

```python
from langchain_core.prompts import PromptTemplate
example_prompt = PromptTemplate(input_variables=["question", "answer"], template="é—®é¢˜: {question}{answer}")

print(example_prompt.format(**examples[0]))
```

```python
é—®é¢˜: è°çš„å¯¿å‘½æ›´é•¿ï¼Œç©†ç½•é»˜å¾·Â·é˜¿é‡Œè¿˜æ˜¯è‰¾ä¼¦Â·å›¾çµï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶74å²ã€‚
        è·Ÿè¿›ï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶41å²ã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œ
```

### å°†ç¤ºä¾‹å’Œæ ¼å¼åŒ–ç¨‹åºæä¾›ç»™`FewShotPromptTemplate`

é€šè¿‡`FewShotPromptTemplate`å¯¹è±¡ï¼Œæ‰¹é‡æ’å…¥ç¤ºä¾‹å†…å®¹ã€‚

```python
# æ¥æ”¶examplesç¤ºä¾‹æ•°ç»„å‚æ•°ï¼Œé€šè¿‡example_promptæç¤ºè¯æ¨¡æ¿æ‰¹é‡æ¸²æŸ“ç¤ºä¾‹å†…å®¹
# suffixå’Œinput_variableså‚æ•°ç”¨äºåœ¨æç¤ºè¯æ¨¡æ¿æœ€åè¿½åŠ å†…å®¹ï¼Œ input_variablesç”¨äºå®šä¹‰suffixä¸­åŒ…å«çš„æ¨¡æ¿å‚æ•°
prompt = FewShotPromptTemplate(
    examples=examples,
    example_prompt=example_prompt,
    suffix="é—®é¢˜ï¼š{input}",
    input_variables=["input"]
)

print(prompt.format(input="ä¹”æ²»Â·åç››é¡¿çš„çˆ¶äº²æ˜¯è°ï¼Ÿ"))
```

```python
é—®é¢˜: è°çš„å¯¿å‘½æ›´é•¿ï¼Œç©†ç½•é»˜å¾·Â·é˜¿é‡Œè¿˜æ˜¯è‰¾ä¼¦Â·å›¾çµï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶74å²ã€‚
        è·Ÿè¿›ï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶41å²ã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œ
    
é—®é¢˜: è°çš„å¯¿å‘½æ›´é•¿ï¼Œç©†ç½•é»˜å¾·Â·é˜¿é‡Œè¿˜æ˜¯è‰¾ä¼¦Â·å›¾çµï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œå»ä¸–æ—¶74å²ã€‚
        è·Ÿè¿›ï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶å¤šå¤§ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šè‰¾ä¼¦Â·å›¾çµå»ä¸–æ—¶41å²ã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šç©†ç½•é»˜å¾·Â·é˜¿é‡Œ
    

é—®é¢˜: craigslistçš„åˆ›å§‹äººæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šcraigslistçš„åˆ›å§‹äººæ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šcraigslistç”±Craig Newmarkåˆ›ç«‹ã€‚
        è·Ÿè¿›ï¼šCraig Newmarkæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šCraig Newmarkäº1952å¹´12æœˆ6æ—¥å‡ºç”Ÿã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼š1952å¹´12æœˆ6æ—¥
    

é—®é¢˜: ä¹”æ²»Â·åç››é¡¿çš„ç¥–çˆ¶æ¯ä¸­çš„æ¯äº²æ˜¯è°ï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šä¹”æ²»Â·åç››é¡¿çš„æ¯äº²æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šä¹”æ²»Â·åç››é¡¿çš„æ¯äº²æ˜¯Mary Ball Washingtonã€‚
        è·Ÿè¿›ï¼šMary Ball Washingtonçš„çˆ¶äº²æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šMary Ball Washingtonçš„çˆ¶äº²æ˜¯Joseph Ballã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šJoseph Ball
    

é—®é¢˜: ã€Šå¤§ç™½é²¨ã€‹å’Œã€Šçš‡å®¶èµŒåœºã€‹çš„å¯¼æ¼”éƒ½æ¥è‡ªåŒä¸€ä¸ªå›½å®¶å—ï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šã€Šå¤§ç™½é²¨ã€‹çš„å¯¼æ¼”æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šã€Šå¤§ç™½é²¨ã€‹çš„å¯¼æ¼”æ˜¯Steven Spielbergã€‚
        è·Ÿè¿›ï¼šSteven Spielbergæ¥è‡ªå“ªé‡Œï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šç¾å›½ã€‚
        è·Ÿè¿›ï¼šã€Šçš‡å®¶èµŒåœºã€‹çš„å¯¼æ¼”æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šã€Šçš‡å®¶èµŒåœºã€‹çš„å¯¼æ¼”æ˜¯Martin Campbellã€‚
        è·Ÿè¿›ï¼šMartin Campbellæ¥è‡ªå“ªé‡Œï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šæ–°è¥¿å…°ã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šä¸æ˜¯
    
# æ–°å¢çš„é—®é¢˜
é—®é¢˜ï¼šä¹”æ²»Â·åç››é¡¿çš„çˆ¶äº²æ˜¯è°ï¼Ÿ
```

## ä½¿ç”¨ç¤ºä¾‹é€‰æ‹©å™¨

### å°†ç¤ºä¾‹æä¾›ç»™ExampleSelector

é‡ç”¨å‰ä¸€éƒ¨åˆ†ä¸­çš„ç¤ºä¾‹é›†å’Œæç¤ºè¯æ¨¡ç‰ˆã€‚ä½†æ˜¯ï¼Œä¸ä¼šå°†ç¤ºä¾‹ç›´æ¥æä¾›ç»™æç¤ºè¯è¿½åŠ ç¤ºä¾‹å¯¹è±¡ï¼ŒæŠŠå…¨éƒ¨ç¤ºä¾‹æ’å…¥åˆ°æç¤ºè¯ä¸­ï¼Œè€Œæ˜¯å°†å®ƒä»¬æä¾›ç»™ä¸€ä¸ª

ExampleSelectorå¯¹è±¡ï¼Œæ’å…¥éƒ¨åˆ†ç¤ºä¾‹ã€‚

ä½¿ç”¨SemanticSimilarityExampleSelectorç±»ã€‚æ ¹æ®ä¸è¾“å…¥çš„ç›¸ä¼¼æ€§é€‰æ‹©å°æ ·æœ¬ç¤ºä¾‹ã€‚å®ƒä½¿ç”¨åµŒå…¥æ¨¡å‹è®¡ç®—è¾“å…¥å’Œå°æ ·æœ¬ç¤ºä¾‹ä¹‹é—´çš„ç›¸å…³æ€§ï¼Œç„¶åä½¿ç”¨å‘é‡æ•°æ®åº“

æ‰§è¡Œç›¸ä¼¼æœç´¢ï¼Œè·å–è·Ÿè¾“å…¥ç›¸ä¼¼çš„ç¤ºä¾‹ã€‚

- è¿™é‡Œæ¶‰åŠå‘é‡è®¡ç®—ã€å‘é‡æ•°æ®åº“ï¼Œåœ¨AIé¢†åŸŸè¿™ä¸¤ä¸ªä¸»è¦ç”¨äºæ•°æ®ç›¸ä¼¼åº¦æœç´¢ã€‚

```python
example_selector = SemanticSimilarityExampleSelector.from_examples(
    examples,
    # ç”ŸæˆåµŒå…¥ç±»ï¼Œç”¨äºè¡¡é‡è¯­ä¹‰ç›¸ä¼¼åº¦
    OpenAIEmbeddings(
        base_url="********",  # æ ¹æ®ä½ çš„å®é™…APIè·¯å¾„ç¡®è®¤æ˜¯å¦åŠ  /v1
        api_key="********"  # å³ä½¿æ˜¯å‡çš„ï¼Œä¹Ÿè¦ä¼ 
    ),
    # å­˜å‚¨åµŒå…¥å’Œæ‰§è¡Œç›¸ä¼¼æ€§æœç´¢çš„VectorStoreç±»
    Chroma,
    # ç”Ÿæˆçš„ç¤ºä¾‹æ•°
    k=1
)

question = "craigslistçš„åˆ›å§‹äººæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ"
select_examples = example_selector.select_examples({"question": question})
print(f"æœ€ä¼¼æ¡ˆä¾‹: {question}")
for example in select_examples:
    print("\n")
    for k, v in example.items():
        print(f"{k}: {v}")
```

```
æœ€ä¼¼æ¡ˆä¾‹: craigslistçš„åˆ›å§‹äººæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ
question: craigslistçš„åˆ›å§‹äººæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ
answer: 
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šcraigslistçš„åˆ›å§‹äººæ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šcraigslistç”±Craig Newmarkåˆ›ç«‹ã€‚
        è·Ÿè¿›ï¼šCraig Newmarkæ˜¯ä»€ä¹ˆæ—¶å€™å‡ºç”Ÿçš„ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šCraig Newmarkäº1952å¹´12æœˆ6æ—¥å‡ºç”Ÿã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼š1952å¹´12æœˆ6æ—¥
```

### å°†ç¤ºä¾‹é€‰æ‹©å™¨æä¾›ç»™`FewShotPromptTemplate`

```python
# FewShotPromptTemplate
prompt = FewShotPromptTemplate(
    example_selector=example_selector,
    example_prompt=example_prompt,
    suffix="é—®é¢˜ï¼š{input}",
    input_variables=["input"],
)

print(prompt.format(input="ä¹”æ²»Â·åç››é¡¿çš„çˆ¶äº²æ˜¯è°ï¼Ÿ"))
```

```
/Users/xt03337/Documents/çŸ¥è¯†åº“/Learning-Alliance/venv/bin/python /Users/xt03337/Documents/çŸ¥è¯†åº“/Learning-Alliance/docs/S/LangChainå­¦ä¹ è®°å½•/demo/LangChainæç¤ºè¯ç¤ºä¾‹.py 
é—®é¢˜: ä¹”æ²»Â·åç››é¡¿çš„ç¥–çˆ¶æ¯ä¸­çš„æ¯äº²æ˜¯è°ï¼Ÿ
        è¿™é‡Œéœ€è¦è·Ÿè¿›é—®é¢˜å—ï¼šæ˜¯çš„ã€‚
        è·Ÿè¿›ï¼šä¹”æ²»Â·åç››é¡¿çš„æ¯äº²æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šä¹”æ²»Â·åç››é¡¿çš„æ¯äº²æ˜¯Mary Ball Washingtonã€‚
        è·Ÿè¿›ï¼šMary Ball Washingtonçš„çˆ¶äº²æ˜¯è°ï¼Ÿ
        ä¸­é—´ç­”æ¡ˆï¼šMary Ball Washingtonçš„çˆ¶äº²æ˜¯Joseph Ballã€‚
        æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆæ˜¯ï¼šJoseph Ball
    

é—®é¢˜ï¼šä¹”æ²»Â·åç››é¡¿çš„çˆ¶äº²æ˜¯è°ï¼Ÿ
```

# LangChainå·¥ä½œæµç¼–æ’

## LCELä»‹ç»

LCEL(LangChain Expression Language)æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥ä½œæµç¼–æ’å·¥å…·ï¼Œå¯ä»¥ä»åŸºæœ¬ç»„ä»¶æ„å»ºå¤æ‚ä»»åŠ¡é“¾æ¡ï¼ˆchainï¼‰ï¼Œå¹¶æ”¯æŒè¯¸å¦‚æµå¼å¤„ç†ã€å¹¶è¡Œå¤„ç†å’Œæ—¥å¿—è®°

å½•ç­‰å¼€ç®±å³ç”¨çš„åŠŸèƒ½ã€‚

LCELä»ç¬¬ä¸€å¤©å°±è¢«è®¾è®¡ä¸ºæ”¯æŒå°†åŸå‹æŠ•å…¥ç”Ÿäº§ï¼Œæ— éœ€æ›´æ”¹ä»£ç ï¼Œä»æœ€ç®€å•çš„â€œæç¤º+LLMâ€é“¾åˆ°æœ€å¤æ‚çš„é“¾ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨LCELçš„å‡ å¤§äº®ç‚¹ï¼š

- æµå¼æ”¯æŒï¼šå½“ä½¿ç”¨LCELæ„å»ºé“¾æ—¶ï¼Œè·å¾—ä»è¾“å…¥åˆ°è¾“å‡ºçš„ç¬¬ä¸€å—å†…å®¹å‡ºç°æ‰€ç»è¿‡çš„æ—¶é—´ã€‚å¯¹äºæŸäº›é“¾ï¼Œè¿™æ„å‘³ç€ç›´æ¥ä»LLMæµå¼ä¼ è¾“æ ‡è®°åˆ°æµå¼è¾“å‡ºè§£æå™¨ï¼Œå°†ä»¥ä¸LLMæä¾›ç¨‹åºè¾“å‡ºåŸå§‹æ ‡è®°çš„é€Ÿç‡ç›¸åŒçš„é€Ÿåº¦è·å–è§£æçš„å¢é‡è¾“å‡ºå—ã€‚
- å¼‚æ­¥æ”¯æŒï¼šä½¿ç”¨LCELæ„å»ºçš„ä»»ä½•é“¾éƒ½å¯ä»¥ä½¿ç”¨åŒæ­¥APIä»¥åŠå¼‚æ­¥APIè¿›è¡Œè°ƒç”¨ã€‚è¿™ä½¿å¾—å¯ä»¥åœ¨åŸå‹å’Œç”Ÿäº§ä¸­ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œå…·æœ‰å‡ºè‰²çš„æ€§èƒ½ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨åŒä¸€æœåŠ¡å™¨ä¸­å¤„ç†è®¸å¤šå¹¶å‘è¯·æ±‚ã€‚
- ä¼˜åŒ–å¹¶è¡Œæ‰§è¡Œï¼šæ¯å½“LCELé“¾å…·æœ‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æ­¥éª¤æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œæ— è®ºæ˜¯åœ¨åŒæ­¥æ¥å£è¿˜æ˜¯å¼‚æ­¥æ¥å£ä¸­ï¼Œä»¥è·å–å¯èƒ½çš„æœ€å°å»¶è¿Ÿã€‚
- é‡è¯•å’Œå›é€€ï¼šä¸ºLCELé“¾çš„ä»»ä½•éƒ¨åˆ†é…ç½®é‡è¯•å’Œå›é€€ã€‚è¿™ä½¿é“¾åœ¨è§„æ¨¡ä¸Šæ›´å¯é çš„å¥½åŠæ³•ã€‚ç›®å‰æ­£åœ¨åŠªåŠ›ä¸ºé‡è¯•/å›é€€æ·»åŠ æµå¼æ”¯æŒï¼Œè¿™æ ·å°±å¯ä»¥è·å¾—é¢å¤–çš„å¯é æ€§è€Œæ— éœ€ä»»ä½•å»¶è¿Ÿæˆæœ¬ã€‚
- è®¿é—®ä¸­é—´ç»“æœï¼šå¯¹äºæ›´å¤æ‚çš„é“¾ï¼Œè®¿é—®ä¸­é—´æ­¥éª¤çš„ç»“æœé€šå¸¸éå¸¸æœ‰ç”¨ï¼Œå³ä½¿åœ¨ç”Ÿæˆæœ€ç»ˆè¾“å‡ºä¹‹å‰ã€‚è¿™å¯ä»¥ç”¨äºè®©æœ€ç»ˆç”¨æˆ·çŸ¥é“æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œç”šè‡³åªæ˜¯ç”¨äºè°ƒç”¨é“¾ã€‚å¯ä»¥æµå¼ä¼ è¾“ä¸­é—´ç»“æœï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªLangServeæœåŠ¡å™¨ä¸Šéƒ½å¯ä»¥ä½¿ç”¨ã€‚
- è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ï¼šè¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ä¸ºæ¯ä¸ªLCELé“¾æä¾›äº†ä»é“¾çš„ç»“æ„æ¨å‡ºçš„Pydanticå’ŒJSONSchemaæ¨¡å¼ã€‚è¿™å¯ç”¨äºéªŒè¯è¾“å…¥è¾“å‡ºï¼Œå¹¶ä¸”æ˜¯LangServeçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚

## Ruable interface

ä¸ºäº†å°½å¯èƒ½ç®€åŒ–åˆ›å»ºè‡ªå®šä¹‰é“¾çš„è¿‡ç¨‹ï¼Œå®ç°äº†ä¸€ä¸ªRunableçš„åè®®ï¼Œè®¸å¤šLangChainçš„ç»„ä»¶éƒ½å®ç°äº†Runableåè®®ï¼ŒåŒ…æ‹¬èŠå¤©æ¨¡å‹ã€LLMsã€è¾“å‡ºè§£æå™¨ã€æ£€ç´¢å™¨ã€

æç¤ºæ¨¡ç‰ˆç­‰ç­‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›æœ‰ç”¨çš„åŸºæœ¬ç»„ä»¶å¯ç”¨äºå¤„ç†å¯è¿è¡Œå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†æ¥å£ï¼Œå¯ä»¥è½»æ¾å®šä¹‰è‡ªå®šä¹‰é“¾ï¼Œå¹¶ä»¥æ ‡å‡†æ–¹å¼è°ƒç”¨ã€‚æ ‡å‡†æ¥å£åŒ…æ‹¬ï¼š

- streamï¼šè¿”å›å“åº”çš„æ•°æ®å—ã€‚
- invokeï¼šè¾“å…¥è°ƒç”¨é“¾(åŒæ­¥è°ƒç”¨ï¼‰ã€‚
- batchï¼šè¾“å…¥åˆ—è¡¨è°ƒç”¨é“¾ï¼ˆæ‰¹é‡è°ƒç”¨ï¼‰ã€‚

è¿˜æœ‰ç›¸åº”çš„å¼‚æ­¥æ–¹æ³•ï¼Œåº”è¯¥ä¸asyncioä¸€èµ·ä½¿ç”¨awaitè¯­æ³•ä»¥å®ç°å¹¶å‘ï¼š

- astreamï¼šå¼‚æ­¥è¿”å›å“åº”çš„æ•°æ®å—ã€‚
- ainvokeï¼šå¼‚æ­¥è¾“å…¥è°ƒç”¨é“¾ã€‚
- abatchï¼šå¼‚æ­¥è¾“å…¥åˆ—è¡¨è°ƒç”¨é“¾ã€‚
- astream_logï¼šå¼‚æ­¥è¿”å›ä¸­é—´æ­¥éª¤ï¼Œä»¥åŠæœ€ç»ˆå“åº”ã€‚
- astream_eventsï¼šbetaæµå¼ä¼ è¾“é“¾ä¸­å‘ç”Ÿçš„äº‹ä»¶ã€‚

è¾“å…¥ç±»å‹å’Œè¾“å‡ºç±»å‹å› ç»„ä»¶è€Œå¼‚ï¼š

| ç»„ä»¶       | è¾“å…¥ç±»å‹                         | è¾“å‡ºç±»å‹     |
| ---------- | -------------------------------- | ------------ |
| æç¤º       | å­—å…¸                             | æç¤ºå€¼       |
| èŠå¤©æ¨¡å‹   | å•ä¸ªå­—ç¬¦ä¸²ã€èŠå¤©ä¿¡æ¯åˆ—è¡¨æˆ–æç¤ºå€¼ | èŠå¤©æ¶ˆæ¯     |
| LLM        | å•ä¸ªå­—ç¬¦ä¸²ã€èŠå¤©ä¿¡æ¯åˆ—è¡¨æˆ–æç¤ºå€¼ | å­—ç¬¦ä¸²       |
| è¾“å‡ºè§£æå™¨ | LLMæˆ–èŠå¤©æ¨¡å‹çš„è¾“å‡º              | å–å†³äºè§£æå™¨ |
| æ£€ç´¢å™¨     | å•ä¸ªå­—ç¬¦ä¸²                       | æ–‡æ¡£åˆ—è¡¨     |
| å·¥å…·       | å•ä¸ªå­—ç¬¦ä¸²å’Œå­—å…¸ï¼Œå–å†³äºå·¥å…·     | å–å†³äºå·¥å…·   |

æ‰€æœ‰å¯è¿è¡Œå¯¹è±¡éƒ½å…¬å¼€è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ä»¥æ£€æŸ¥è¾“å…¥å’Œè¾“å‡ºï¼š

- input_schema:ä»å¯è¿è¡Œå¯¹è±¡æœºæ„è‡ªåŠ¨ç”Ÿæˆçš„è¾“å…¥Pydanticæ¨¡å‹
- output_schema:ä»å¯è¿è¡Œå¯¹è±¡æœºæ„è‡ªåŠ¨ç”Ÿæˆçš„è¾“å‡ºPydanticæ¨¡å‹

æµå¼è¿è¡Œå¯¹äºä½¿åŸºäºLLMçš„åº”ç”¨ç¨‹åºå¯¹æœ€ç»ˆç”¨æˆ·å…·æœ‰å“åº”æ€§è‡³å…³é‡è¦ã€‚å¦‚èŠå¤©æ¨¡å‹ã€è¾“å‡ºè§£æå™¨ã€æç¤ºæ¨¡ç‰ˆã€æ£€ç´¢å™¨å’Œä»£ç†éƒ½å®ç°äº†LangChain Runnableæ¥å£ã€‚

è¯¥æ¥å£æä¾›äº†ä¸¤ç§é€šç”¨çš„æµå¼å†…å®¹æ–¹æ³•ï¼š

1. åŒæ­¥streamå’Œå¼‚æ­¥astreamï¼šæµå¼ä¼ è¾“é“¾ä¸­çš„æœ€ç»ˆè¾“å‡ºçš„é»˜è®¤å®ç°ã€‚
2. å¼‚æ­¥astream_eventså’Œå¼‚æ­¥astream_logï¼šè¿™äº›æ–¹æ³•æä¾›äº†ä¸€ç§ä»é“¾ä¸­æµå¼ä¼ è¾“ä¸­é—´æ­¥éª¤å’Œæœ€ç»ˆè¾“å‡ºçš„æ–¹å¼ã€‚

## Stream

æ‰€æœ‰çš„Runnableå¯¹è±¡éƒ½å®ç°äº†ä¸€ä¸ªåä¸ºstreamçš„åŒæ­¥æ–¹æ³•å’Œä¸€ä¸ªåä¸ºastreamçš„å¼‚æ­¥å˜ä½“ã€‚è¿™äº›æ–¹æ³•çš†åœ¨ä»¥å—çš„å½¢å¼æµå¼ä¼ è¾“æœ€ç»ˆè¾“å‡ºï¼Œå°½å¿«è¿”å›æ¯ä¸ªå—ã€‚åªæœ‰

åœ¨ç¨‹åºä¸­çš„æ‰€æœ‰æ­¥éª¤éƒ½çŸ¥é“å¦‚ä½•å¤„ç†è¾“å…¥æ—¶ï¼Œæ‰èƒ½è¿›è¡Œæµå¼ä¼ è¾“ï¼›å³ï¼Œé€ä¸ªå¤„ç†è¾“å…¥å—ï¼Œå¹¶äº§ç”Ÿç›¸åº”çš„è¾“å‡ºå—ã€‚è¿™ç§å¤„ç†çš„å¤æ‚æ€§å¯ä»¥æœ‰æ‰€ä¸åŒï¼Œä»ç®€å•çš„ä»»åŠ¡ï¼Œ

å¦‚å‘å‡ºLLMç”Ÿæˆçš„ä»¤ç‰Œï¼Œåˆ°æ›´å…·æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ï¼Œå¦‚åœ¨æ•´ä¸ªJSONå®Œæˆå‰æµå¼ä¼ è¾“JSONç»“æœçš„éƒ¨åˆ†ã€‚å¼€å§‹æ¢ç´¢æµå¼ä¼ è¾“çš„æœ€ä½³æ–¹æ³•ä»LLMåº”ç”¨ç¨‹åºä¸­æœ€é‡è¦çš„ç»„ä»¶å¼€

å§‹-LLMæœ¬èº«ï¼

### LLMå’ŒèŠå¤©æ¨¡å‹

å¤§å‹è¯­è¨€æ¨¡å‹ä¸å…¶èŠå¤©å˜ä½“æ˜¯åŸºäºLLMçš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç“¶é¢ˆã€‚å¤§å‹è¯­è¨€æ¨¡å‹å¯èƒ½éœ€è¦å‡ ç§’æ‰èƒ½å¯¹æŸ¥è¯¢ç”Ÿæˆå®Œæ•´çš„å“åº”ã€‚è¿™æ¯”åº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·å…·æœ‰å“åº”æ€§çš„çº¦200-

300æ¯«ç§’çš„é˜€å€¼è¦æ…¢çš„å¤šã€‚ä½¿åº”ç”¨ç¨‹åºå…·æœ‰æ›´é«˜çš„å“åº”æ€§çš„å…³é”®ç­–ç•¥æ˜¯æ˜¾ç¤ºä¸­é—´è¿›åº¦ï¼›å³ï¼Œé€ä¸ªä»¤ç‰Œæµå¼ä¼ è¾“æ¨¡å‹çš„è¾“å‡ºã€‚è¿™é‡Œå±•ç¤ºä½¿ç”¨èŠå¤©æ¨¡å‹æµå¼ä¼ è¾“çš„ç¤º

ä¾‹ã€‚ä»¥ä¸‹é€‰é¡¹ä¸­é€‰æ‹©ä¸€ä¸ªï¼š

ä»åŒæ­¥stream APIå¼€å§‹ï¼š

```python
model = ChatOpenAI(
    temperature=0,
    model="gpt-4o",
    base_url="********",  # æ ¹æ®ä½ çš„å®é™…APIè·¯å¾„ç¡®è®¤æ˜¯å¦åŠ  /v1
    api_key="********"
)
chunks = []
for chunk in model.stream("æµ·æ˜¯ä»€ä¹ˆé¢œè‰²"):
    chunks.append(chunk)
    print(chunk.content, end="|", flush=True)
```

```
|æµ·|çš„|é¢œè‰²|ä¼š|å› |å¤š|ç§|å› ç´ |è€Œ|å˜åŒ–|ã€‚|é€šå¸¸|æƒ…å†µä¸‹|ï¼Œ|æµ·|æ°´|å‘ˆ|ç°|è“|è‰²|ï¼Œè¿™æ˜¯|å› ä¸º|æ°´|åˆ†|å­|å¸|æ”¶|äº†|é˜³|å…‰|ä¸­çš„|çº¢|è‰²|å’Œ|æ©™|è‰²|å…‰|è°±|ï¼Œè€Œ|è“|è‰²|å…‰|è°±|è¢«|å|å°„|å‡ºæ¥|ã€‚æ­¤å¤–|ï¼Œ|æµ·|æ°´|çš„|é¢œè‰²|è¿˜|ä¼š|å—åˆ°|ä»¥ä¸‹|å› ç´ |çš„|å½±å“|ï¼š

|1|.| **|å¤©æ°”|å’Œ|å…‰|ç…§|**|ï¼š|æ™´|å¤©|æ—¶|ï¼Œ|æµ·|æ°´|é€šå¸¸|çœ‹|èµ·æ¥|æ›´|è“|ï¼Œè€Œ|é˜´|å¤©|æˆ–|æ—¥|è½|æ—¶|å¯èƒ½|å‘ˆ|ç°|ç°|è‰²|æˆ–|é‡‘|è‰²|ã€‚

|2|.| **|æ°´|çš„|æ·±|åº¦|**|ï¼š|æµ…|æ°´|åŒº|å¯èƒ½|å‘ˆ|ç°|ç»¿è‰²|æˆ–|é’|è‰²|ï¼Œå› ä¸º|æµ·|åº•|çš„|æ²™|å­|å’Œ|æ¤ç‰©|å|å°„|å…‰|çº¿|ã€‚

|3|.| **|æµ®|æ¸¸|ç”Ÿ|ç‰©|**|ï¼š|å¤§é‡|çš„|æµ®|æ¸¸|æ¤ç‰©|å¯ä»¥|ä½¿|æµ·|æ°´|å‘ˆ|ç°|ç»¿è‰²|æˆ–|æ£•|è‰²|ã€‚

|4|.| **|æ²‰|ç§¯|ç‰©|å’Œ|æ±¡æŸ“|**|ï¼š|æ³¥|æ²™|æˆ–|æ±¡æŸ“|ç‰©|å¯ä»¥|ä½¿|æµ·|æ°´|å˜|å¾—|æµ‘|æµŠ|ï¼Œ|é¢œè‰²|å¯èƒ½|å˜|å¾—|æ›´|æš—|æˆ–|å‘ˆ|ç°|æ£•|è‰²|ã€‚

|å› æ­¤|ï¼Œ|æµ·|çš„|é¢œè‰²|å¹¶|ä¸æ˜¯|å›ºå®š|çš„|ï¼Œè€Œ|æ˜¯|éšç€|ç¯å¢ƒ|æ¡ä»¶|çš„|å˜åŒ–|è€Œ|å˜åŒ–|ã€‚||
```

æˆ–è€…ä½¿ç”¨å¼‚æ­¥astream API

```python
async def test():
    async for chunk in model.astream("æµ·æ˜¯ä»€ä¹ˆé¢œè‰²"):
        chunks.append(chunk)
        print(chunk.content, end="|", flush=True)
asyncio.run(test())
```

```
|æµ·|çš„|é¢œè‰²|ä¼š|å› |å¤š|ç§|å› ç´ |è€Œ|å˜åŒ–|ã€‚|é€šå¸¸|æƒ…å†µä¸‹|ï¼Œ|æµ·|æ°´|å‘ˆ|ç°|è“|è‰²|ï¼Œè¿™æ˜¯|å› ä¸º|æ°´|åˆ†|å­|å¸|æ”¶|äº†|é˜³|å…‰|ä¸­çš„|çº¢|è‰²|å’Œ|æ©™|è‰²|å…‰|è°±|ï¼Œè€Œ|è“|è‰²|å…‰|è°±|è¢«|å|å°„|å‡ºæ¥|ã€‚æ­¤å¤–|ï¼Œ|æµ·|æ°´|çš„|é¢œè‰²|è¿˜|ä¼š|å—åˆ°|ä»¥ä¸‹|å› ç´ |çš„|å½±å“|ï¼š

|1|.| **|å¤©æ°”|å’Œ|å…‰|ç…§|**|ï¼š|æ™´|å¤©|æ—¶|ï¼Œ|æµ·|æ°´|é€šå¸¸|çœ‹|èµ·æ¥|æ›´|è“|ï¼Œè€Œ|é˜´|å¤©|æˆ–|æ—¥|è½|æ—¶|å¯èƒ½|å‘ˆ|ç°|ç°|è‰²|æˆ–|é‡‘|è‰²|ã€‚

|2|.| **|æ°´|çš„|æ·±|åº¦|**|ï¼š|æµ…|æ°´|åŒº|å¯èƒ½|å‘ˆ|ç°|ç»¿è‰²|æˆ–|é’|è‰²|ï¼Œå› ä¸º|æµ·|åº•|çš„|æ²™|å­|å’Œ|æ¤ç‰©|å|å°„|å…‰|çº¿|ã€‚

|3|.| **|æµ®|æ¸¸|ç”Ÿ|ç‰©|å’Œ|è—»|ç±»|**|ï¼š|è¿™äº›|ç”Ÿ|ç‰©|å¯ä»¥|ä½¿|æµ·|æ°´|å‘ˆ|ç°|ç»¿è‰²|æˆ–|å…¶ä»–|é¢œè‰²|ã€‚

|4|.| **|æ²‰|ç§¯|ç‰©|å’Œ|æ±¡æŸ“|ç‰©|**|ï¼š|æ³¥|æ²™|æˆ–|æ±¡æŸ“|ç‰©|ä¼š|ä½¿|æµ·|æ°´|å˜|å¾—|æµ‘|æµŠ|ï¼Œ|é¢œè‰²|å¯èƒ½|å˜|å¾—|æ›´|æš—|æˆ–|å‘ˆ|ç°|æ£•|è‰²|ã€‚

|å› æ­¤|ï¼Œ|æµ·|çš„|é¢œè‰²|å¹¶|ä¸æ˜¯|å›ºå®š|çš„|ï¼Œè€Œ|æ˜¯|éšç€|ç¯å¢ƒ|æ¡ä»¶|çš„|å˜åŒ–|è€Œ|å˜åŒ–|ã€‚||
```

å¾—åˆ°ä¸€ä¸ªç§°ä¸ºAIMessageChunkçš„å“åº”ä½“ï¼Œè¯¥å—è¡¨ç¤ºAIMessageçš„ä¸€éƒ¨åˆ†ã€‚æ¶ˆæ¯å—æ˜¯å¯å åŠ çš„

å¯ä»¥ç®€å•çš„å°†å®ƒä»¬ç›¸åŠ è·å¾—åˆ°ç›®å‰ä¸ºæ­¢çš„å“åº”çŠ¶æ€

```
AIMessageChunk(content="", id='')
```

### Chainï¼ˆé“¾ï¼‰

å‡ ä¹æ‰€æœ‰çš„LLMåº”ç”¨ç¨‹åºéƒ½æ¶‰åŠä¸æ­¢ä¸€æ­¥çš„æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯è°ƒç”¨è¯­è¨€æ¨¡å‹ã€‚ä½¿ç”¨LangChainè¡¨è¾¾å¼è¯­è¨€ï¼ˆLCELï¼‰æ„å»ºä¸€ä¸ªç®€å•çš„é“¾ï¼Œé“¾ç»“åˆäº†ä¸€ä¸ªæç¤ºã€æ¨¡å‹å’Œ

è§£æå™¨ï¼Œå¹¶éªŒè¯æµå¼ä¼ è¾“æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ä½¿ç”¨StrOutPutParseræ¥è§£ææ¨¡å‹çš„è¾“å‡ºã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„è§£æå™¨ï¼Œä»AIMessageChunkä¸­æå–contentå­—æ®µï¼Œç»™å‡ºæ¨¡å‹è¿”

å›çš„tokenã€‚

LCEL æ˜¯ä¸€ç§å£°æ˜å¼çš„æ–¹å¼ï¼Œé€šè¿‡å°†ä¸åŒçš„ LangChain åŸè¯­é“¾æ¥åœ¨ä¸€èµ·æ¥æŒ‡å®šä¸€ä¸ªâ€œç¨‹åºâ€ã€‚ä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾å¯ä»¥è‡ªåŠ¨å®ç° stream å’Œ astreamï¼Œä»è€Œå®ç°å¯¹æœ€

ç»ˆè¾“å‡ºçš„æµå¼ä¼ è¾“ã€‚äº‹å®ä¸Šï¼Œä½¿ç”¨ LCEL åˆ›å»ºçš„é“¾å®ç°äº†æ•´ä¸ªæ ‡å‡† Runnable æ¥å£ã€‚

```python
#astream_chain.py
from langchain_core.output_parsers import StrOutputParser
from langchain_core.prompts import ChatPromptTemplate
prompt = ChatPromptTemplate.from_template("ç»™æˆ‘è®²ä¸€ä¸ªå…³äº{topic}çš„ç¬‘è¯")
parser = StrOutputParser()
chain = prompt | model | parser
async def main():
    async for chunk in chain.astream({"topic": "è®¡ç®—æœº"}):
        print(chunk, end="|", flush=True)
asyncio.run(main())
```

```
|å½“ç„¶|å¯ä»¥|ï¼|è¿™æ˜¯|ä¸€ä¸ª|å…³äº|è®¡ç®—|æœº|çš„|ç¬‘|è¯|ï¼š

|ä¸ºä»€ä¹ˆ|è®¡ç®—|æœº|å–œæ¬¢|åƒ|é¥¼|å¹²|ï¼Ÿ

|å› ä¸º|å®ƒ|ä»¬|éœ€è¦|ä¸€ç‚¹|å­—|èŠ‚|ï¼ˆ|bite|ï¼‰|ï¼||
```

è¯·æ³¨æ„ï¼Œå³ä½¿æˆ‘ä»¬åœ¨ä¸Šé¢çš„é“¾æ¡æœ«å°¾ä½¿ç”¨äº†parserï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è·å¾—æµå¼è¾“å‡ºã€‚parserä¼šå¯¹æ¯ä¸ªæµå¼å—è¿›è¡Œæ“ä½œã€‚è®¸å¤šLCELä¹Ÿæ”¯æŒè¿™ç§è½¬æ¢å¼çš„æµå¼ä¼ é€’ï¼Œè¿™

åœ¨æ„å»ºåº”ç”¨ç¨‹åºæ—¶éå¸¸æ–¹ä¾¿ã€‚

è‡ªå®šä¹‰å‡½æ•°å¯ä»¥è¢«è®¾è®¡ä¸ºè¿”å›ç”Ÿæˆå™¨ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæ“ä½œæµã€‚

æŸäº›å¯è¿è¡Œå®ä½“ï¼Œå¦‚æç¤ºæ¨¡æ¿å’ŒèŠå¤©æ¨¡å‹ï¼Œæ— æ³•å¤„ç†å•ä¸ªå—ï¼Œè€Œæ˜¯èšåˆæ‰€æœ‰å…ˆå‰çš„æ­¥éª¤ã€‚è¿™äº›å¯è¿è¡Œå®ä½“å¯ä»¥ä¸­æ–­æµå¤„ç†ã€‚

LangChainè¡¨è¾¾è¯­è¨€å…è®¸å°†é“¾çš„æ„å»ºä¸ä½¿ç”¨æ¨¡å¼ï¼ˆä¾‹å¦‚åŒæ­¥/å¼‚æ­¥ã€æ‰¹å¤„ç†/æµå¼ç­‰ï¼‰åˆ†å¼€ã€‚å¦‚æœè¿™ä¸æ„å»ºçš„å†…å®¹æ— å…³ï¼Œä¹Ÿå¯ä»¥ä¾èµ–äºæ ‡å‡†çš„å‘½ä»¤å¼ç¼–ç¨‹æ–¹æ³•ï¼Œé€šè¿‡

åœ¨æ¯ä¸ªç»„ä»¶ä¸Šè°ƒç”¨invokeã€batchæˆ–streamï¼Œå°†ç»“æœåˆ†é…ç»™å˜é‡ï¼Œç„¶åæ ¹æ®éœ€è¦åœ¨ä¸‹æ¸¸ä½¿ç”¨å®ƒä»¬ã€‚

### ä½¿ç”¨è¾“å…¥æµ

å¦‚æœæƒ³è¦åœ¨è¾“å‡ºç”Ÿæˆæ—¶ä»ä¸­æµå¼ä¼ è¾“JSONï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

å¦‚æœä¾èµ–json.loadsæ¥è§£æéƒ¨åˆ†JSONï¼Œé‚£ä¹ˆè§£æå°†å¤±è´¥ï¼Œå› ä¸ºéƒ¨åˆ†JSONä¸ä¼šæ˜¯æœ‰æ•ˆçš„JSONã€‚

å¯èƒ½ä¼šæŸæ‰‹æ— ç­–ï¼Œå£°ç§°æ— æ³•æµå¼ä¼ è¾“JSONã€‚

äº‹å®è¯æ˜ï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹â€”â€”è§£æå™¨éœ€è¦åœ¨è¾“å…¥æµä¸Šæ“ä½œï¼Œå¹¶å°è¯•å°†éƒ¨åˆ†JSONâ€œè‡ªåŠ¨å®Œæˆâ€ä¸ºæœ‰æ•ˆçŠ¶æ€ã€‚

è¿™æ ·ä¸€ä¸ªè§£æå™¨çš„è¿è¡Œï¼Œä»¥äº†è§£è¿™æ„å‘³ç€ä»€ä¹ˆã€‚

```
model = ChatOpenAI(model="gpt-4")
parser = StrOutputParser()
chain = (
    model | JsonOutputParser()
)
async def main():
    async for text in chain.astream(
        "ä»¥JSON æ ¼å¼è¾“å‡ºæ³•å›½ã€è¥¿ç­ç‰™å’Œæ—¥æœ¬çš„å›½å®¶åŠå…¶äººå£åˆ—è¡¨ã€‚"
        'ä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰â€œcountriesâ€å¤–éƒ¨é”®çš„å­—å…¸ï¼Œå…¶ä¸­åŒ…å«å›½å®¶åˆ—è¡¨ã€‚'
        "æ¯ä¸ªå›½å®¶éƒ½åº”è¯¥æœ‰é”®`name`å’Œ`population`"
    ):
        print(text)
asyncio.run(main())
```

```
{}
{'countries': []}
{'countries': [{}]}
{'countries': [{'name': ''}]}
{'countries': [{'name': 'France'}]}
{'countries': [{'name': 'France', 'population': 670}]}
{'countries': [{'name': 'France', 'population': 670810}]}
{'countries': [{'name': 'France', 'population': 67081000}]}
{'countries': [{'name': 'France', 'population': 67081000}, {}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': ''}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain'}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 473}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 473500}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}, {}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}, {'name': ''}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}, {'name': 'Japan'}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}, {'name': 'Japan', 'population': 125}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}, {'name': 'Japan', 'population': 125700}]}
{'countries': [{'name': 'France', 'population': 67081000}, {'name': 'Spain', 'population': 47350000}, {'name': 'Japan', 'population': 125700000}]}
```

## Stream events(äº‹ä»¶æµ)

ç°åœ¨å·²ç»äº†è§£äº†streamå’Œastreamçš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬è¿›å…¥äº‹ä»¶æµçš„ä¸–ç•Œã€‚

äº‹ä»¶æµæ˜¯ä¸€ä¸ªbeta APIã€‚è¿™ä¸ªAPIå¯èƒ½ä¼šæ ¹æ®åé¦ˆç•¥å¾®æ›´æ”¹ã€‚

æœ¬æŒ‡å—æ¼”ç¤ºäº†V2 APIï¼Œå¹¶ä¸”éœ€è¦ langchain-core >= 0.2ã€‚å¯¹äºä¸æ—§ç‰ˆæœ¬ LangChain å…¼å®¹çš„V1 APIï¼Œè¯·å‚é˜…è¿™é‡Œã€‚

```
import langchain_core
langchain_core.__version__
```

ä¸ºäº†ä½¿astream_events APIæ­£å¸¸å·¥ä½œï¼š

- åœ¨ä»£ç ä¸­å°½å¯èƒ½ä½¿ç”¨asyncï¼ˆä¾‹å¦‚ï¼Œå¼‚æ­¥å·¥å…·ç­‰ï¼‰

- å¦‚æœå®šä¹‰è‡ªå®šä¹‰å‡½æ•°/å¯è¿è¡Œé¡¹ï¼Œè¯·ä¼ æ’­å›è°ƒ

- åœ¨æ²¡æœ‰ LCEL çš„æƒ…å†µä¸‹ä½¿ç”¨å¯è¿è¡Œé¡¹æ—¶ï¼Œè¯·ç¡®ä¿åœ¨LLMsä¸Šè°ƒç”¨.astream()è€Œä¸æ˜¯.ainvokeä»¥å¼ºåˆ¶LLMæµå¼ä¼ è¾“ä»¤ç‰Œ

#### äº‹ä»¶å‚è€ƒ

ä¸‹é¢æ˜¯ä¸€ä¸ªå‚è€ƒè¡¨ï¼Œæ˜¾ç¤ºå„ç§å¯è¿è¡Œå¯¹è±¡å¯èƒ½å‘å‡ºçš„ä¸€äº›äº‹ä»¶ã€‚

å½“æµå¼ä¼ è¾“æ­£ç¡®å®ç°æ—¶ï¼Œå¯¹äºå¯è¿è¡Œé¡¹çš„è¾“å…¥ç›´åˆ°è¾“å…¥æµå®Œå…¨æ¶ˆè€—åæ‰ä¼šçŸ¥é“ã€‚è¿™æ„å‘³ç€inputsé€šå¸¸ä»…åŒ…æ‹¬endäº‹ä»¶ï¼Œè€Œä¸åŒ…æ‹¬startäº‹ä»¶ã€‚

| äº‹ä»¶                | åç§°         | å—                             | è¾“å…¥                                          | è¾“å‡º                                            |
| ------------------- | ------------ | ------------------------------ | --------------------------------------------- | ----------------------------------------------- |
| on_chat_model_start | [æ¨¡å‹åç§°]   |                                | {"messages": [[SystemMessage, HumanMessage]]} |                                                 |
| on_chat_model_end   | [æ¨¡å‹åç§°]   |                                | {"messages": [[SystemMessage, HumanMessage]]} | AIMessageChunk(content="hello world")           |
| on_llm_start        | [æ¨¡å‹åç§°]   |                                | {'input': 'hello'}                            |                                                 |
| on_llm_stream       | [æ¨¡å‹åç§°]   | 'Hello'                        |                                               |                                                 |
| on_llm_end          | [æ¨¡å‹åç§°]   |                                | 'Hello human!'                                |                                                 |
| on_chain_start      | format_docs  |                                |                                               |                                                 |
| on_chain_stream     | format_docs  | "hello world!, goodbye world!" |                                               |                                                 |
| on_chain_end        | format_docs  |                                | [Document(...)]                               | "hello world!, goodbye world!"                  |
| on_tool_start       | some_tool    |                                | {"x": 1, "y": "2"}                            |                                                 |
| on_tool_end         | some_tool    |                                |                                               | {"x": 1, "y": "2"}                              |
| on_retriever_start  | [æ£€ç´¢å™¨åç§°] |                                | {"query": "hello"}                            |                                                 |
| on_retriever_end    | [æ£€ç´¢å™¨åç§°] |                                | {"query": "hello"}                            | [Document(...), ..]                             |
| on_prompt_start     | [æ¨¡æ¿åç§°]   |                                | {"question": "hello"}                         |                                                 |
| on_prompt_end       | [æ¨¡æ¿åç§°]   |                                | {"question": "hello"}                         | ChatPromptValue(messages: [SystemMessage, ...]) |

#### èŠå¤©æ¨¡å‹

è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹èŠå¤©æ¨¡å‹äº§ç”Ÿçš„äº‹ä»¶ã€‚

```python
#astream_event.py
events = []
async def main():
    async for event in model.astream_events("hello", version="v2"):
        events.append(event)
    print(events)
asyncio.run(main())
```

```python
[{'event': 'on_chat_model_start', 'data': {'input': 'hello'}, 'name': 'ChatOpenAI', 'tags': [], 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content='', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content='Hello', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content='!', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content=' How', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content=' can', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content=' I', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content=' assist', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content=' you', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content=' today', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content='?', additional_kwargs={}, response_metadata={}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_stream', 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'data': {'chunk': AIMessageChunk(content='', additional_kwargs={}, response_metadata={'finish_reason': 'stop', 'model_name': 'gpt-4o'}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'parent_ids': []}, {'event': 'on_chat_model_end', 'data': {'output': AIMessageChunk(content='Hello! How can I assist you today?', additional_kwargs={}, response_metadata={'finish_reason': 'stop', 'model_name': 'gpt-4o'}, id='run--69030705-1739-423c-83e8-ac2911b114dd')}, 'run_id': '69030705-1739-423c-83e8-ac2911b114dd', 'name': 'ChatOpenAI', 'tags': [], 'metadata': {'ls_provider': 'openai', 'ls_model_name': 'gpt-4o', 'ls_model_type': 'chat', 'ls_temperature': 0.0}, 'parent_ids': []}]

```

è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€äº›å¼€å§‹äº‹ä»¶å’Œä¸€äº›ç»“æŸäº‹ä»¶ã€‚

```python
events[:3]
```

```python
[{
	'event': 'on_chat_model_start',
	'data': {
		'input': 'hello'
	},
	'name': 'ChatOpenAI',
	'tags': [],
	'run_id': '6eaf265d-5928-4e32-9db6-a98669ba8115',
	'metadata': {
		'ls_provider': 'openai',
		'ls_model_name': 'gpt-4o',
		'ls_model_type': 'chat',
		'ls_temperature': 0.0
	},
	'parent_ids': []
}, {
	'event': 'on_chat_model_stream',
	'run_id': '6eaf265d-5928-4e32-9db6-a98669ba8115',
	'name': 'ChatOpenAI',
	'tags': [],
	'metadata': {
		'ls_provider': 'openai',
		'ls_model_name': 'gpt-4o',
		'ls_model_type': 'chat',
		'ls_temperature': 0.0
	},
	'data': {
		'chunk': AIMessageChunk(content = '', additional_kwargs = {}, response_metadata = {}, id = 'run--6eaf265d-5928-4e32-9db6-a98669ba8115')
	},
	'parent_ids': []
}, {
	'event': 'on_chat_model_stream',
	'run_id': '6eaf265d-5928-4e32-9db6-a98669ba8115',
	'name': 'ChatOpenAI',
	'tags': [],
	'metadata': {
		'ls_provider': 'openai',
		'ls_model_name': 'gpt-4o',
		'ls_model_type': 'chat',
		'ls_temperature': 0.0
	},
	'data': {
		'chunk': AIMessageChunk(content = 'Hello', additional_kwargs = {}, response_metadata = {}, id = 'run--6eaf265d-5928-4e32-9db6-a98669ba8115')
	},
	'parent_ids': []
}]
```

```python
events[-2:]
```

```python
[{
	'event': 'on_chat_model_stream',
	'run_id': '610bd14a-7893-40ef-aaee-44ed41259fed',
	'name': 'ChatOpenAI',
	'tags': [],
	'metadata': {
		'ls_provider': 'openai',
		'ls_model_name': 'gpt-4o',
		'ls_model_type': 'chat',
		'ls_temperature': 0.0
	},
	'data': {
		'chunk': AIMessageChunk(content = '', additional_kwargs = {}, response_metadata = {
			'finish_reason': 'stop',
			'model_name': 'gpt-4o'
		}, id = 'run--610bd14a-7893-40ef-aaee-44ed41259fed')
	},
	'parent_ids': []
}, {
	'event': 'on_chat_model_end',
	'data': {
		'output': AIMessageChunk(content = 'Hello! How can I assist you today?', additional_kwargs = {}, response_metadata = {
			'finish_reason': 'stop',
			'model_name': 'gpt-4o'
		}, id = 'run--610bd14a-7893-40ef-aaee-44ed41259fed')
	},
	'run_id': '610bd14a-7893-40ef-aaee-44ed41259fed',
	'name': 'ChatOpenAI',
	'tags': [],
	'metadata': {
		'ls_provider': 'openai',
		'ls_model_name': 'gpt-4o',
		'ls_model_type': 'chat',
		'ls_temperature': 0.0
	},
	'parent_ids': []
}]
```

# LangChainæœåŠ¡éƒ¨ç½²ä¸é“¾è·¯ç›‘æ§

## LangServeæœåŠ¡éƒ¨ç½²

### æ¦‚è¿°

LangServeå¸®åŠ©å¼€å‘è€…å°† LangChain å¯è¿è¡Œå’Œé“¾éƒ¨ç½²ä¸º REST APIã€‚

è¯¥åº“é›†æˆäº† FastAPI å¹¶ä½¿ç”¨ pydantic è¿›è¡Œæ•°æ®éªŒè¯ã€‚

Pydantic æ˜¯ä¸€ä¸ªåœ¨ Pythonä¸­ç”¨äºæ•°æ®éªŒè¯å’Œè§£æçš„ç¬¬ä¸‰æ–¹åº“ï¼Œç°åœ¨æ˜¯Pythonä¸­ä½¿ç”¨å¹¿æ³›çš„æ•°æ®éªŒè¯åº“ã€‚

- åˆ©ç”¨å£°æ˜å¼çš„æ–¹å¼å®šä¹‰æ•°æ®æ¨¡å‹å’ŒPython ç±»å‹æç¤ºçš„å¼ºå¤§åŠŸèƒ½æ¥æ‰§è¡Œæ•°æ®éªŒè¯å’Œåºåˆ—åŒ–ï¼Œä½¿ä»£ç æ›´å¯é ã€æ›´å¯è¯»ã€æ›´ç®€æ´ä¸”æ›´æ˜“äºè°ƒè¯•ã€‚

- å¯ä»¥ä»æ¨¡å‹ç”Ÿæˆ JSON æ¶æ„ï¼Œæä¾›äº†è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£ç­‰åŠŸèƒ½ï¼Œä»è€Œè½»æ¾ä¸å…¶ä»–å·¥å…·é›†æˆã€‚

æ­¤å¤–ï¼Œæä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå¯ç”¨äºè°ƒç”¨éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„å¯è¿è¡Œå¯¹è±¡ã€‚JavaScript å®¢æˆ·ç«¯å¯åœ¨ LangChain.js ä¸­æ‰¾åˆ°ã€‚

### ç‰¹æ€§

- ä» LangChain å¯¹è±¡è‡ªåŠ¨æ¨æ–­è¾“å…¥å’Œè¾“å‡ºæ¨¡å¼ï¼Œå¹¶åœ¨æ¯æ¬¡ API è°ƒç”¨ä¸­æ‰§è¡Œï¼Œæä¾›ä¸°å¯Œçš„é”™è¯¯ä¿¡æ¯ã€‚

- å¸¦æœ‰ JSONSchema å’Œ Swagger çš„ API æ–‡æ¡£é¡µé¢ï¼ˆæ’å…¥ç¤ºä¾‹é“¾æ¥ï¼‰ã€‚

- é«˜æ•ˆçš„ /invokeã€/batch å’Œ /stream ç«¯ç‚¹ï¼Œæ”¯æŒå•ä¸ªæœåŠ¡å™¨ä¸Šçš„å¤šä¸ªå¹¶å‘è¯·æ±‚ã€‚

- /stream_log ç«¯ç‚¹ï¼Œç”¨äºæµå¼ä¼ è¾“é“¾/ä»£ç†çš„æ‰€æœ‰ï¼ˆæˆ–éƒ¨åˆ†ï¼‰ä¸­é—´æ­¥éª¤ã€‚

- æ–°åŠŸèƒ½ è‡ª 0.0.40 ç‰ˆæœ¬èµ·ï¼Œæ”¯æŒ /stream_eventsï¼Œä½¿æµå¼ä¼ è¾“æ›´åŠ ç®€ä¾¿ï¼Œæ— éœ€è§£æ /stream_log çš„è¾“å‡ºã€‚

- ä½¿ç”¨ç»è¿‡ä¸¥æ ¼æµ‹è¯•çš„å¼€æº Python åº“æ„å»ºï¼Œå¦‚ FastAPIã€Pydanticã€uvloop å’Œ asyncioã€‚

- ä½¿ç”¨å®¢æˆ·ç«¯ SDK è°ƒç”¨ LangServe æœåŠ¡å™¨ï¼Œå°±åƒæœ¬åœ°è¿è¡Œå¯è¿è¡Œå¯¹è±¡ä¸€æ ·ï¼ˆæˆ–ç›´æ¥è°ƒç”¨ HTTP APIï¼‰ã€‚

### é™åˆ¶

- ç›®å‰ä¸æ”¯æŒæœåŠ¡å™¨å‘èµ·çš„äº‹ä»¶çš„å®¢æˆ·ç«¯å›è°ƒã€‚
- å½“ä½¿ç”¨ Pydantic V2 æ—¶ï¼Œå°†ä¸ä¼šç”Ÿæˆ OpenAPI æ–‡æ¡£ã€‚FastAPI æ”¯æŒæ··åˆä½¿ç”¨ pydantic v1 å’Œ v2 å‘½åç©ºé—´ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§ä¸‹é¢çš„ç« èŠ‚ã€‚

### å®‰è£…

å¯¹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼š

```
pip install --upgrade "langserve[all]" 
```

æˆ–è€…å¯¹äºå®¢æˆ·ç«¯ä»£ç ï¼Œpip install "langserve[client]"ï¼Œå¯¹äºæœåŠ¡å™¨ä»£ç ï¼Œpip install "langserve[server]"ã€‚

## LangChain CLI ğŸ› ï¸

ä½¿ç”¨ LangChain CLI å¿«é€Ÿå¯åŠ¨ LangServe é¡¹ç›®ã€‚

è¦ä½¿ç”¨ langchain CLIï¼Œè¯·ç¡®ä¿å·²å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ langchain-cliã€‚æ‚¨å¯ä»¥ä½¿ç”¨ pip install -U langchain-cli è¿›è¡Œå®‰è£…ã€‚

### è®¾ç½®

æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨ poetry è¿›è¡Œä¾èµ–ç®¡ç†ã€‚è¯·å‚é˜… poetry æ–‡æ¡£ äº†è§£æ›´å¤šä¿¡æ¯ã€‚

1. ä½¿ç”¨ langchain cli å‘½ä»¤åˆ›å»ºæ–°åº”ç”¨

   ```
   langchain app new langserve
   ```

2. åœ¨ add_routes ä¸­å®šä¹‰å¯è¿è¡Œå¯¹è±¡ã€‚è½¬åˆ° server.py å¹¶ç¼–è¾‘

   ```
   add_routes(app. NotImplemented)
   ```

3. ä½¿ç”¨ poetry æ·»åŠ ç¬¬ä¸‰æ–¹åŒ…ï¼ˆä¾‹å¦‚ langchain-openaiã€langchain-anthropicã€langchain-mistral ç­‰ï¼‰

   ```
   #å®‰è£…pipxï¼Œå‚è€ƒï¼šhttps://pipx.pypa.io/stable/installation/
   pip install pipx 
   #åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ï¼Œéœ€è¦é‡å¯PyCharm 
   pipx ensurepath
   
   # å®‰è£…poetryï¼Œå‚è€ƒï¼šhttps://python-poetry.org/docs/
   pipx install poetry
   
   
   #å®‰è£… langchain-openai åº“ï¼Œä¾‹å¦‚ï¼špoetry add [package-name]
   poetry add langchain
   poetry add langchain-openai 
   ```

4. è®¾ç½®ç›¸å…³ç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚ï¼Œ

   ```
   export OPENAI_API_KEY="sk-..."
   ```

5. å¯åŠ¨æ‚¨çš„åº”ç”¨

  ```
  poetry run langchain serve --port=8000
  ```

### ç¤ºä¾‹åº”ç”¨

#### æœåŠ¡å™¨

ä»¥ä¸‹æ˜¯ä¸€ä¸ªéƒ¨ç½² OpenAI èŠå¤©æ¨¡å‹ï¼Œè®²è¿°æœ‰å…³ç‰¹å®šä¸»é¢˜ç¬‘è¯çš„é“¾çš„æœåŠ¡å™¨ã€‚

```
#!/usr/bin/env python
from fastapi import FastAPI
from langchain_openai import ChatOpenAI
from langserve import add_routes
app = FastAPI(
    title="LangChain æœåŠ¡å™¨",
    version="1.0",
    description="ä½¿ç”¨ Langchain çš„ Runnable æ¥å£çš„ç®€å• API æœåŠ¡å™¨",
)
add_routes(
    app,
    ChatOpenAI(model="gpt-4"),
    path="/openai",
)
if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="localhost", port=8000)
```

å¦‚æœæ‚¨æ‰“ç®—ä»æµè§ˆå™¨è°ƒç”¨æ‚¨çš„ç«¯ç‚¹ï¼Œæ‚¨è¿˜éœ€è¦è®¾ç½® CORS å¤´ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ FastAPI çš„å†…ç½®ä¸­é—´ä»¶æ¥å®ç°ï¼š

```
from fastapi.middleware.cors import CORSMiddleware
# è®¾ç½®æ‰€æœ‰å¯ç”¨ CORS çš„æ¥æº
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
    expose_headers=["*"],
)
```

#### æ–‡æ¡£

å¦‚æœæ‚¨å·²éƒ¨ç½²ä¸Šè¿°æœåŠ¡å™¨ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„ OpenAPI æ–‡æ¡£ï¼š

æ–‡æ¡£åœ°å€ï¼šhttp://localhost:8000/docs

```
curl localhost:8000/docs
```

è¯·ç¡®ä¿æ·»åŠ  /docs åç¼€ã€‚ é¦–é¡µ / æ²¡æœ‰è¢«è®¾è®¡å®šä¹‰ï¼Œå› æ­¤ curl localhost:8000 æˆ–è®¿é—®è¯¥ URLå°†è¿”å› 404ã€‚å¦‚æœæ‚¨æƒ³åœ¨ / ä¸Šæœ‰å†…å®¹ï¼Œè¯·å®šä¹‰ä¸€ä¸ªç«¯ç‚¹ @app.get("/")ã€‚

#### å®¢æˆ·ç«¯

Python SDK

```
from langchain.schema.runnable import RunnableMap
from langchain_core.prompts import ChatPromptTemplate
from langserve import RemoteRunnable

openai = RemoteRunnable("http://localhost:8000/openai/")
prompt = ChatPromptTemplate.from_messages(
    [("system", "ä½ æ˜¯ä¸€ä¸ªå–œæ¬¢å†™æ•…äº‹çš„åŠ©æ‰‹"), ("system", "å†™ä¸€ä¸ªæ•…äº‹ï¼Œä¸»é¢˜æ˜¯ï¼š {topic}")]
)
# å¯ä»¥å®šä¹‰è‡ªå®šä¹‰é“¾
chain = prompt | RunnableMap({
    "openai": openai
})
response = chain.batch([{"topic": "çŒ«"}])
print(response)
#[{'openai': AIMessage(content='ä»å‰ï¼Œæœ‰ä¸€ä¸ªå«åšè‚–æ©çš„ç”·å­©ï¼Œä»–åœ¨ä¸€ä¸ªå®é™çš„ä¹¡æ‘é‡Œç”Ÿæ´»ã€‚ä¸€å¤©ï¼Œä»–åœ¨å®¶çš„åé™¢å‘ç°äº†ä¸€ä¸ªå°å°çš„ï¼ŒèŒèŒçš„çŒ«å’ªã€‚è¿™åªçŒ«å’ªæœ‰ä¸€åŒå¤§å¤§çš„è“è‰²çœ¼ç›ï¼Œæ¯›è‰²å¦‚åŒæœéœèˆ¬çš„ç²‰è‰²ï¼Œçœ‹èµ·æ¥éå¸¸å¯çˆ±ã€‚\n\nè‚–æ©æŠŠè¿™åªçŒ«å’ªå¸¦å›äº†å®¶ï¼Œä»–ç»™å¥¹å–åä¸ºâ€œæ¨±èŠ±â€ï¼Œå› ä¸ºå¥¹çš„æ¯›è‰²è®©ä»–è”æƒ³åˆ°æ˜¥å¤©ç››å¼€çš„æ¨±èŠ±ã€‚è‚–æ©éå¸¸å–œæ¬¢æ¨±èŠ±ï¼Œä»–ç”¨å¿ƒç…§é¡¾å¥¹ï¼Œæ¯å¤©éƒ½ä¼šä¸ºå¥¹å‡†å¤‡æ–°é²œçš„é£Ÿç‰©å’Œæ¸…æ°´ï¼Œè¿˜ä¼šé™ªå¥¹ç©è€ï¼Œå¸¦å¥¹å»æ•£æ­¥ã€‚\n\næ¨±èŠ±ä¹Ÿéå¸¸å–œæ¬¢è‚–æ©ï¼Œå¥¹ä¼šåœ¨è‚–æ©è¯»ä¹¦çš„æ—¶å€™èººåœ¨ä»–çš„è„šè¾¹ï¼Œä¼šåœ¨ä»–ä¼¤å¿ƒçš„æ—¶å€™å®‰æ…°ä»–ï¼Œæ¯å½“è‚–æ©å›å®¶çš„æ—¶å€™ï¼Œå¥¹æ€»æ˜¯ç¬¬ä¸€ä¸ªè·‘å‡ºæ¥è¿æ¥ä»–ã€‚å¯æ˜¯ï¼Œæ¨±èŠ±æœ‰ä¸€ä¸ªç§˜å¯†ï¼Œå¥¹å…¶å®æ˜¯ä¸€åªä¼šè¯´äººè¯çš„çŒ«ã€‚\n\nè¿™ä¸ªç§˜å¯†æ˜¯åœ¨ä¸€ä¸ªæœˆåœ†çš„å¤œæ™šè¢«è‚–æ©å‘ç°çš„ã€‚é‚£å¤©æ™šä¸Šï¼Œè‚–æ©åšäº†ä¸€ä¸ªå™©æ¢¦ï¼Œä»–ä»æ¢¦ä¸­æƒŠé†’ï¼Œå‘ç°æ¨±èŠ±æ­£ååœ¨ä»–çš„åºŠè¾¹ï¼Œç”¨äººçš„è¯­è¨€å®‰æ…°ä»–ã€‚è‚–æ©ä¸€å¼€å§‹ä»¥ä¸ºè‡ªå·±åœ¨åšæ¢¦ï¼Œä½†æ˜¯å½“ä»–æ¸…é†’è¿‡æ¥ï¼Œæ¨±èŠ±è¿˜åœ¨ç»§ç»­è®²è¯ï¼Œä»–æ‰çŸ¥é“è¿™æ˜¯çœŸçš„ã€‚\n\næ¨±èŠ±å‘è‚–æ©è§£é‡Šï¼Œå¥¹æ˜¯ä¸€åªæ¥è‡ªç¥ç§˜çš„çŒ«å’ªå›½åº¦çš„ä½¿è€…ï¼Œå¥¹çš„ä»»åŠ¡æ˜¯ä¿æŠ¤å’Œå¸®åŠ©é‚£äº›å–„è‰¯å’Œçˆ±æŠ¤åŠ¨ç‰©çš„äººã€‚è‚–æ©å› ä¸ºå¯¹å¥¹çš„å–„è‰¯å’Œç…§é¡¾ï¼Œä½¿å¥¹å†³å®šå‘ä»–å±•ç°çœŸå®çš„è‡ªæˆ‘ã€‚\n\nè‚–æ©è™½ç„¶æ„Ÿåˆ°æƒŠè®¶ï¼Œä½†ä»–å¹¶æ²¡æœ‰å› æ­¤è€Œå®³æ€•æˆ–è€…æ’æ–¥æ¨±èŠ±ã€‚ä»–è§‰å¾—è¿™åªä½¿å¾—ä»–æ›´åŠ å–œæ¬¢æ¨±èŠ±ï¼Œè§‰å¾—è¿™æ˜¯ä»–ä»¬ä¹‹é—´çš„ç‰¹æ®Šçº½å¸¦ã€‚\n\nä»é‚£å¤©å¼€å§‹ï¼Œè‚–æ©å’Œæ¨±èŠ±çš„å…³ç³»å˜å¾—æ›´åŠ äº²å¯†ï¼Œä»–ä»¬åƒæœ€å¥½çš„æœ‹å‹ä¸€æ ·ï¼Œåˆ†äº«å½¼æ­¤çš„ç§˜å¯†ï¼Œä¸€èµ·åº¦è¿‡å¿«ä¹çš„æ—¶å…‰ã€‚æ¨±èŠ±ä¹Ÿç”¨å¥¹çš„æ™ºæ…§å’ŒåŠ›é‡ï¼Œå¸®åŠ©è‚–æ©è§£å†³äº†è®¸å¤šå›°æ‰°ä»–çš„é—®é¢˜ã€‚\n\nè®¸å¤šå¹´è¿‡å»äº†ï¼Œè‚–æ©é•¿å¤§äº†ï¼Œä»–ç¦»å¼€äº†ä¹¡æ‘ï¼Œå»äº†åŸå¸‚ä¸Šå¤§å­¦ã€‚ä½†æ˜¯ï¼Œæ— è®ºä»–èµ°åˆ°å“ªé‡Œï¼Œéƒ½ä¼šå¸¦ç€æ¨±èŠ±ã€‚ä»–ä»¬çš„å‹æƒ…å’Œäº’ç›¸çš„é™ªä¼´ï¼Œè®©ä»–ä»¬æ— è®ºåœ¨å“ªé‡Œï¼Œéƒ½èƒ½æ„Ÿåˆ°å®¶çš„æ¸©æš–ã€‚\n\næœ€åï¼Œè‚–æ©æˆä¸ºäº†ä¸€åä½œå®¶ï¼Œä»–å†™ä¸‹äº†è‡ªå·±å’Œæ¨±èŠ±çš„æ•…äº‹ï¼Œè¿™ä¸ªæ•…äº‹è¢«äººä»¬å¹¿ä¸ºä¼ æ’­ï¼Œè®©æ›´å¤šçš„äººçŸ¥é“äº†è¿™ä¸ªå…³äºå–„è‰¯ã€å‹æƒ…å’Œå‹‡æ°”çš„æ•…äº‹ã€‚è€Œæ¨±èŠ±ï¼Œä¹Ÿæ°¸è¿œé™ªä¼´åœ¨è‚–æ©çš„èº«è¾¹ï¼Œæˆä¸ºä»–ç”Ÿæ´»ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚\n\nè¿™å°±æ˜¯è‚–æ©å’Œæ¨±èŠ±çš„æ•…äº‹ï¼Œä¸€ä¸ªå…³äºç”·å­©å’Œä»–çš„çŒ«çš„æ•…äº‹ï¼Œå……æ»¡äº†å¥‡è¿¹ã€æ¸©æš–å’Œçˆ±ã€‚', response_metadata={'token_usage': {'completion_tokens': 1050, 'prompt_tokens': 33, 'total_tokens': 1083}, 'model_name': 'gpt-4-0613', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None}, id='run-c44f1624-ea75-424b-ba3d-e741baf44bda-0', usage_metadata={'input_tokens': 33, 'output_tokens': 1050, 'total_tokens': 1083})}]
```

åœ¨ TypeScript ä¸­ï¼ˆéœ€è¦ LangChain.js ç‰ˆæœ¬ 0.0.166 æˆ–æ›´é«˜ï¼‰ï¼š

```
import { RemoteRunnable } from "@langchain/core/runnables/remote";
const chain = new RemoteRunnable({
  url: `http://localhost:8000/openai/`,
});
const result = await chain.invoke({
  topic: "cats",
});
```

ä½¿ç”¨ requests çš„ Python ä»£ç ï¼š

```
import requests
response = requests.post(
    "http://localhost:8000/openai",
    json={'input': {'topic': 'cats'}}
)
response.json()
```

æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ curlï¼š

```
curl --location --request POST 'http://localhost:8000/openai/stream' \
    --header 'Content-Type: application/json' \
    --data-raw '{
        "input": {
            "topic": "ç‹—"
        }
    }'
```

#### ç«¯ç‚¹

ä»¥ä¸‹ä»£ç ï¼š

```
...
add_routes(
    app,
    runnable,
    path="/my_runnable",
)
```

å°†ä»¥ä¸‹ç«¯ç‚¹æ·»åŠ åˆ°æœåŠ¡å™¨ï¼š

- POST /my_runnable/invoke - å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¯è¿è¡Œé¡¹
- POST /my_runnable/batch - å¯¹ä¸€æ‰¹è¾“å…¥è°ƒç”¨å¯è¿è¡Œé¡¹
- POST /my_runnable/stream - å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¹¶æµå¼ä¼ è¾“è¾“å‡º
- POST /my_runnable/stream_log - å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¹¶æµå¼ä¼ è¾“è¾“å‡ºï¼Œ

åŒ…æ‹¬ç”Ÿæˆçš„ä¸­é—´æ­¥éª¤çš„è¾“å‡º

- POST /my_runnable/astream_events - å¯¹å•ä¸ªè¾“å…¥è°ƒç”¨å¹¶åœ¨ç”Ÿæˆæ—¶æµå¼ä¼ è¾“äº‹ä»¶ï¼Œ

åŒ…æ‹¬æ¥è‡ªä¸­é—´æ­¥éª¤çš„äº‹ä»¶ã€‚

- GET /my_runnable/input_schema - å¯è¿è¡Œé¡¹çš„è¾“å…¥çš„ JSON æ¨¡å¼
- GET /my_runnable/output_schema - å¯è¿è¡Œé¡¹çš„è¾“å‡ºçš„ JSON æ¨¡å¼
- GET /my_runnable/config_schema - å¯è¿è¡Œé¡¹çš„é…ç½®çš„ JSON æ¨¡å¼

è¿™äº›ç«¯ç‚¹ä¸LangChain è¡¨è¾¾å¼è¯­è¨€æ¥å£ç›¸åŒ¹é… 

## LangChain æœåŠ¡ç›‘æ§

ä¸æ„å»ºä»»ä½•ç±»å‹çš„è½¯ä»¶ä¸€æ ·ï¼Œä½¿ç”¨LLMæ„å»ºæ—¶ï¼Œæ€»ä¼šæœ‰è°ƒè¯•çš„éœ€æ±‚ã€‚æ¨¡å‹è°ƒç”¨å¯èƒ½ä¼šå¤±è´¥ï¼Œæ¨¡å‹è¾“å‡ºå¯èƒ½æ ¼å¼é”™è¯¯ï¼Œæˆ–è€…å¯èƒ½å­˜åœ¨ä¸€äº›åµŒå¥—çš„æ¨¡å‹è°ƒç”¨ï¼Œä¸æ¸…æ¥šåœ¨

å“ªä¸€æ­¥å‡ºç°äº†é”™è¯¯çš„è¾“å‡ºã€‚ æœ‰ä¸‰ç§ä¸»è¦çš„è°ƒè¯•æ–¹æ³•ï¼š

- è¯¦ç»†æ¨¡å¼(Verbose)ï¼šä¸ºä½ çš„é“¾ä¸­çš„â€œé‡è¦â€äº‹ä»¶æ·»åŠ æ‰“å°è¯­å¥ã€‚
- è°ƒè¯•æ¨¡å¼(Debug)ï¼šä¸ºä½ çš„é“¾ä¸­çš„æ‰€æœ‰äº‹ä»¶æ·»åŠ æ—¥å¿—è®°å½•è¯­å¥ã€‚
- LangSmithè·Ÿè¸ªï¼šå°†äº‹ä»¶è®°å½•åˆ°LangSmithï¼Œä»¥ä¾¿åœ¨é‚£é‡Œè¿›è¡Œå¯è§†åŒ–ã€‚

| è¯¦ç»†æ¨¡å¼(Verbose Mode) | è°ƒè¯•æ¨¡å¼(Debug Mode) | LangSmithè·Ÿè¸ª |
| ---------------------- | -------------------- | ------------- |
| âœ…                      | âœ…                    | âœ…             |
| âŒ                      | âŒ                    | âœ…             |
| âŒ                      | âŒ                    | âœ…             |
| âŒ                      | âœ…                    | âœ…             |
| âœ…                      | âŒ                    | âœ…             |
| âœ…                      | âœ…                    | âŒ             |

### LangSmith Tracing(è·Ÿè¸ª)

ä½¿ç”¨LangChainæ„å»ºçš„è®¸å¤šåº”ç”¨ç¨‹åºå°†åŒ…å«å¤šä¸ªæ­¥éª¤ï¼Œå…¶ä¸­åŒ…å«å¤šæ¬¡LLMè°ƒç”¨ã€‚ éšç€è¿™äº›åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œèƒ½å¤Ÿæ£€æŸ¥é“¾æˆ–ä»£ç†å†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆå˜å¾—è‡³å…³é‡

è¦ã€‚ è¿™æ ·åšçš„æœ€ä½³æ–¹å¼æ˜¯ä½¿ç”¨LangSmithã€‚ åœ¨ä¸Šé¢çš„é“¾æ¥ä¸Šæ³¨å†Œåï¼Œè¯·ç¡®ä¿è®¾ç½®ä½ çš„ç¯å¢ƒå˜é‡ä»¥å¼€å§‹è®°å½•è·Ÿè¸ªï¼š

LangSmithå®˜ç½‘ï¼šhttps://smith.langchain.com/

tavilyå®˜ç½‘ï¼šhttps://tavily.com/

```
#windowså¯¼å…¥ç¯å¢ƒå˜é‡
#é…ç½®LangSmith ç›‘æ§å¼€å…³ï¼Œtrueå¼€å¯ï¼Œfalseå…³é—­
setx LANGCHAIN_TRACING_V2 "true"
#é…ç½® LangSmith api key
setx LANGCHAIN_API_KEY "..."
#é…ç½® taily api key
setx TAVILY_API_KEY "..."

#mac å¯¼å…¥ç¯å¢ƒå˜é‡
export LANGCHAIN_TRACING_V2="true"
export LANGCHAIN_API_KEY="..."
export TAVILY_API_KEY="..."
```

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»£ç†ï¼Œå¹¶ä¸”å¸Œæœ›å¯è§†åŒ–å®ƒæ‰€é‡‡å–çš„æ“ä½œå’Œæ¥æ”¶åˆ°çš„å·¥å…·è¾“å‡ºã€‚åœ¨æ²¡æœ‰ä»»ä½•è°ƒè¯•çš„æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ï¼š

```
import os
from langchain_openai import ChatOpenAI
from langchain.agents import AgentExecutor, create_tool_calling_agent
from langchain_community.tools.tavily_search import TavilySearchResults
from langchain_core.prompts import ChatPromptTemplate
from langchain.globals import set_verbose

llm = ChatOpenAI(model="gpt-4o")
tools = [TavilySearchResults(max_results=1)]
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)
# æ„å»ºå·¥å…·ä»£ç†
agent = create_tool_calling_agent(llm, tools, prompt)
set_verbose(True)
# é€šè¿‡ä¼ å…¥ä»£ç†å’Œå·¥å…·æ¥åˆ›å»ºä»£ç†æ‰§è¡Œå™¨
agent_executor = AgentExecutor(agent=agent, tools=tools)
agent_executor.invoke(
    {"input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"}
)
```

```
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': 'å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ã€‚æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```

æˆ‘ä»¬æ²¡æœ‰å¾—åˆ°å¤ªå¤šè¾“å‡ºï¼Œä½†ç”±äºæˆ‘ä»¬è®¾ç½®äº†LangSmithï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°çœ‹åˆ°å‘ç”Ÿäº†ä»€ä¹ˆ

### Verbose(è¯¦ç»†æ—¥å¿—æ‰“å°)

æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ä»¥ä¸åŒç¨‹åº¦çš„è¯¦ç»†ç¨‹åº¦å¯ç”¨æ‰“å°ã€‚ æ³¨æ„ï¼šå³ä½¿å¯ç”¨äº†LangSmithï¼Œè¿™äº›ä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤ä½ å¯ä»¥åŒæ—¶æ‰“å¼€å¹¶è¿è¡Œå®ƒä»¬ã€‚

set_verbose(True)

è®¾ç½® verbose æ ‡å¿—å°†ä»¥ç¨å¾®æ›´æ˜“è¯»çš„æ ¼å¼æ‰“å°å‡ºè¾“å…¥å’Œè¾“å‡ºï¼Œå¹¶å°†è·³è¿‡è®°å½•æŸäº›åŸå§‹è¾“å‡ºï¼ˆä¾‹å¦‚ LLM è°ƒç”¨çš„ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ï¼‰ï¼Œå¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºé€»è¾‘ã€‚

```python
from langchain.agents import AgentExecutor, create_openai_functions_agent
from langchain.globals import set_verbose
from langchain_community.tools import TavilySearchResults
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI

set_verbose(True)
llm = ChatOpenAI(
    temperature=0,
    model="gpt-4o",
    base_url="********"
    api_key="********"
)
tools = [TavilySearchResults(tavily_api_key="********", max_results=1)]
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)
# æ„å»ºå·¥å…·ä»£ç†
agent = create_openai_functions_agent(llm, tools, prompt)
agent_executor = AgentExecutor(agent=agent, tools=tools)
response = agent_executor.invoke(
    {
        "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
    }
)
print(response)
```

```
> Entering new AgentExecutor chain...
The 2023 film "Oppenheimer" was directed by Christopher Nolan. Christopher Nolan was born on July 30, 1970. To calculate his age in days as of today, we need to determine the number of days from his birth date to the current date.

Let's calculate: 

1. From July 30, 1970, to July 30, 2023, is 53 years.
2. From July 30, 2023, to today (assuming today is October 5, 2023), is 67 days.

Now, calculate the total number of days:

- 53 years = 53 * 365 = 19,345 days
- Account for leap years: There are 13 leap years between 1970 and 2023 (1972, 1976, 1980, 1984, 1988, 1992, 1996, 2000, 2004, 2008, 2012, 2016, 2020), adding 13 days.

Total days = 19,345 + 13 + 67 = 19,425 days

Christopher Nolan is 19,425 days old as of October 5, 2023.

> Finished chain.
```

```
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': '2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°ï¼ˆChristopher Nolanï¼‰æ‰§å¯¼çš„ã€‚å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ï¼Œå› æ­¤æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```

### Debug(è°ƒè¯•æ—¥å¿—æ‰“å°)

set_debug(True)

è®¾ç½®å…¨å±€çš„ debug æ ‡å¿—å°†å¯¼è‡´æ‰€æœ‰å…·æœ‰å›è°ƒæ”¯æŒçš„ LangChain ç»„ä»¶ï¼ˆé“¾ã€æ¨¡å‹ã€ä»£ç†ã€å·¥å…·ã€æ£€ç´¢å™¨ï¼‰æ‰“å°å®ƒä»¬æ¥æ”¶çš„è¾“å…¥å’Œç”Ÿæˆçš„è¾“å‡ºã€‚è¿™æ˜¯æœ€è¯¦ç»†çš„è®¾ç½®ï¼Œ

å°†å®Œå…¨è®°å½•åŸå§‹è¾“å…¥å’Œè¾“å‡ºã€‚

```python
from langchain.agents import AgentExecutor, create_openai_functions_agent
from langchain.globals import set_verbose, set_debug
from langchain_community.tools import TavilySearchResults
from langchain_core.prompts import ChatPromptTemplate
from langchain_openai import ChatOpenAI

#æ‰“å°è°ƒè¯•æ—¥å¿—
set_debug(True)
#ä¸è¾“å‡ºè¯¦ç»†æ—¥å¿—
set_verbose(False)
llm = ChatOpenAI(
    temperature=0,
    model="gpt-4o",
    base_url="http://10.255.4.108:8080/v1",  # æ ¹æ®ä½ çš„å®é™…APIè·¯å¾„ç¡®è®¤æ˜¯å¦åŠ  /v1
    api_key="sk-3BEJwQPhsyVSzDW2C963Af69A6Bf4b608810Dd78E2Bb4452"  # å³ä½¿æ˜¯å‡çš„ï¼Œä¹Ÿè¦ä¼ 
)
tools = [TavilySearchResults(tavily_api_key="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", max_results=1)]
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚",
        ),
        ("placeholder", "{chat_history}"),
        ("human", "{input}"),
        ("placeholder", "{agent_scratchpad}"),
    ]
)
# æ„å»ºå·¥å…·ä»£ç†
agent = create_openai_functions_agent(llm, tools, prompt)
agent_executor = AgentExecutor(agent=agent, tools=tools)
response = agent_executor.invoke(
    {
        "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
    }
)
print(response)
```

```
[chain/start] [chain:AgentExecutor] Entering Chain run with input:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] Entering Chain run with input:
{
  "input": ""
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] Entering Chain run with input:
{
  "input": ""
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad> > chain:RunnableLambda] [0ms] Exiting Chain run with output:
{
  "output": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad> > chain:RunnableParallel<agent_scratchpad>] [1ms] Exiting Chain run with output:
{
  "agent_scratchpad": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > chain:RunnableAssign<agent_scratchpad>] [1ms] Exiting Chain run with output:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ",
  "intermediate_steps": [],
  "agent_scratchpad": []
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] Entering Prompt run with input:
{
  "input": "è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ",
  "intermediate_steps": [],
  "agent_scratchpad": []
}
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > prompt:ChatPromptTemplate] [1ms] Exiting Prompt run with output:
[outputs]
[llm/start] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] Entering LLM run with input:
{
  "prompts": [
    "System: ä½ æ˜¯ä¸€ä½å¾—åŠ›çš„åŠ©æ‰‹ã€‚\nHuman: è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ"
  ]
}
[llm/end] [chain:AgentExecutor > chain:RunnableSequence > llm:ChatOpenAI] [2.44s] Exiting LLM run with output:
{
  "generations": [
    [
      {
        "generation_info": {
          "finish_reason": "stop",
          "model_name": "gpt-4o"
        },
        "type": "ChatGenerationChunk",
        "message": {
          "lc": 1,
          "type": "constructor",
          "id": [
            "langchain",
            "schema",
            "messages",
            "AIMessageChunk"
          ],
          "kwargs": {
            "content": "2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‰§å¯¼çš„ã€‚å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ï¼Œå› æ­¤æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚",
            "response_metadata": {
              "finish_reason": "stop",
              "model_name": "gpt-4o"
            },
            "type": "AIMessageChunk",
            "id": "run--96ccc765-934b-4d52-9ab0-de8664a58cb6",
            "tool_calls": [],
            "invalid_tool_calls": []
          }
        },
        "text": "2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‰§å¯¼çš„ã€‚å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ï¼Œå› æ­¤æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚"
      }
    ]
  ],
  "llm_output": null,
  "run": null,
  "type": "LLMResult"
}
[chain/start] [chain:AgentExecutor > chain:RunnableSequence > parser:OpenAIFunctionsAgentOutputParser] Entering Parser run with input:
[inputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence > parser:OpenAIFunctionsAgentOutputParser] [0ms] Exiting Parser run with output:
[outputs]
[chain/end] [chain:AgentExecutor > chain:RunnableSequence] [2.45s] Exiting Chain run with output:
[outputs]
[chain/end] [chain:AgentExecutor] [2.45s] Exiting Chain run with output:
{
  "output": "2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‰§å¯¼çš„ã€‚å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ï¼Œå› æ­¤æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚"
}
```

```
{'input': 'è°æ‰§å¯¼äº†2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹ï¼Œä»–å¤šå°‘å²äº†ï¼Ÿ', 'output': '2023å¹´çš„ç”µå½±ã€Šå¥¥æœ¬æµ·é»˜ã€‹æ˜¯ç”±å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°æ‰§å¯¼çš„ã€‚å…‹é‡Œæ–¯æ‰˜å¼—Â·è¯ºå…°å‡ºç”Ÿäº1970å¹´7æœˆ30æ—¥ï¼Œå› æ­¤æˆªè‡³2023å¹´ï¼Œä»–53å²ã€‚'}
```

# LangChainæ¶ˆæ¯ç®¡ç†ä¸èŠå¤©å†å²å­˜å‚¨

## æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜

ä¸‹é¢å±•ç¤ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå…¶ä¸­èŠå¤©å†å²ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ­¤å¤„é€šè¿‡å…¨å±€ Python å­—å…¸å®ç°ã€‚

æ„å»ºä¸€ä¸ªåä¸º get_session_history çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œå¼•ç”¨æ­¤å­—å…¸ä»¥è¿”å› ChatMessageHistory å®ä¾‹ã€‚é€šè¿‡åœ¨è¿è¡Œæ—¶å‘ RunnableWithMessageHistory ä¼ é€’é…ç½®ï¼Œå¯

ä»¥æŒ‡å®šå¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœŸæœ›é…ç½®å‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² session_idã€‚å¯ä»¥é€šè¿‡ history_factory_config å…³é”®å­—å‚æ•°è¿›è¡Œè°ƒæ•´ã€‚

ä½¿ç”¨å•å‚æ•°é»˜è®¤å€¼ï¼š

```python
#chat_history_memory.py
from langchain_core.chat_history import BaseChatMessageHistory
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain_core.runnables import RunnableWithMessageHistory
from langchain_openai import ChatOpenAI

prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "You're an assistant who's good at {ability}."
        ),
        MessagesPlaceholder(variable_name="history"),
        ("human", "{input}")
    ]
)

model = ChatOpenAI(
    temperature=0,
    model="gpt-4o",
    base_url="********",
    api_key="********"
)

runnable = prompt | model
store = {}

def get_session_history(session_id: str) -> BaseChatMessageHistory:
    if session_id not in store:
        store[session_id] = ChatMessageHistory()
    return store[session_id]

with_message_history = RunnableWithMessageHistory(
    runnable,
    get_session_history,
    input_messages_key="input",
    history_messages_key="history",
)
```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²æŒ‡å®šäº† `input_messages_key`ï¼ˆè¦è§†ä¸ºæœ€æ–°è¾“å…¥æ¶ˆæ¯çš„é”®ï¼‰å’Œ `history_messages_key`ï¼ˆè¦æ·»åŠ å†å²æ¶ˆæ¯çš„é”®ï¼‰ã€‚åœ¨è°ƒç”¨æ­¤æ–° Runnable æ—¶ï¼Œæˆ‘

ä»¬é€šè¿‡é…ç½®å‚æ•°æŒ‡å®šç›¸åº”çš„èŠå¤©å†å²ï¼š 

```python
response = with_message_history.invoke(
    {"ability": "math", "input": "æ¬§å¼è·ç¦»æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"},
    config={"configurable": {"session_id": "abc123"}}
)

print(response)
```

```
content='æ¬§å¼è·ç¦»ï¼ˆEuclidean distanceï¼‰æ˜¯æŒ‡åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­ä¸¤ç‚¹ä¹‹é—´çš„ç›´çº¿è·ç¦»ã€‚å®ƒæ˜¯æœ€å¸¸ç”¨çš„è·ç¦»åº¦é‡ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨äºŒç»´å’Œä¸‰ç»´ç©ºé—´ä¸­ã€‚å¯¹äºä¸¤ä¸ªç‚¹ \\( A(x_1, y_1) \\) å’Œ \\( B(x_2, y_2) \\) åœ¨äºŒç»´ç©ºé—´ä¸­çš„æ¬§å¼è·ç¦»ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š\n\n\\[\nd(A, B) = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}\n\\]\n\nåœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œè‹¥ç‚¹ \\( A(x_1, y_1, z_1) \\) å’Œ \\( B(x_2, y_2, z_2) \\)ï¼Œåˆ™æ¬§å¼è·ç¦»ä¸ºï¼š\n\n\\[\nd(A, B) = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2 + (z_2 - z_1)^2}\n\\]\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äº \\( n \\) ç»´ç©ºé—´ä¸­çš„ä¸¤ä¸ªç‚¹ \\( A(x_1, x_2, \\ldots, x_n) \\) å’Œ \\( B(y_1, y_2, \\ldots, y_n) \\)ï¼Œæ¬§å¼è·ç¦»å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n\n\\[\nd(A, B) = \\sqrt{\\sum_{i=1}^{n} (y_i - x_i)^2}\n\\]\n\næ¬§å¼è·ç¦»åœ¨è®¸å¤šé¢†åŸŸä¸­éƒ½æœ‰åº”ç”¨ï¼ŒåŒ…æ‹¬å‡ ä½•å­¦ã€ç‰©ç†å­¦ã€æœºå™¨å­¦ä¹ å’Œæ•°æ®åˆ†æç­‰ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€å•è€Œç›´è§‚çš„æ–¹å¼æ¥è¡¡é‡ç‚¹ä¸ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 350, 'prompt_tokens': 24, 'total_tokens': 374, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-Bek212OUcCzw6Hu3eGxqzkvCRGzkr', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--a35da706-10c0-47d0-bb47-424d993bc129-0' usage_metadata={'input_tokens': 24, 'output_tokens': 350, 'total_tokens': 374, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

```
response = with_message_history.invoke(
    {"ability": "math", "input": "æˆ‘åˆšåˆšé—®äº†ä»€ä¹ˆ"},
    config={"configurable": {"session_id": "abc123"}}
)

print(response)
```

```
content='ä½ åˆšåˆšé—®çš„æ˜¯â€œæ¬§å¼è·ç¦»æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿâ€' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 12, 'prompt_tokens': 397, 'total_tokens': 409, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-Bek45OkEcBkapwBqzyeKwmagzxaeG', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--48378fd7-f90a-4f0b-b6b5-decd4885cec5-0' usage_metadata={'input_tokens': 397, 'output_tokens': 12, 'total_tokens': 409, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

```
response = with_message_history.invoke(
    {"ability": "math", "input": "æˆ‘åˆšåˆšé—®äº†ä»€ä¹ˆ"},
    config={"configurable": {"session_id": "abc124"}}
)

print(response)
```

```
content='æŠ±æ­‰ï¼Œæˆ‘æ— æ³•çŸ¥é“ä½ ä¹‹å‰é—®äº†ä»€ä¹ˆã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 25, 'total_tokens': 50, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-Bek5Dg1vGcaQvnBuTublxEXBR9dwA', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--dd87f3ad-66df-4d3f-a6b2-ff61424a6e90-0' usage_metadata={'input_tokens': 25, 'output_tokens': 25, 'total_tokens': 50, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

## é…ç½®ä¼šè¯å”¯ä¸€é”®

å¯ä»¥é€šè¿‡å‘ `history_factory_config` å‚æ•°ä¼ é€’ä¸€ä¸ª `ConfigurableFieldSpec` å¯¹è±¡åˆ—è¡¨æ¥è‡ªå®šä¹‰è·Ÿè¸ªæ¶ˆæ¯å†å²çš„é…ç½®å‚æ•°ã€‚ä¸‹é¢ä½¿ç”¨äº†ä¸¤ä¸ªå‚æ•°ï¼š`user_id` 

å’Œ `conversation_id`ã€‚

é…ç½®user_idå’Œconversation_idä½œä¸ºä¼šè¯å”¯ä¸€é”®

```python
from langchain_core.runnables import ConfigurableFieldSpec
def get_session_history(user_id: str, conversation_id: str) -> BaseChatMessageHistory:
    if (user_id, conversation_id)not in store:
        store[(user_id, conversation_id)] = ChatMessageHistory()
    return store[(user_id, conversation_id)]

with_message_history = RunnableWithMessageHistory(
    runnable,
    get_session_history,
    input_messages_key="input",
    history_messages_key="history",
    history_factory_config=[
        ConfigurableFieldSpec(
            id="user_id",
            annotation=str,
            name="User ID",
            description="ç”¨æˆ·å”¯ä¸€æ ‡è¯†",
            default="",
            is_shared=True
        ),
        ConfigurableFieldSpec(
            id="conversation_id",
            annotation=str,
            name="Conversation ID",
            description="å¯¹è¯å”¯ä¸€æ ‡è¯†",
            default="",
            is_shared=True
        )
    ]
)

response = with_message_history.invoke(
{"ability": "math", "input": "æ¬§å¼è·ç¦»æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"},
    config={"configurable": {"user_id": "abc123", "conversation_id": "abc123"}}
)

print(response)

response = with_message_history.invoke(
{"ability": "math", "input": "æˆ‘åˆšåˆšé—®äº†ä»€ä¹ˆï¼Ÿ"},
    config={"configurable": {"user_id": "abc123", "conversation_id": "abc124"}}
)

print(response)
```

```
content='æ¬§å¼è·ç¦»ï¼ˆEuclidean distanceï¼‰æ˜¯æŒ‡åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­ä¸¤ç‚¹ä¹‹é—´çš„ç›´çº¿è·ç¦»ã€‚å®ƒæ˜¯æœ€å¸¸ç”¨çš„è·ç¦»åº¦é‡ä¹‹ä¸€ï¼Œå°¤å…¶åœ¨äºŒç»´å’Œä¸‰ç»´ç©ºé—´ä¸­ã€‚å¯¹äºä¸¤ä¸ªç‚¹ \\( A(x_1, y_1) \\) å’Œ \\( B(x_2, y_2) \\) åœ¨äºŒç»´ç©ºé—´ä¸­çš„æ¬§å¼è·ç¦»ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—ï¼š\n\n\\[\nd(A, B) = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}\n\\]\n\nåœ¨ä¸‰ç»´ç©ºé—´ä¸­ï¼Œè‹¥ç‚¹ \\( A \\) å’Œ \\( B \\) çš„åæ ‡åˆ†åˆ«ä¸º \\( (x_1, y_1, z_1) \\) å’Œ \\( (x_2, y_2, z_2) \\)ï¼Œåˆ™æ¬§å¼è·ç¦»çš„è®¡ç®—å…¬å¼ä¸ºï¼š\n\n\\[\nd(A, B) = \\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2 + (z_2 - z_1)^2}\n\\]\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äº \\( n \\) ç»´ç©ºé—´ä¸­çš„ä¸¤ä¸ªç‚¹ \\( A(x_1, x_2, \\ldots, x_n) \\) å’Œ \\( B(y_1, y_2, \\ldots, y_n) \\)ï¼Œæ¬§å¼è·ç¦»å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n\n\\[\nd(A, B) = \\sqrt{\\sum_{i=1}^{n} (y_i - x_i)^2}\n\\]\n\næ¬§å¼è·ç¦»åæ˜ äº†ä¸¤ç‚¹ä¹‹é—´çš„â€œæœ€çŸ­è·¯å¾„â€ï¼Œå³ç›´çº¿è·ç¦»ã€‚å®ƒåœ¨è®¸å¤šé¢†åŸŸä¸­éƒ½æœ‰åº”ç”¨ï¼ŒåŒ…æ‹¬å‡ ä½•å­¦ã€ç‰©ç†å­¦ã€æœºå™¨å­¦ä¹ å’Œæ•°æ®åˆ†æç­‰ã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 365, 'prompt_tokens': 24, 'total_tokens': 389, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BekBU8ldfKMz3RMHo6lKdFvxZKDL4', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--59d5c17e-9fa6-403f-a4d2-b5c38ab9ba09-0' usage_metadata={'input_tokens': 24, 'output_tokens': 365, 'total_tokens': 389, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
content='æŠ±æ­‰ï¼Œæˆ‘æ— æ³•çŸ¥é“ä½ ä¹‹å‰é—®äº†ä»€ä¹ˆï¼Œå› ä¸ºæˆ‘æ— æ³•è®¿é—®è¿‡å»çš„å¯¹è¯è®°å½•ã€‚å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 26, 'total_tokens': 60, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BekD6PRj3UYGsQASc0zLzMluJJixy', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--9ad9bada-6bb7-4392-ad55-f9d1aaf1fb94-0' usage_metadata={'input_tokens': 26, 'output_tokens': 34, 'total_tokens': 60, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}

```

åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼ŒæŒä¹…åŒ–å¯¹è¯å†å²æ˜¯å¯å–çš„ã€‚`RunnableWithMessageHistory` å¯¹äº `get_session_history` å¯è°ƒç”¨å¦‚ä½•æ£€ç´¢å…¶èŠå¤©æ¶ˆæ¯å†å²æ˜¯ä¸­ç«‹çš„ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ç¤ºä¾‹ã€‚ä¸‹é¢æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Redisã€‚ä»¥è·å–ä½¿ç”¨å…¶ä»–æä¾›ç¨‹åºçš„èŠå¤©æ¶ˆæ¯å†å²çš„å®ç°ã€‚

## æ¶ˆæ¯æŒä¹…åŒ–

è¯·æŸ¥çœ‹ [memory integrations](https://integrations.langchain.com/memory) é¡µé¢ï¼Œäº†è§£ä½¿ç”¨ Redis å’Œå…¶ä»–æä¾›ç¨‹åºå®ç°èŠå¤©æ¶ˆæ¯å†å²çš„æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä½¿ç”¨å†…å­˜ä¸­çš„ `ChatMessageHistory` ä»¥åŠä½¿ç”¨ ã€

`RedisChatMessageHistory` è¿›è¡Œæ›´æŒä¹…å­˜å‚¨ã€‚

### è°ƒç”¨èŠå¤©æ¥å£ï¼Œçœ‹Redisæ˜¯å¦å­˜å‚¨å†å²è®°å½•

æ›´æ–°æ¶ˆæ¯å†å²å®ç°åªéœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡ï¼Œè¿™æ¬¡è¿”å›ä¸€ä¸ª `RedisChatMessageHistory` å®ä¾‹ï¼š

```python
from langchain_community.chat_message_histories import RedisChatMessageHistory
def get_messages_history(session_id: str) -> BaseChatMessageHistory:
    return RedisChatMessageHistory(session_id, url="")

with_message_history = RunnableWithMessageHistory(
    runnable,
    get_messages_history,
    input_messages_key="input",
    history_messages_key="history",
)
```

```
response = with_message_history.invoke(
    {"ability": "math", "input": "æˆ‘åˆšåˆšé—®äº†ä»€ä¹ˆï¼Ÿ"},
    config={"configurable": {"session_id": "abc124"}}
)

print(response)
```

```
content='ä½™å¼¦æ˜¯ä¸€ä¸ªæ•°å­¦æœ¯è¯­ï¼Œä»£è¡¨åœ¨ä¸€ä¸ªè§’åº¦ä¸‹çš„é‚»è¾¹å’Œæ–œè¾¹çš„æ¯”ä¾‹ã€‚' response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 83, 'total_tokens': 115}, 'model_name': 'gpt-4-0613', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run-99368d03-c2ed-4dda-a32f-677c036ad676-0' usage_metadata={'input_tokens': 83, 'output_tokens': 32, 'total_tokens': 115}
```

## ä¿®æ”¹èŠå¤©å†å²

ä¿®æ”¹å­˜å‚¨çš„èŠå¤©æ¶ˆæ¯å¯ä»¥å¸®åŠ©èŠå¤©æœºå™¨äººå¤„ç†å„ç§æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š

### è£å‰ªæ¶ˆæ¯

LLM å’ŒèŠå¤©æ¨¡å‹æœ‰é™çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œå³ä½¿æ‚¨æ²¡æœ‰ç›´æ¥è¾¾åˆ°é™åˆ¶ï¼Œæ‚¨å¯èƒ½ä¹Ÿå¸Œæœ›é™åˆ¶æ¨¡å‹å¤„ç†çš„å¹²æ‰°é‡ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯åªåŠ è½½å’Œå­˜å‚¨æœ€è¿‘çš„ `n` æ¡æ¶ˆæ¯ã€‚ä½¿

ç”¨ä¸€ä¸ªå¸¦æœ‰ä¸€äº›é¢„åŠ è½½æ¶ˆæ¯çš„ç¤ºä¾‹å†å²è®°å½•ï¼š

```python
temp_chat_history = ChatMessageHistory()
temp_chat_history.add_user_message("æˆ‘å«zsï¼Œä½ å¥½")
temp_chat_history.add_ai_message("ä½ å¥½")
temp_chat_history.add_user_message("æˆ‘ä»Šå¤©å¤´å¾ˆç–¼")
temp_chat_history.add_ai_message("ä½ ä»Šå¤©èº«ä½“æ€ä¹ˆæ ·")
temp_chat_history.add_user_message("æˆ‘ä¸‹åˆåœ¨ä¸Šç­")
temp_chat_history.add_ai_message("ä½ ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ")
print(temp_chat_history.messages)
```

```
[HumanMessage(content='æˆ‘å«zsï¼Œä½ å¥½', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ å¥½', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä»Šå¤©å¤´å¾ˆç–¼', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä»Šå¤©èº«ä½“æ€ä¹ˆæ ·', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä¸‹åˆåœ¨ä¸Šç­', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ', additional_kwargs={}, response_metadata={})]
```

å°†è¿™ä¸ªæ¶ˆæ¯å†å²ä¸ä¸Šé¢å£°æ˜çš„ RunnableWithMessageHistory é“¾æ¡ä¸€èµ·ä½¿ç”¨ï¼š

```python
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚å°½åŠ›å›ç­”æ‰€æœ‰é—®é¢˜ã€‚æä¾›çš„èŠå¤©å†å²åŒ…å«ä½ å’Œç”¨æˆ·èŠçš„æ‰€æœ‰äº‹å®"
        ),
        MessagesPlaceholder(variable_name="chat_history"),
        ("human", "{input}")
    ]
)

chain = prompt | model

chat_with_message_history = RunnableWithMessageHistory(
    chain,
    lambda session_id: temp_chat_history,
    input_messages_key="input",
    history_messages_key="chat_history",
)

response = chat_with_message_history.invoke(
    {"input": "æˆ‘ä»Šå¤©èº«ä½“æ€ä¹ˆæ ·ï¼Ÿ"},
    config={"configurable": {"session_id": "unused"}}
)

print(response)
```

```
content='ä½ æåˆ°è¿‡ä»Šå¤©å¤´å¾ˆç–¼ã€‚å¸Œæœ›ä½ èƒ½å°½å¿«å¥½èµ·æ¥ã€‚å¦‚æœå¤´ç—›æŒç»­æˆ–åŠ é‡ï¼Œå»ºè®®å’¨è¯¢åŒ»ç”Ÿã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 92, 'total_tokens': 121, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BetqDGjVSXqLqTfMyDsEYRrUrDzQ7', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--3d52a050-d42a-4760-8d87-c35fdcb6bc39-0' usage_metadata={'input_tokens': 92, 'output_tokens': 29, 'total_tokens': 121, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

å¯ä»¥çœ‹åˆ°é“¾æ¡è®°ä½äº†é¢„åŠ è½½çš„ä¿¡æ¯ã€‚ä½†æ˜¯å‡è®¾æœ‰ä¸€ä¸ªéå¸¸å°çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œå¹¶ä¸”æƒ³è¦å°†ä¼ é€’ç»™é“¾çš„æ¶ˆæ¯æ•°é‡å‡å°‘åˆ°æœ€è¿‘çš„2æ¡ã€‚å¯ä»¥ä½¿ç”¨ `clear` æ–¹æ³•æ¥åˆ é™¤æ¶ˆæ¯ï¼Œ

å¹¶é‡æ–°å°†å®ƒä»¬æ·»åŠ åˆ°å†å²è®°å½•ä¸­ã€‚

```python
from langchain_core.runnables import RunnablePassthrough
def trim_messages(chain_input):
    stored_messages = temp_chat_history.messages
    if len(stored_messages) <= 2:
        return False
    temp_chat_history.clear()
    for message in stored_messages[2:]:
        temp_chat_history.add_message(message)
    return True

chat_with_trimming = (
    RunnablePassthrough.assign(messages_trimmed=trim_messages) | chat_with_message_history
)
```

```python
response = chat_with_trimming.invoke(
    {"input": "æˆ‘ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ? "},
    config={"configurable": {"session_id": "unused"}}
)

print(response)
```

```python
content='ä½ æåˆ°è¿‡ä½ ä¸‹åˆåœ¨ä¸Šç­ã€‚å¦‚æœå¤´ç–¼å½±å“åˆ°ä½ çš„å·¥ä½œï¼Œå»ºè®®ä½ å¯ä»¥å°è¯•ä¼‘æ¯ä¸€ä¸‹ï¼Œå–ç‚¹æ°´ï¼Œæˆ–è€…ç¨å¾®æ´»åŠ¨ä¸€ä¸‹èº«ä½“ã€‚å¦‚æœå¤´ç–¼æŒç»­æˆ–åŠ é‡ï¼Œæœ€å¥½å’¨è¯¢åŒ»ç”Ÿä»¥è·å¾—ä¸“ä¸šå»ºè®®ã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 53, 'prompt_tokens': 80, 'total_tokens': 133, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeuKO9XP4B0KBkwmDIFJNtMc8GzKK', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--c0dba340-cc35-478e-ac48-1cf7c191d9cc-0' usage_metadata={'input_tokens': 80, 'output_tokens': 53, 'total_tokens': 133, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

```python
print(temp_chat_history.messages)
```

```python
[HumanMessage(content='æˆ‘ä»Šå¤©å¤´å¾ˆç–¼', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä»Šå¤©èº«ä½“æ€ä¹ˆæ ·', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä¸‹åˆåœ¨ä¸Šç­', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ? ', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ æåˆ°è¿‡ä½ ä¸‹åˆåœ¨ä¸Šç­ã€‚å¦‚æœå¤´ç–¼å½±å“åˆ°ä½ çš„å·¥ä½œï¼Œå»ºè®®ä½ å¯ä»¥å°è¯•ä¼‘æ¯ä¸€ä¸‹ï¼Œå–ç‚¹æ°´ï¼Œæˆ–è€…ç¨å¾®æ´»åŠ¨ä¸€ä¸‹èº«ä½“ã€‚å¦‚æœå¤´ç–¼æŒç»­æˆ–åŠ é‡ï¼Œæœ€å¥½å’¨è¯¢åŒ»ç”Ÿä»¥è·å¾—ä¸“ä¸šå»ºè®®ã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 53, 'prompt_tokens': 80, 'total_tokens': 133, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeuKO9XP4B0KBkwmDIFJNtMc8GzKK', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--c0dba340-cc35-478e-ac48-1cf7c191d9cc-0', usage_metadata={'input_tokens': 80, 'output_tokens': 53, 'total_tokens': 133, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]
```

å¯ä»¥çœ‹åˆ°å†å²è®°å½•å·²ç»åˆ é™¤äº†ä¸¤æ¡æœ€æ—§çš„æ¶ˆæ¯ï¼ŒåŒæ—¶åœ¨æœ«å°¾æ·»åŠ äº†æœ€è¿‘çš„å¯¹è¯ã€‚ä¸‹æ¬¡è°ƒç”¨é“¾æ—¶ï¼Œ`trim_messages` å°†å†æ¬¡è¢«è°ƒç”¨ï¼Œåªæœ‰æœ€è¿‘çš„ä¸¤æ¡æ¶ˆæ¯å°†è¢«ä¼ é€’ç»™

æ¨¡å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€ä¸‹æ¬¡è°ƒç”¨æ—¶æ¨¡å‹å°†å¿˜è®°æˆ‘ä»¬ç»™å®ƒçš„åå­—ï¼š

```python
response = chat_with_trimming.invoke(
    {"input": "æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"},
    config={"configurable": {"session_id": "unused"}}
)

print(response)
```

```python
content='å¯¹ä¸èµ·ï¼Œæˆ‘æ²¡æœ‰å…³äºä½ åå­—çš„ä¿¡æ¯ã€‚å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 19, 'prompt_tokens': 126, 'total_tokens': 145, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeuQHIk5wZbwLTDLvdiAYN2WKaZ83', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--ae1a5b03-59e9-4e58-8dea-6f2772ccb5a5-0' usage_metadata={'input_tokens': 126, 'output_tokens': 19, 'total_tokens': 145, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

```
temp_chat_history.messages
```

```python
[HumanMessage(content='æˆ‘ä¸‹åˆåœ¨ä¸Šç­', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ? ', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ æåˆ°è¿‡ä½ ä¸‹åˆåœ¨ä¸Šç­ã€‚å¦‚æœå¤´ç–¼å½±å“åˆ°ä½ çš„å·¥ä½œï¼Œå»ºè®®ä½ å¯ä»¥å°è¯•ä¼‘æ¯ä¸€ä¸‹ï¼Œå–ç‚¹æ°´ï¼Œæˆ–è€…ç¨å¾®æ´»åŠ¨ä¸€ä¸‹èº«ä½“ã€‚å¦‚æœå¤´ç–¼æŒç»­æˆ–åŠ é‡ï¼Œæœ€å¥½å’¨è¯¢åŒ»ç”Ÿã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 49, 'prompt_tokens': 80, 'total_tokens': 129, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeuR9qfhaS5nZw697HOIH8SOnCZwe', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--e56e7ec7-678f-4f8e-88ce-42764dac2555-0', usage_metadata={'input_tokens': 80, 'output_tokens': 49, 'total_tokens': 129, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), HumanMessage(content='æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ', additional_kwargs={}, response_metadata={}), AIMessage(content='å¯¹ä¸èµ·ï¼Œæˆ‘æ²¡æœ‰å…³äºä½ åå­—çš„ä¿¡æ¯ã€‚å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 19, 'prompt_tokens': 123, 'total_tokens': 142, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeuRBojLZY7ICcVic6BNfIjvQE8Ye', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--f573c9ed-99ba-4993-a56f-35501370e8c5-0', usage_metadata={'input_tokens': 123, 'output_tokens': 19, 'total_tokens': 142, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]
```

### æ€»ç»“è®°å¿†

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å…¶ä»–æ–¹å¼ä½¿ç”¨ç›¸åŒçš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢å¤–çš„LLMè°ƒç”¨æ¥åœ¨è°ƒç”¨é“¾ä¹‹å‰ç”Ÿæˆå¯¹è¯æ‘˜è¦ã€‚è®©æˆ‘ä»¬é‡æ–°åˆ›å»ºæˆ‘ä»¬çš„èŠå¤©

å†å²å’ŒèŠå¤©æœºå™¨äººé“¾ï¼š

```python
temp_chat_history = ChatMessageHistory()
temp_chat_history.add_user_message("æˆ‘å«zsï¼Œä½ å¥½")
temp_chat_history.add_ai_message("ä½ å¥½")
temp_chat_history.add_user_message("æˆ‘ä»Šå¤©å¤´å¾ˆç–¼")
temp_chat_history.add_ai_message("ä½ ä»Šå¤©èº«ä½“æ€ä¹ˆæ ·")
temp_chat_history.add_user_message("æˆ‘ä¸‹åˆåœ¨ä¸Šç­")
temp_chat_history.add_ai_message("ä½ ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ")
```

```
[HumanMessage(content='æˆ‘å«zsï¼Œä½ å¥½', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ å¥½', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä»Šå¤©å¤´å¾ˆç–¼', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä»Šå¤©èº«ä½“æ€ä¹ˆæ ·', additional_kwargs={}, response_metadata={}), HumanMessage(content='æˆ‘ä¸‹åˆåœ¨ä¸Šç­', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ ä¸‹åˆåœ¨å¹²ä»€ä¹ˆ', additional_kwargs={}, response_metadata={})]
```

æˆ‘ä»¬å°†ç¨å¾®ä¿®æ”¹æç¤ºï¼Œè®©LLMæ„è¯†åˆ°å®ƒå°†æ”¶åˆ°ä¸€ä¸ªç®€çŸ­æ‘˜è¦è€Œä¸æ˜¯èŠå¤©å†å²ï¼š

```python
prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            "ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ã€‚å°½åŠ›å›ç­”æ‰€æœ‰é—®é¢˜ã€‚æä¾›çš„èŠå¤©å†å²åŒ…å«ä½ å’Œç”¨æˆ·èŠçš„æ‰€æœ‰äº‹å®"
        ),
        MessagesPlaceholder(variable_name="chat_history"),
        ("human", "{input}")
    ]
)

chain = prompt | model

chat_with_message_history = RunnableWithMessageHistory(
    chain,
    lambda session_id: temp_chat_history,
    input_messages_key="input",
    history_messages_key="chat_history",
)
```

ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¹‹å‰çš„äº¤äº’æ€»ç»“ä¸ºæ‘˜è¦ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™ä¸ªå‡½æ•°æ·»åŠ åˆ°é“¾çš„æœ€å‰é¢ï¼š

```python
def summarize_messages(chain_input):
    stored_messages = temp_chat_history.messages
    if len(stored_messages) == 0:
        return False
    summarization_prompt = ChatPromptTemplate.from_messages(
        [
            MessagesPlaceholder(variable_name="chat_history"),
            (
                "user",
                "å°†ä¸Šè¿°æ‰€æœ‰çš„èŠå¤©ä¿¡æ¯è¿›è¡Œæ€»ç»“ï¼ŒåŒ…å«å¤šä¸ªå…·ä½“ç»†èŠ‚ã€‚"
            )
        ]
    )
    summarization_chain = summarization_prompt | model
    summary_message = summarization_chain.invoke({"chat_history": stored_messages})
    temp_chat_history.clear()
    temp_chat_history.add_message(summary_message)
    return True

chain_with_summarization = (
    RunnablePassthrough.assign(messages_summarized=summarize_messages)  | chat_with_message_history
)
```

```python
response = chain_with_summarization.invoke(
    {"input": "æˆ‘ä¸‹åˆåœ¨å¹²ä»€ä¹ˆï¼Ÿ"},
    config={"configurable": {"session_id": "unused"}}
)

print(response)
```

è¾“å‡ºç»“æœä¸ºï¼š

```
content='æ ¹æ®èŠå¤©å†å²ï¼Œä½ ä¸‹åˆåœ¨ä¸Šç­ã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 10, 'prompt_tokens': 83, 'total_tokens': 93, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeukJeHB96maHEPanuVuSunUBJjez', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--969e765b-5440-4bed-a5fe-134612370232-0' usage_metadata={'input_tokens': 83, 'output_tokens': 10, 'total_tokens': 93, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

æŸ¥çœ‹èŠå¤©å†å²è®°å½•ï¼š

```
temp_chat_history.messages
```

```
[AIMessage(content='åœ¨è¿™æ¬¡å¯¹è¯ä¸­ï¼Œç”¨æˆ·è‡ªæˆ‘ä»‹ç»ä¸ºâ€œzsâ€ï¼Œå¹¶è¡¨ç¤ºä»Šå¤©å¤´ç–¼ã€‚ç”¨æˆ·è¿˜æåˆ°ä¸‹åˆè¦ä¸Šç­ã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 71, 'total_tokens': 102, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeulkjAorrzLvULZKoTCiks5PHuUZ', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--a6d166b7-a04b-4e84-9c3c-5ec755ca823d-0', usage_metadata={'input_tokens': 71, 'output_tokens': 31, 'total_tokens': 102, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), HumanMessage(content='æˆ‘ä¸‹åˆåœ¨å¹²ä»€ä¹ˆï¼Ÿ', additional_kwargs={}, response_metadata={}), AIMessage(content='æ ¹æ®èŠå¤©å†å²ï¼Œä½ ä¸‹åˆè¦ä¸Šç­ã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 10, 'prompt_tokens': 78, 'total_tokens': 88, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeulmOK96SNl0trdszMZN1l2Q3GKH', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--b706b385-f923-4ee7-bfba-3c98f45e3fa8-0', usage_metadata={'input_tokens': 78, 'output_tokens': 10, 'total_tokens': 88, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]
```

å†æ¬¡è°ƒç”¨

```python
response = chain_with_summarization.invoke(
    {"input": "æˆ‘ä¸‹åˆä¸æƒ³ä¸Šç­è¿˜èƒ½å¹²ä»€ä¹ˆï¼Ÿ"},
    config={"configurable": {"session_id": "unused"}}
)

print(response)
```

```
content='å¦‚æœä½ ä¸‹åˆä¸æƒ³ä¸Šç­ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ´»åŠ¨ï¼š\n\n1. **ä¼‘æ¯å’Œæ”¾æ¾**ï¼šå¦‚æœä½ å¤´ç–¼ï¼Œä¼‘æ¯å¯èƒ½æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚å¯ä»¥åœ¨å®¶é‡Œèˆ’é€‚åœ°èººç€ï¼Œå¬éŸ³ä¹æˆ–å†¥æƒ³ã€‚\n\n2. **æˆ·å¤–æ´»åŠ¨**ï¼šå¦‚æœå¤©æ°”å…è®¸ï¼Œå¯ä»¥å»å…¬å›­æ•£æ­¥æˆ–éª‘è‡ªè¡Œè½¦ï¼Œå‘¼å¸æ–°é²œç©ºæ°”ã€‚\n\n3. **é˜…è¯»**ï¼šæ‰¾ä¸€æœ¬ä½ æ„Ÿå…´è¶£çš„ä¹¦ï¼Œäº«å—å®‰é™çš„é˜…è¯»æ—¶å…‰ã€‚\n\n4. **çœ‹ç”µå½±æˆ–ç”µè§†å‰§**ï¼šé€‰æ‹©ä¸€éƒ¨ä½ ä¸€ç›´æƒ³çœ‹çš„ç”µå½±æˆ–ç”µè§†å‰§ï¼Œæ”¾æ¾ä¸€ä¸‹ã€‚\n\n5. **åˆ›ä½œæ´»åŠ¨**ï¼šå¦‚æœä½ å–œæ¬¢è‰ºæœ¯ï¼Œå¯ä»¥å°è¯•ç”»ç”»ã€å†™ä½œæˆ–å…¶ä»–åˆ›æ„æ´»åŠ¨ã€‚\n\n6. **è¿åŠ¨**ï¼šåšä¸€äº›è½»æ¾çš„è¿åŠ¨ï¼Œæ¯”å¦‚ç‘œä¼½æˆ–ä¼¸å±•è¿åŠ¨ï¼Œæœ‰åŠ©äºç¼“è§£å‹åŠ›ã€‚\n\n7. **ç¤¾äº¤æ´»åŠ¨**ï¼šçº¦æœ‹å‹å–å’–å•¡æˆ–èŠå¤©ï¼Œäº«å—è½»æ¾çš„ç¤¾äº¤æ—¶å…‰ã€‚\n\n8. **å­¦ä¹ æ–°æŠ€èƒ½**ï¼šåˆ©ç”¨è¿™æ®µæ—¶é—´å­¦ä¹ ä¸€äº›æ–°ä¸œè¥¿ï¼Œæ¯”å¦‚åœ¨çº¿è¯¾ç¨‹æˆ–çƒ¹é¥ªæ–°èœã€‚\n\nç¡®ä¿é€‰æ‹©çš„æ´»åŠ¨ä¸ä¼šåŠ é‡ä½ çš„å¤´ç–¼ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¸®åŠ©ä½ æ”¾æ¾å’Œæ¢å¤ã€‚' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 257, 'prompt_tokens': 95, 'total_tokens': 352, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeumypWL0iD2suGmttRKMV94DaEfD', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None} id='run--4357fc0f-deaa-4580-8a39-a36c088fd448-0' usage_metadata={'input_tokens': 95, 'output_tokens': 257, 'total_tokens': 352, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
```

```
[AIMessage(content='åœ¨è¿™æ¬¡å¯¹è¯ä¸­ï¼Œç”¨æˆ·è‡ªæˆ‘ä»‹ç»ä¸ºâ€œzsâ€ï¼Œå¹¶æåˆ°ä»Šå¤©å¤´å¾ˆç–¼ã€‚ç”¨æˆ·è¿˜è¡¨ç¤ºä¸‹åˆåœ¨ä¸Šç­ã€‚å¯¹è¯ä¸­æ²¡æœ‰æä¾›å…¶ä»–å…·ä½“ç»†èŠ‚æˆ–ä¿¡æ¯ã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 94, 'total_tokens': 138, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeumwOS6wiIhWqeOb2HOlto1ul5Kk', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--d199b3b6-8974-4623-8321-dd7ad5412319-0', usage_metadata={'input_tokens': 94, 'output_tokens': 44, 'total_tokens': 138, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), HumanMessage(content='æˆ‘ä¸‹åˆä¸æƒ³ä¸Šç­è¿˜èƒ½å¹²ä»€ä¹ˆï¼Ÿ', additional_kwargs={}, response_metadata={}), AIMessage(content='å¦‚æœä½ ä¸‹åˆä¸æƒ³ä¸Šç­ï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹æ´»åŠ¨ï¼š\n\n1. **ä¼‘æ¯å’Œæ”¾æ¾**ï¼šå¦‚æœä½ å¤´ç–¼ï¼Œä¼‘æ¯å¯èƒ½æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚å¯ä»¥åœ¨å®¶é‡Œèˆ’é€‚åœ°èººç€ï¼Œå¬éŸ³ä¹æˆ–å†¥æƒ³ã€‚\n\n2. **æˆ·å¤–æ´»åŠ¨**ï¼šå¦‚æœå¤©æ°”å…è®¸ï¼Œå¯ä»¥å»å…¬å›­æ•£æ­¥æˆ–éª‘è‡ªè¡Œè½¦ï¼Œå‘¼å¸æ–°é²œç©ºæ°”ã€‚\n\n3. **é˜…è¯»**ï¼šæ‰¾ä¸€æœ¬ä½ æ„Ÿå…´è¶£çš„ä¹¦ï¼Œäº«å—å®‰é™çš„é˜…è¯»æ—¶å…‰ã€‚\n\n4. **çœ‹ç”µå½±æˆ–ç”µè§†å‰§**ï¼šé€‰æ‹©ä¸€éƒ¨ä½ ä¸€ç›´æƒ³çœ‹çš„ç”µå½±æˆ–ç”µè§†å‰§ï¼Œæ”¾æ¾ä¸€ä¸‹ã€‚\n\n5. **åˆ›ä½œæ´»åŠ¨**ï¼šå¦‚æœä½ å–œæ¬¢è‰ºæœ¯ï¼Œå¯ä»¥å°è¯•ç”»ç”»ã€å†™ä½œæˆ–å…¶ä»–åˆ›æ„æ´»åŠ¨ã€‚\n\n6. **è¿åŠ¨**ï¼šåšä¸€äº›è½»æ¾çš„è¿åŠ¨ï¼Œæ¯”å¦‚ç‘œä¼½æˆ–ä¼¸å±•è¿åŠ¨ï¼Œæœ‰åŠ©äºç¼“è§£å‹åŠ›ã€‚\n\n7. **ç¤¾äº¤æ´»åŠ¨**ï¼šçº¦æœ‹å‹å–å’–å•¡æˆ–èŠå¤©ï¼Œäº«å—è½»æ¾çš„ç¤¾äº¤æ—¶å…‰ã€‚\n\n8. **å­¦ä¹ æ–°æŠ€èƒ½**ï¼šåˆ©ç”¨è¿™æ®µæ—¶é—´å­¦ä¹ ä¸€äº›æ–°ä¸œè¥¿ï¼Œæ¯”å¦‚åœ¨çº¿è¯¾ç¨‹æˆ–çƒ¹é¥ªæ–°èœã€‚\n\nç¡®ä¿é€‰æ‹©çš„æ´»åŠ¨ä¸ä¼šåŠ é‡ä½ çš„å¤´ç–¼ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¸®åŠ©ä½ æ”¾æ¾å’Œæ¢å¤ã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 257, 'prompt_tokens': 95, 'total_tokens': 352, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BeumypWL0iD2suGmttRKMV94DaEfD', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--4357fc0f-deaa-4580-8a39-a36c088fd448-0', usage_metadata={'input_tokens': 95, 'output_tokens': 257, 'total_tokens': 352, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]
```

# LangChainå¤šæ¨¡æ€è¾“å…¥ä¸è‡ªå®šä¹‰è¾“å‡º

## å¤šæ¨¡æ€æ•°æ®è¾“å…¥

æ¼”ç¤ºå¦‚ä½•å°†å¤šæ¨¡æ€è¾“å…¥ç›´æ¥ä¼ é€’ç»™æ¨¡å‹ã€‚æœŸæœ›æ‰€æœ‰è¾“å…¥éƒ½ä»¥ä¸[OpenAI æœŸæœ›çš„](https://platform.openai.com/docs/guides/vision)æ ¼å¼ç›¸åŒçš„æ ¼å¼ä¼ é€’ã€‚å¯¹äºæ”¯æŒå¤šæ¨¡æ€è¾“å…¥çš„å…¶ä»–æ¨¡å‹æä¾›

è€…ï¼Œåœ¨ç±»ä¸­æ·»åŠ äº†é€»è¾‘ä»¥è½¬æ¢ä¸ºé¢„æœŸæ ¼å¼ã€‚å°†è¦æ±‚æ¨¡å‹æè¿°ä¸€å¹…å›¾åƒã€‚

```python
import base64
import httpx
from langchain_core.messages import HumanMessage
from langchain_openai import ChatOpenAI

image_url = "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Gfp-wisconsin-madison-the-nature-boardwalk.jpg/2560px-Gfp-wisconsin-madison-the-nature-boardwalk.jpg"

model = ChatOpenAI(
    temperature=0,
    model="gpt-4o",
    base_url="http://10.255.4.108:8080/v1",  # æ ¹æ®ä½ çš„å®é™…APIè·¯å¾„ç¡®è®¤æ˜¯å¦åŠ  /v1
    api_key="sk-3BEJwQPhsyVSzDW2C963Af69A6Bf4b608810Dd78E2Bb4452"  # å³ä½¿æ˜¯å‡çš„ï¼Œä¹Ÿè¦ä¼ 
)

image_data = base64.b64encode(httpx.get(image_url).content).decode("utf-8")

message = HumanMessage(
    content=[
        {"type": "text", "text": "ç”¨ä¸­æ–‡æè¿°è¿™å¼ å›¾ç‰‡"},
        {
            "type": "image_url",
            "image_url": {"url": f"data:image/jpeg;base64,{image_data}"},
        }
    ]
)

response = model.invoke([message])

print(response.content)
```

```
è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†ä¸€ç‰‡å¹¿é˜”çš„è‰åœ°ï¼Œè‰åœ°ä¸Šç»¿è‰å¦‚èŒµï¼Œå……æ»¡ç”Ÿæœºã€‚å›¾ç‰‡çš„ä¸­å¤®æœ‰ä¸€æ¡æœ¨åˆ¶å°è·¯ï¼Œå»¶ä¼¸å‘è¿œæ–¹ï¼Œä»¿ä½›å¼•å¯¼ç€äººä»¬èµ°å‘è‡ªç„¶çš„æ·±å¤„ã€‚å¤©ç©ºä¸­è“å¤©ç™½äº‘ï¼Œé˜³å…‰æ˜åªšï¼Œç»™äººä¸€ç§å®é™å’Œèˆ’é€‚çš„æ„Ÿè§‰ã€‚è¿œå¤„å¯ä»¥çœ‹åˆ°ä¸€äº›æ ‘æœ¨å’ŒçŒæœ¨ä¸›ï¼Œå¢æ·»äº†ç”»é¢çš„å±‚æ¬¡æ„Ÿå’Œè‡ªç„¶ç¾ã€‚æ•´ä½“ç”»é¢è‰²å½©é²œè‰³ï¼Œå……æ»¡äº†å¤æ—¥çš„æ°”æ¯ã€‚
```

å¯ä»¥åœ¨â€œimage_urlâ€ç±»å‹çš„å†…å®¹å—ä¸­ç›´æ¥æä¾›å›¾åƒ URLã€‚è¯·æ³¨æ„ï¼Œåªæœ‰éƒ¨åˆ†æ¨¡å‹æä¾›å•†æ”¯æŒæ­¤åŠŸèƒ½ã€‚

```python
message = HumanMessage(
    content=[
        {"type": "text", "text": "ç”¨ä¸­æ–‡æè¿°è¿™å¼ å›¾ç‰‡"},
        {
            "type": "image_url",
            "image_url": {"url": image_url},
        }
    ]
)

response = model.invoke([message])

print(response.content)
```

```
è¿™å¼ å›¾ç‰‡å±•ç¤ºäº†ä¸€ç‰‡å¹¿é˜”çš„è‰åœ°ï¼Œè‰åœ°ä¸Šç»¿è‰å¦‚èŒµï¼Œå……æ»¡ç”Ÿæœºã€‚å›¾ç‰‡çš„ä¸­å¤®æœ‰ä¸€æ¡æœ¨åˆ¶å°è·¯ï¼Œå»¶ä¼¸å‘è¿œæ–¹ï¼Œä»¿ä½›å¼•å¯¼ç€äººä»¬èµ°å‘è‰åœ°æ·±å¤„ã€‚å¤©ç©ºä¸­è“å¤©ç™½äº‘ï¼Œé˜³å…‰æ˜åªšï¼Œç»™æ•´ä¸ªæ™¯è‰²å¢æ·»äº†å®é™å’Œè‡ªç„¶çš„ç¾æ„Ÿã€‚è¿œå¤„å¯ä»¥çœ‹åˆ°ä¸€äº›æ ‘æœ¨å’ŒçŒæœ¨ä¸›ï¼Œæ„æˆäº†ä¸€å¹…å’Œè°ç¾ä¸½çš„è‡ªç„¶é£æ™¯ç”»ã€‚
```

ä¼ å…¥å¤šå¹…å›¾åƒ

```python
message = HumanMessage(
    content=[
        {"type": "text", "text": "è¿™ä¸¤å¼ å›¾ç‰‡æ˜¯ä¸€æ ·çš„å—"},
        {
            "type": "image_url",
            "image_url": {"url": image_url},
        },
        {
            "type": "image_url",
            "image_url": {"url": image_url2}
        }
    ],
)

respone = model.invoke([message])

print(respone.content)
```

```
è¿™ä¸¤å¼ å›¾ç‰‡ä¸ä¸€æ ·ã€‚ç¬¬ä¸€å¼ å›¾ç‰‡å±•ç¤ºçš„æ˜¯ä¸€ä¸ªç»¿è‰²çš„è‰åœ°å’Œæœ¨æ¿è·¯ï¼Œå¤©ç©ºæ™´æœ—ï¼Œç¯å¢ƒçœ‹èµ·æ¥åƒæ˜¯æ˜¥å­£æˆ–å¤å­£ã€‚ç¬¬äºŒå¼ å›¾ç‰‡å±•ç¤ºçš„æ˜¯ä¸€ä¸ªè¢«é›ªè¦†ç›–çš„æ‘åº„ï¼Œå‘¨å›´æœ‰å±±å’Œæ ‘ï¼Œç¯å¢ƒçœ‹èµ·æ¥åƒæ˜¯å†¬å­£ã€‚ä¸¤å¼ å›¾ç‰‡çš„åœºæ™¯å’Œå­£èŠ‚éƒ½ä¸åŒã€‚
```

### å·¥å…·è°ƒç”¨

ä¸€äº›å¤šæ¨¡æ€æ¨¡å‹ä¹Ÿæ”¯æŒå·¥å…·è°ƒç”¨åŠŸèƒ½ã€‚è¦ä½¿ç”¨æ­¤ç±»æ¨¡å‹è°ƒç”¨å·¥å…·ï¼Œåªéœ€ä»¥é€šå¸¸çš„æ–¹å¼å°†å·¥å…·ç»‘å®šåˆ°å®ƒä»¬ï¼Œç„¶åä½¿ç”¨æ‰€éœ€ç±»å‹çš„å†…å®¹å—ï¼ˆä¾‹å¦‚ï¼ŒåŒ…å«å›¾åƒæ•°æ®ï¼‰è°ƒç”¨

æ¨¡å‹ã€‚

```
from typing import Literal
from langchain_core.messages import HumanMessage
from langchain_openai import ChatOpenAI
from langchain_core.tools import tool


@tool
def weather_tool(weather: Literal["æ™´æœ—çš„", "å¤šäº‘çš„", "å¤šé›¨çš„", "ä¸‹é›ªçš„"]) -> None:
    """æè¿°å›¾ç‰‡ä¸­çš„å¤©æ°”æƒ…å†µï¼šæ™´æœ—ã€å¤šäº‘ã€å¤šé›¨æˆ–ä¸‹é›ª"""
    pass

model_with_tools = model.bind_tools([weather_tool])

message = HumanMessage(
    content=[
        {"type": "text", "text": "ç”¨ä¸­æ–‡æè¿°è¿™ä¸¤å¼ å›¾ç‰‡çš„å¤©æ°”"},
        {"type": "image_url", "image_url": {"url": image_url}},
        {"type": "image_url", "image_url": {"url": image_url2}},
    ]
)

response = model_with_tools.invoke([message])

print(response.tool_calls)
```

```
[{'name': 'weather_tool', 'args': {'weather': 'æ™´æœ—çš„'}, 'id': 'call_VLsVrqY8KGt19IzdpAKjk5Ot', 'type': 'tool_call'}, {'name': 'weather_tool', 'args': {'weather': 'ä¸‹é›ªçš„'}, 'id': 'call_w5QxX28DZChY1JecvyxypSq1', 'type': 'tool_call'}]
```

## è‡ªå®šä¹‰è¾“å‡º: JSON, XML, YAML

### å¦‚ä½•è§£æ JSON è¾“å‡º

è™½ç„¶ä¸€äº›æ¨¡å‹æä¾›å•†æ”¯æŒå†…ç½®çš„æ–¹æ³•è¿”å›ç»“æ„åŒ–è¾“å‡ºï¼Œä½†å¹¶éæ‰€æœ‰éƒ½æ”¯æŒã€‚å¯ä»¥ä½¿ç”¨è¾“å‡ºè§£æå™¨æ¥å¸®åŠ©ç”¨æˆ·é€šè¿‡æç¤ºæŒ‡å®šä»»æ„çš„ JSON æ¨¡å¼ï¼ŒæŸ¥è¯¢ç¬¦åˆè¯¥æ¨¡å¼

çš„æ¨¡å‹è¾“å‡ºï¼Œæœ€åå°†è¯¥æ¨¡å¼è§£æä¸º JSONã€‚è¯·è®°ä½ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹æ˜¯æœ‰æ³„æ¼çš„ç°è±¡ï¼å¿…é¡»ä½¿ç”¨å…·æœ‰è¶³å¤Ÿå®¹é‡çš„å¤§å‹è¯­è¨€æ¨¡å‹æ¥ç”Ÿæˆæ ¼å¼è‰¯å¥½çš„ JSON

JsonOutputParser æ˜¯ä¸€ä¸ªå†…ç½®é€‰é¡¹ï¼Œç”¨äºæç¤ºå¹¶è§£æ JSON è¾“å‡ºã€‚è™½ç„¶å®ƒåœ¨åŠŸèƒ½ä¸Šç±»ä¼¼äº PydanticOutputParserï¼Œä½†å®ƒè¿˜æ”¯æŒæµå¼è¿”å›éƒ¨åˆ† JSON å¯¹è±¡ã€‚

ä»¥ä¸‹æ˜¯å¦‚ä½•å°†å…¶ä¸ Pydanticä¸€èµ·ä½¿ç”¨ä»¥æ–¹ä¾¿åœ°å£°æ˜é¢„æœŸæ¨¡å¼çš„ç¤ºä¾‹ï¼š

```python
from langchain_core.output_parsers import JsonOutputParser
from langchain_core.prompts import PromptTemplate
from pydantic import BaseModel, Field
from langchain_openai import ChatOpenAI
# è‡ªå®šä¹‰è¾“å‡º

class Joke(BaseModel):
    setup: str = Field(description="è®¾ç½®ç¬‘è¯é—®é¢˜")
    punchile: str = Field(description="å›ç­”ç¬‘è¯é—®é¢˜")

parser = JsonOutputParser(pydantic_object=Joke)

prompt = PromptTemplate(
    template="å›ç­”ç”¨æˆ·é—®é¢˜ã€‚\n{format_instructions}\{query}\n",
    input_variables=["query"],
    partial_variables={"format_instructions": parser.get_format_instructions()}
)

chain = prompt | model | parser

response = chain.invoke({"query": "ç»™æˆ‘è®²ä¸€ä¸ªç¬‘è¯"})

print(response)
```

```
{'setup': 'ä¸ºä»€ä¹ˆè‡ªè¡Œè½¦ä¸èƒ½ç«™ç«‹ï¼Ÿ', 'punchile': 'å› ä¸ºå®ƒå¤ªç´¯äº†ï¼'}
```

#### æµå¼å¤„ç†

å¦‚ä¸Šæ‰€è¿°ï¼Œ`JsonOutputParser` å’Œ `PydanticOutputParser` ä¹‹é—´çš„ä¸€ä¸ªå…³é”®åŒºåˆ«æ˜¯ `JsonOutputParser` è¾“å‡ºè§£æå™¨æ”¯æŒæµå¼å¤„ç†éƒ¨åˆ†å—ã€‚ä»¥ä¸‹æ˜¯å…¶ç¤ºä¾‹ï¼š

```python
for s in chain.stream({"query": joke_query}):
    print(s)
```

```
{}
{'setup': ''}
{'setup': 'ä¸ºä»€ä¹ˆ'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœº'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿ'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': ''}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸º'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒ'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰å¾ˆ'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰å¾ˆå¥½çš„'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰å¾ˆå¥½çš„é˜²'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰å¾ˆå¥½çš„é˜²ç«'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰å¾ˆå¥½çš„é˜²ç«å¢™'}
{'setup': 'ä¸ºä»€ä¹ˆè®¡ç®—æœºä¸èƒ½å¾—æ„Ÿå†’ï¼Ÿ', 'punchline': 'å› ä¸ºå®ƒä»¬æœ‰å¾ˆå¥½çš„é˜²ç«å¢™ï¼'}'
```

## å¦‚ä½•è§£æ XML è¾“å‡º

ä¸‹é¢ä½¿ç”¨XMLOutputParseræ¥æç¤ºæ¨¡å‹ç”ŸæˆXMLè¾“å‡ºï¼Œç„¶åå°†è¯¥è¾“å‡ºè§£æä¸ºå¯ç”¨çš„æ ¼å¼ã€‚å¯ä»¥ä½¿ç”¨XMLOutputParserå°†é»˜è®¤çš„æ ¼å¼æŒ‡ä»¤æ·»åŠ åˆ°æç¤ºä¸­ï¼Œå¹¶å°†è¾“å‡º

çš„XMLè§£æä¸ºå­—å…¸ï¼š

```python
parser = XMLOutputParser()

prompt = PromptTemplate(
    template="å›ç­”ç”¨æˆ·é—®é¢˜\n{format_instructions}\n{query}\n",
    input_variables=["query"],
    partial_variables={"format_instructions": parser.get_format_instructions()}
)

chain = prompt | model

response = chain.invoke({"query": "ç”Ÿæˆå‘¨æ˜Ÿé©°çš„ç®€åŒ–ç”µå½±ä½œå“åˆ—è¡¨ï¼ŒæŒ‰ç…§æœ€æ–°çš„æ—¶é—´é™åº"})

xml_output = parser.parse(response.content)

print(xml_output)
```

```
{'movies': [{'movie': [{'title': 'The New King of Comedy'}, {'year': '2019'}]}, {'movie': [{'title': 'Journey to the West: The Demons Strike Back'}, {'year': '2017'}]}, {'movie': [{'title': 'The Mermaid'}, {'year': '2016'}]}, {'movie': [{'title': 'Journey to the West: Conquering the Demons'}, {'year': '2013'}]}, {'movie': [{'title': 'Kung Fu Hustle'}, {'year': '2004'}]}, {'movie': [{'title': 'Shaolin Soccer'}, {'year': '2001'}]}, {'movie': [{'title': 'King of Comedy'}, {'year': '1999'}]}, {'movie': [{'title': 'God of Cookery'}, {'year': '1996'}]}, {'movie': [{'title': 'A Chinese Odyssey Part Two: Cinderella'}, {'year': '1995'}]}, {'movie': [{'title': "A Chinese Odyssey Part One: Pandora's Box"}, {'year': '1995'}]}]}
```

```
from langchain_openai import ChatOpenAI
# pip install -qU langchain langchain-openai
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import XMLOutputParser
# pip install defusedxml

model = ChatOpenAI(model="gpt-4o", temperature=0)

# è¿˜æœ‰ä¸€ä¸ªç”¨äºæç¤ºè¯­è¨€æ¨¡å‹å¡«å……æ•°æ®ç»“æ„çš„æŸ¥è¯¢æ„å›¾ã€‚
actor_query = "ç”Ÿæˆå‘¨æ˜Ÿé©°çš„ç®€åŒ–ç”µå½±ä½œå“åˆ—è¡¨ï¼ŒæŒ‰ç…§æœ€æ–°çš„æ—¶é—´é™åº"
# è®¾ç½®è§£æå™¨ + å°†æŒ‡ä»¤æ³¨å…¥æç¤ºæ¨¡æ¿ã€‚
parser = XMLOutputParser()
prompt = PromptTemplate(
    template="å›ç­”ç”¨æˆ·çš„æŸ¥è¯¢ã€‚\n{format_instructions}\n{query}\n",
    input_variables=["query"],
    partial_variables={"format_instructions": parser.get_format_instructions()},
)
# print(parser.get_format_instructions())
chain = prompt | model
response = chain.invoke({"query": actor_query})
xml_output = parser.parse(response.content)
print(response.content)
```

è¿˜å¯ä»¥æ·»åŠ ä¸€äº›æ ‡ç­¾ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚å®šåˆ¶è¾“å‡ºã€‚å¯ä»¥åœ¨æç¤ºçš„å…¶ä»–éƒ¨åˆ†ä¸­å°è¯•æ·»åŠ è‡ªå·±çš„æ ¼å¼æç¤ºï¼Œä»¥å¢å¼ºæˆ–æ›¿æ¢é»˜è®¤æŒ‡ä»¤ï¼š

```
#xml_output_parser_enhance.py
parser = XMLOutputParser(tags=["movies", "actor", "film", "name", "genre"])
# æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„æç¤ºä¸­æ·»åŠ è¿™äº›æŒ‡ä»¤
parser.get_format_instructions()
```

````
{'movies': [{'actor': [{'name': 'å‘¨æ˜Ÿé©°'}, {'film': [{'name': 'ç¾äººé±¼'}, {'genre': 'å–œå‰§, å¥‡å¹»'}]}, {'film': [{'name': 'è¥¿æ¸¸Â·é™é­”ç¯‡'}, {'genre': 'å–œå‰§, å¥‡å¹»'}]}, {'film': [{'name': 'é•¿æ±Ÿ7å·'}, {'genre': 'å–œå‰§, ç§‘å¹»'}]}, {'film': [{'name': 'åŠŸå¤«'}, {'genre': 'åŠ¨ä½œ, å–œå‰§'}]}, {'film': [{'name': 'å°‘æ—è¶³çƒ'}, {'genre': 'å–œå‰§, è¿åŠ¨'}]}]}]}
````

## å¦‚ä½•è§£æ YAML è¾“å‡º

æ¥è‡ªä¸åŒæä¾›å•†çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰é€šå¸¸æ ¹æ®å®ƒä»¬è®­ç»ƒçš„å…·ä½“æ•°æ®å…·æœ‰ä¸åŒçš„ä¼˜åŠ¿ã€‚è¿™ä¹Ÿæ„å‘³ç€æœ‰äº›æ¨¡å‹åœ¨ç”Ÿæˆ JSON ä»¥å¤–çš„æ ¼å¼è¾“å‡ºæ–¹é¢å¯èƒ½æ›´â€œä¼˜ç§€â€å’Œå¯

é ã€‚è¿™ä¸ªè¾“å‡ºè§£æå™¨å…è®¸ç”¨æˆ·æŒ‡å®šä»»æ„æ¨¡å¼ï¼Œå¹¶æŸ¥è¯¢ç¬¦åˆè¯¥æ¨¡å¼çš„ LLMS è¾“å‡ºï¼Œä½¿ç”¨ YAML æ ¼å¼åŒ–ä»–ä»¬çš„å“åº”ã€‚

```
%pip install -qU langchain langchain-openai
```

æˆ‘ä»¬ä½¿ç”¨ [Pydantic](https://docs.pydantic.dev/) ä¸ [YamlOutputParser](https://api.python.langchain.com/en/latest/output_parsers/langchain.output_parsers.yaml.YamlOutputParser.html#langchain.output_parsers.yaml.YamlOutputParser) æ¥å£°æ˜æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ï¼Œå¹¶ä¸ºæ¨¡å‹æä¾›æ›´å¤šå…³äºåº”ç”Ÿæˆä½•ç§ç±»å‹ YAML çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š

```
#yaml_output_parser.py
# pip install -qU langchain langchain-openai
from langchain.output_parsers import YamlOutputParser
from langchain_core.prompts import PromptTemplate
from langchain_core.pydantic_v1 import BaseModel, Field
from langchain_openai import ChatOpenAI

# å®šä¹‰æ‚¨æœŸæœ›çš„æ•°æ®ç»“æ„ã€‚
class Joke(BaseModel):
    setup: str = Field(description="è®¾ç½®ç¬‘è¯çš„é—®é¢˜")
    punchline: str = Field(description="è§£ç­”ç¬‘è¯çš„ç­”æ¡ˆ")

model = ChatOpenAI(temperature=0)
# åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢ï¼Œæ—¨åœ¨æç¤ºè¯­è¨€æ¨¡å‹å¡«å……æ•°æ®ç»“æ„ã€‚
joke_query = "å‘Šè¯‰æˆ‘ä¸€ä¸ªç¬‘è¯ã€‚"
# è®¾ç½®ä¸€ä¸ªè§£æå™¨ + å°†æŒ‡ä»¤æ³¨å…¥åˆ°æç¤ºæ¨¡æ¿ä¸­ã€‚
parser = YamlOutputParser(pydantic_object=Joke)
prompt = PromptTemplate(
    template="å›ç­”ç”¨æˆ·çš„æŸ¥è¯¢ã€‚\n{format_instructions}\n{query}\n",
    input_variables=["query"],
    partial_variables={"format_instructions": parser.get_format_instructions()},
)
chain = prompt | model
print(parser.get_format_instructions())
response = chain.invoke({"query": joke_query})
print(response.content)
#print(parser.parse(response))
```

```
setup: ä¸ºä»€ä¹ˆç¨‹åºå‘˜æ€»æ˜¯åœ¨æ·±å¤œå·¥ä½œï¼Ÿ
punchline: å› ä¸ºé‚£æ—¶å€™æ¯”è¾ƒå®‰é™ï¼Œæ²¡æœ‰äººä¼šæ‰“æ‰°ä»–ä»¬çš„æ€ç»ªã€‚
```

è§£æå™¨å°†è‡ªåŠ¨è§£æè¾“å‡ºçš„ YAMLï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ•°æ®çš„ Pydantic æ¨¡å‹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è§£æå™¨çš„ format_instructionsï¼Œè¿™äº›æŒ‡ä»¤è¢«æ·»åŠ 

åˆ°æç¤ºä¸­ï¼š

```
parser.get_format_instructions()
```

````
# Examples
## Schema
```
{"title": "Players", "description": "A list of players", "type": "array", "items": {"$ref": "#/definitions/Player"}, "definitions": {"Player": {"title": "Player", "type": "object", "properties": {"name": {"title": "Name", "description": "Player name", "type": "string"}, "avg": {"title": "Avg", "description": "Batting average", "type": "number"}}, "required": ["name", "avg"]}}}
```
## Well formatted instance
```
- name: John Doe
  avg: 0.3
- name: Jane Maxfield
  avg: 1.4
```

## Schema
```
{"properties": {"habit": { "description": "A common daily habit", "type": "string" }, "sustainable_alternative": { "description": "An environmentally friendly alternative to the habit", "type": "string"}}, "required": ["habit", "sustainable_alternative"]}
```
## Well formatted instance
```
habit: Using disposable water bottles for daily hydration.
sustainable_alternative: Switch to a reusable water bottle to reduce plastic waste and decrease your environmental footprint.
``` 

Please follow the standard YAML formatting conventions with an indent of 2 spaces and make sure that the data types adhere strictly to the following JSON schema: 
```
{"properties": {"setup": {"title": "Setup", "description": "\u8bbe\u7f6e\u7b11\u8bdd\u7684\u95ee\u9898", "type": "string"}, "punchline": {"title": "Punchline", "description": "\u89e3\u7b54\u7b11\u8bdd\u7684\u7b54\u6848", "type": "string"}}, "required": ["setup", "punchline"]}
```

Make sure to always enclose the YAML output in triple backticks (```). Please do not add anything other than valid YAML output!
```
````

å¯ä»¥å°è¯•åœ¨æç¤ºçš„å…¶ä»–éƒ¨åˆ†ä¸­æ·»åŠ è‡ªå·±çš„æ ¼å¼æç¤ºï¼Œä»¥å¢å¼ºæˆ–æ›¿æ¢é»˜è®¤æŒ‡ä»¤ã€‚

# LangChainè‡ªå®šä¹‰å·¥å…·è°ƒç”¨

## è‡ªå®šä¹‰å·¥å…·

åœ¨æ„å»ºä»£ç†æ—¶ï¼Œéœ€è¦æä¾›ä¸€ä¸ª`Tool`åˆ—è¡¨ï¼Œä»¥ä¾¿ä»£ç†å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·ã€‚é™¤äº†å®é™…è°ƒç”¨çš„å‡½æ•°ä¹‹å¤–ï¼Œ`Tool`ç”±å‡ ä¸ªç»„ä»¶ç»„æˆï¼š

| å±æ€§          | ç±»å‹               | æè¿°                                                         |
| ------------- | ------------------ | ------------------------------------------------------------ |
| name          | str                | åœ¨æä¾›ç»™LLMæˆ–ä»£ç†çš„å·¥å…·é›†ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚                    |
| description   | str                | æè¿°å·¥å…·çš„åŠŸèƒ½ã€‚LLMæˆ–ä»£ç†å°†ä½¿ç”¨æ­¤æè¿°ä½œä¸ºä¸Šä¸‹æ–‡ã€‚            |
| args_schema   | Pydantic BaseModel | å¯é€‰ä½†å»ºè®®ï¼Œå¯ç”¨äºæä¾›æ›´å¤šä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œfew-shotç¤ºä¾‹ï¼‰æˆ–éªŒè¯é¢„æœŸå‚æ•°ã€‚ |
| return_direct | boolean            | ä»…å¯¹ä»£ç†ç›¸å…³ã€‚å½“ä¸ºTrueæ—¶ï¼Œåœ¨è°ƒç”¨ç»™å®šå·¥å…·åï¼Œä»£ç†å°†åœæ­¢å¹¶å°†ç»“æœç›´æ¥è¿”å›ç»™ç”¨æˆ·ã€‚ |

LangChain æä¾›äº†ä¸‰ç§åˆ›å»ºå·¥å…·çš„æ–¹å¼ï¼š

1. ä½¿ç”¨@toolè£…é¥°å™¨ -- å®šä¹‰è‡ªå®šä¹‰å·¥å…·çš„æœ€ç®€å•æ–¹å¼ã€‚

2. ä½¿ç”¨StructuredTool.from_functionç±»æ–¹æ³• -- è¿™ç±»ä¼¼äº`@tool`è£…é¥°å™¨ï¼Œä½†å…è®¸æ›´å¤šé…ç½®å’ŒåŒæ­¥å’Œå¼‚æ­¥å®ç°çš„è§„èŒƒã€‚

3. é€šè¿‡å­ç±»åŒ–BaseTool -- è¿™æ˜¯æœ€çµæ´»çš„æ–¹æ³•ï¼Œå®ƒæä¾›äº†æœ€å¤§ç¨‹åº¦çš„æ§åˆ¶ï¼Œä½†éœ€è¦æ›´å¤šçš„å·¥ä½œé‡å’Œä»£ç ã€‚ `@tool` 

   `StructuredTool.from_function`ç±»æ–¹æ³•å¯¹äºå¤§å¤šæ•°ç”¨ä¾‹åº”è¯¥è¶³å¤Ÿäº†ã€‚ å¦‚æœå·¥å…·å…·æœ‰ç²¾å¿ƒé€‰æ‹©çš„åç§°ã€æè¿°å’Œ JSON æ¨¡å¼ï¼Œæ¨¡å‹çš„

   æ€§èƒ½ä¼šæ›´å¥½ã€‚ 

### @tool è£…é¥°å™¨

è¿™ä¸ª`@tool`è£…é¥°å™¨æ˜¯å®šä¹‰è‡ªå®šä¹‰å·¥å…·çš„æœ€ç®€å•æ–¹å¼ã€‚è¯¥è£…é¥°å™¨é»˜è®¤ä½¿ç”¨å‡½æ•°åç§°ä½œä¸ºå·¥å…·åç§°ï¼Œä½†å¯ä»¥é€šè¿‡ä¼ é€’å­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ¥

è¦†ç›–ã€‚æ­¤å¤–ï¼Œè£…é¥°å™¨å°†ä½¿ç”¨å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ä½œä¸ºå·¥å…·çš„æè¿° - å› æ­¤å¿…é¡»æä¾›æ–‡æ¡£å­—ç¬¦ä¸²ã€‚

```python
from langchain_core.tools import tool

@tool
def multiply(a: int, b: int) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯."""
    return a * b

print(multiply.name)
print(multiply.description)
print(multiply.args)
```

```
multiply
è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯.
{'a': {'title': 'A', 'type': 'integer'}, 'b': {'title': 'B', 'type': 'integer'}}
```

æˆ–è€…åˆ›å»ºä¸€ä¸ª**å¼‚æ­¥**å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```python
@tool
async def multiply(a: int, b: int) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯."""
    return a * b

print(multiply.name)
print(multiply.description)
print(multiply.args)
```

```
multiply
è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯.
{'a': {'title': 'A', 'type': 'integer'}, 'b': {'title': 'B', 'type': 'integer'}}
```

è¿˜å¯ä»¥é€šè¿‡å°†å®ƒä»¬ä¼ é€’ç»™å·¥å…·è£…é¥°å™¨æ¥è‡ªå®šä¹‰å·¥å…·åç§°å’Œ JSON å‚æ•°ã€‚

```python
from pydantic import BaseModel, Field
class CalculatorInput(BaseModel):
    a: int = Field(description="ç¬¬ä¸€ä¸ªæ•°å­—")
    b: int = Field(description="ç¬¬äºŒä¸ªæ•°å­—")

@tool("multiplication-tool", args_schema=CalculatorInput, return_direct=True)
def multiply(a: int, b: int) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯."""
    return a * b

print(multiply.name)
print(multiply.description)
print(multiply.args)
print(multiply.return_direct))
```

```
multiplication-tool
è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯.
{'a': {'description': 'ç¬¬ä¸€ä¸ªæ•°å­—', 'title': 'A', 'type': 'integer'}, 'b': {'description': 'ç¬¬äºŒä¸ªæ•°å­—', 'title': 'B', 'type': 'integer'}}
True
```

### StructuredTool

`StructuredTool.from_function` ç±»æ–¹æ³•æä¾›äº†æ¯”`@tool`è£…é¥°å™¨æ›´å¤šçš„å¯é…ç½®æ€§ï¼Œè€Œæ— éœ€å¤ªå¤šé¢å¤–çš„ä»£ç ã€‚

```python
from langchain_core.tools import StructuredTool
import asyncio
def multiply(a: int, b: int) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯."""
    return a * b

async def amultiply(a: int, b: int) -> int:
    """è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯."""
    return a * b

async def main():
    calculator = StructuredTool.from_function(func=multiply, coroutine=amultiply)
    print(calculator.invoke({"a": 2, "b": 2}))
    print(await calculator.ainvoke({"a": 2, "b": 2}))

asyncio.run(main())
```

```
4
4
```

å¯ä»¥é…ç½®è‡ªå®šä¹‰å‚æ•°

```python
from langchain_core.tools import StructuredTool
from pydantic import BaseModel, Field
import asyncio

# è‡ªå®šä¹‰å‚æ•°

class CalculatorInput(BaseModel):
    a: int = Field(description="ç¬¬ä¸€ä¸ªæ•°å­—")
    b: int = Field(description="ç¬¬äºŒä¸ªæ•°å­—")

def multiply(a: int, b: int) -> int:
    """è·å¾—ä¸¤ä¸ªæ•°çš„ç§¯"""
    return a * b

async def async_add(a: int, b: int) -> int:
    """è·å¾—ä¸¤ä¸ªæ•°çš„å’Œ"""
    return a + b

async def main():
    calculator = StructuredTool.from_function(
        func=multiply,
        name="Calculator",
        description="è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯",
        args_schema=CalculatorInput,
        return_direct=True,
        coroutine=async_add // æŒ‡å®šå¼‚æ­¥æ–¹æ³•
    )
    print(calculator.invoke({"a": 2, "b": 3}))
    print(await calculator.ainvoke({"a": 2, "b": 3}))
    print(calculator.name)
    print(calculator.description)
    print(calculator.args)

asyncio.run(main())
```

```
6
5
Calculator
è®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯
{'a': {'description': 'ç¬¬ä¸€ä¸ªæ•°å­—', 'title': 'A', 'type': 'integer'}, 'b': {'description': 'ç¬¬äºŒä¸ªæ•°å­—', 'title': 'B', 'type': 'integer'}}
```

### é”™è¯¯å¤„ç†å·¥å…·

å¦‚æœæ­£åœ¨ä½¿ç”¨å¸¦æœ‰ä»£ç†çš„å·¥å…·ï¼Œå¯èƒ½éœ€è¦ä¸€ä¸ªé”™è¯¯å¤„ç†ç­–ç•¥ï¼Œä»¥ä¾¿ä»£ç†å¯ä»¥ä»é”™è¯¯ä¸­æ¢å¤å¹¶ç»§ç»­æ‰§è¡Œã€‚ ä¸€ä¸ªç®€å•çš„ç­–ç•¥æ˜¯åœ¨å·¥å…·å†…éƒ¨æŠ›

å‡º `ToolException`ï¼Œå¹¶ä½¿ç”¨ `handle_tool_error` æŒ‡å®šä¸€ä¸ªé”™è¯¯å¤„ç†ç¨‹åºã€‚ å½“æŒ‡å®šäº†é”™è¯¯å¤„ç†ç¨‹åºæ—¶ï¼Œå¼‚å¸¸å°†è¢«æ•è·ï¼Œé”™è¯¯å¤„ç†ç¨‹åºå°†

å†³å®šä»å·¥å…·è¿”å›è¾“å‡ºã€‚ å¯ä»¥å°† `handle_tool_error` è®¾ç½®ä¸º `True`ã€å­—ç¬¦ä¸²å€¼æˆ–å‡½æ•°ã€‚å¦‚æœæ˜¯å‡½æ•°ï¼Œè¯¥å‡½æ•°åº”è¯¥ä»¥ ToolException` ä½œä¸º` 

 å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚ è¯·æ³¨æ„ï¼Œä»…ä»…æŠ›å‡º `handle_tool_error` æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚éœ€è¦é¦–å…ˆè®¾ç½®å·¥å…·çš„ `handle_tool_error`ï¼Œå› ä¸ºå…¶é»˜è®¤

å€¼æ˜¯ `False`ã€‚

```python
def get_weather(city: str) -> int:
    """è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”"""
    raise ToolException(f"å‘Šè­¦ï¼šæ²¡æœ‰è·å–åˆ°åä¸º{city}åŸå¸‚")

get_weather_tool = StructuredTool.from_function(
    func=get_weather,
    handle_tool_error=True,
)

print(get_weather_tool.invoke({"city": "ä¸Šæµ·"}))
```

```python
å‘Šè­¦ï¼šæ²¡æœ‰è·å–åˆ°åä¸ºä¸Šæµ·åŸå¸‚
```

å¯ä»¥å°†`handle_tool_error`è®¾ç½®ä¸ºä¸€ä¸ªå§‹ç»ˆè¿”å›çš„å­—ç¬¦ä¸²ã€‚

```python
get_weather_tool = StructuredTool.from_function(
    func=get_weather,
    handle_tool_error="æ²¡æ‰¾åˆ°è¿™ä¸ªåŸå¸‚",
)

print(get_weather_tool.invoke({"city": "åŒ—äº¬"}))
```

ä½¿ç”¨å‡½æ•°å¤„ç†é”™è¯¯ï¼š

```python
def _handle_error(error: ToolException) -> str:
    return f"å·¥å…·è°ƒç”¨å¤±è´¥ `{error.args[0]}`"

get_weather_tool = StructuredTool.from_function(
    func=get_weather,
    handle_tool_error=_handle_error,
)

print(get_weather_tool.invoke({"city": "åŒ—äº¬"}))
```

```
å·¥å…·è°ƒç”¨å¤±è´¥ `å‘Šè­¦ï¼šæ²¡æœ‰è·å–åˆ°åä¸ºåŒ—äº¬åŸå¸‚`
```

## è°ƒç”¨å†…ç½®å·¥å…·åŒ…å’Œæ‹“å±•å·¥å…·

### å·¥å…·

å·¥å…·æ˜¯ä»£ç†ã€é“¾æˆ–èŠå¤©æ¨¡å‹/LLMç”¨æ¥ä¸ä¸–ç•Œäº¤äº’çš„æ¥å£ã€‚ ä¸€ä¸ªå·¥å…·ç”±ä»¥ä¸‹ç»„ä»¶ç»„æˆï¼š

1. å·¥å…·çš„åç§°

2. å·¥å…·çš„åŠŸèƒ½æè¿°

3. å·¥å…·è¾“å…¥çš„JSONæ¨¡å¼

4. è¦è°ƒç”¨çš„å‡½æ•°

5. å·¥å…·çš„ç»“æœæ˜¯å¦åº”ç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼ˆä»…å¯¹ä»£ç†ç›¸å…³ï¼‰ åç§°ã€æè¿°å’ŒJSONæ¨¡å¼ä½œä¸ºä¸Šä¸‹æ–‡æä¾›ç»™LLMï¼Œå…è®¸LLMé€‚å½“åœ°ç¡®å®šå¦‚ä½•ä½¿ç”¨å·¥å…·ã€‚ ç»™å®šä¸€ç»„å¯ç”¨å·¥å…·

   å’Œæç¤ºï¼ŒLLMå¯ä»¥è¯·æ±‚è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å…·ï¼Œå¹¶æä¾›é€‚å½“çš„å‚æ•°ã€‚ é€šå¸¸ï¼Œåœ¨è®¾è®¡ä¾›èŠå¤©æ¨¡å‹æˆ–LLMä½¿ç”¨çš„å·¥å…·æ—¶ï¼Œé‡è¦çš„æ˜¯è¦ç‰¢è®°ä»¥ä¸‹å‡ ç‚¹ï¼š

- ç»è¿‡å¾®è°ƒä»¥è¿›è¡Œå·¥å…·è°ƒç”¨çš„èŠå¤©æ¨¡å‹å°†æ¯”æœªç»å¾®è°ƒçš„æ¨¡å‹æ›´æ“…é•¿è¿›è¡Œå·¥å…·è°ƒç”¨ã€‚
- æœªç»å¾®è°ƒçš„æ¨¡å‹å¯èƒ½æ ¹æœ¬æ— æ³•ä½¿ç”¨å·¥å…·ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå·¥å…·å¤æ‚æˆ–éœ€è¦å¤šæ¬¡è°ƒç”¨å·¥å…·ã€‚
- å¦‚æœå·¥å…·å…·æœ‰ç²¾å¿ƒé€‰æ‹©çš„åç§°ã€æè¿°å’ŒJSONæ¨¡å¼ï¼Œåˆ™æ¨¡å‹çš„æ€§èƒ½å°†æ›´å¥½ã€‚
- ç®€å•çš„å·¥å…·é€šå¸¸æ¯”æ›´å¤æ‚çš„å·¥å…·æ›´å®¹æ˜“è®©æ¨¡å‹ä½¿ç”¨ã€‚

LangChain æ‹¥æœ‰å¤§é‡ç¬¬ä¸‰æ–¹å·¥å…·ã€‚https://python.langchain.com/v0.2/docs/integrations/tools/

åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·æ—¶ï¼Œè¯·ç¡®ä¿äº†è§£å·¥å…·çš„å·¥ä½œåŸç†ã€æƒé™æƒ…å†µã€‚é˜…è¯»å…¶æ–‡æ¡£ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦ä»å®‰å…¨è§’åº¦è€ƒè™‘ä»»ä½•äº‹é¡¹ã€‚è¯·æŸ¥çœ‹å®‰å…¨æŒ‡å—è·å–æ›´å¤šä¿¡æ¯ã€‚

ç»´åŸºç™¾ç§‘é›†æˆ

```
pip install -qU wikipedia
```

```python
#ç¤ºä¾‹ï¼štools_wikipedia.py
api_wrapper = WikipediaAPIWrapper(top_k_results=1, doc_content_chars_max=100)
tool = WikipediaQueryRun(api_wrapper=api_wrapper)
print(tool.invoke({"query": "éŸ¦ä¸œå¥•"}))
```

```
Page: Wei Dongyi
Summary: Wei Dongyi (Chinese: éŸ¦ä¸œå¥•; born 1991) is a Chinese mathematician, born in J
```

è¯¥å·¥å…·å…·æœ‰ä»¥ä¸‹é»˜è®¤å…³è”é¡¹ï¼š

```
print(tool.name)
print(tool.description)
print(tool.args)
print(tool.return_direct)
```

```
wikipedia
A wrapper around Wikipedia. Useful for when you need to answer general questions about people, places, companies, facts, historical events, or other subjects. Input should be a search query.
{'query': {'description': 'query to look up on wikipedia', 'title': 'Query', 'type': 'string'}}
False
```

### è‡ªå®šä¹‰é»˜è®¤å·¥å…·

è¿˜å¯ä»¥ä¿®æ”¹å†…ç½®å·¥å…·çš„åç§°ã€æè¿°å’Œå‚æ•°çš„ JSON æ¨¡å¼ã€‚åœ¨å®šä¹‰å‚æ•°çš„ JSON æ¨¡å¼æ—¶ï¼Œé‡è¦çš„æ˜¯è¾“å…¥ä¿æŒä¸å‡½æ•°ç›¸åŒã€‚

```python
from langchain_community.tools import WikipediaQueryRun
from langchain_community.utilities import WikipediaAPIWrapper
from pydantic import BaseModel, Field
class WikiInputs(BaseModel):
    """ç»´åŸºç™¾ç§‘å·¥å…·è¾“å…¥"""
    query: str = Field(
        description="è‡³å°‘è¾“å…¥ä¸‰ä¸ªå­—ç¬¦ï¼Œæ‰å¯ä»¥è¿›è¡ŒæŸ¥è¯¢"
    )

tool = WikipediaQueryRun(
    name="wiki-tool",
    description="æŸ¥è¯¢ç»´åŸºç™¾ç§‘",
    args_schema=WikiInputs,
    api_wrapper=api_wrapper,
    return_direct=True
)

print(tool.run("éŸ¦ä¸œå¥•"))
```

```
Page: Wei Dongyi
Summary: Wei Dongyi (Chinese: éŸ¦ä¸œå¥•; born 1991) is a Chinese mathematician, born in J
```

```python
print(f"Name: {tool.name}")
print(f"Description: {tool.description}")
print(f"args schema: {tool.args}")
print(f"returns directly?: {tool.return_direct}")
```

```
Name: wiki-tool
Description: æŸ¥è¯¢ç»´åŸºç™¾ç§‘
args schema: {'query': {'description': 'è‡³å°‘è¾“å…¥ä¸‰ä¸ªå­—ç¬¦ï¼Œæ‰å¯ä»¥è¿›è¡ŒæŸ¥è¯¢', 'title': 'Query', 'type': 'string'}}
returns directly?: True
```

### å¦‚ä½•ä½¿ç”¨å†…ç½®å·¥å…·åŒ…

å·¥å…·åŒ…æ˜¯ä¸€ç»„æ—¨åœ¨ä¸€èµ·ä½¿ç”¨ä»¥æ‰§è¡Œç‰¹å®šä»»åŠ¡çš„å·¥å…·ã€‚å®ƒä»¬å…·æœ‰ä¾¿æ·çš„åŠ è½½æ–¹æ³•ã€‚è¦è·å–å¯ç”¨çš„ç°æˆå·¥å…·åŒ…å®Œæ•´åˆ—è¡¨ï¼Œè¯·è®¿é—®[é›†æˆ](http://www.aidoczh.com/langchain/v0.2/docs/integrations/toolkits/)ã€‚æ‰€æœ‰å·¥å…·åŒ…éƒ½å…¬å¼€äº†ä¸€ä¸ª 

get_tools æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå·¥å…·åˆ—è¡¨ã€‚

```
# åˆå§‹åŒ–ä¸€ä¸ªå·¥å…·åŒ…
toolkit = ExampleTookit(...)
# è·å–å·¥å…·åˆ—è¡¨
tools = toolkit.get_tools()
```

ä¾‹å¦‚ä½¿ç”¨ï¼šSQLDatabase toolkit è¯»å–langchain.dbæ•°æ®åº“è¡¨ç»“æ„

```
from langchain_community.agent_toolkits.sql.toolkit import SQLDatabaseToolkit
from langchain_community.utilities import SQLDatabase
from langchain_openai import ChatOpenAI
from langchain_community.agent_toolkits.sql.base import create_sql_agent
from langchain.agents.agent_types import AgentType

db = SQLDatabase.from_uri("sqlite:///langchain.db")
toolkit = SQLDatabaseToolkit(db=db, llm=ChatOpenAI(temperature=0))
print(toolkit.get_tools())

agent_executor = create_sql_agent(
    llm=ChatOpenAI(temperature=0, model="gpt-4"),
    toolkit=toolkit,
    verbose=True,
    agent_type=AgentType.OPENAI_FUNCTIONS
)
# %%
agent_executor.invoke("Describe the full_llm_cache table")
```

æ‰§è¡Œ print(toolkit.get_tools())

```
[QuerySQLDataBaseTool(description="Input to this tool is a detailed and correct SQL query, output is a result from the database. If the query is not correct, an error message will be returned. If an error is returned, rewrite the query, check the query, and try again. If you encounter an issue with Unknown column 'xxxx' in 'field list', use sql_db_schema to query the correct table fields.", db=<langchain_community.utilities.sql_database.SQLDatabase object at 0x000001D15C9749B0>), InfoSQLDatabaseTool(description='Input to this tool is a comma-separated list of tables, output is the schema and sample rows for those tables. Be sure that the tables actually exist by calling sql_db_list_tables first! Example Input: table1, table2, table3', db=<langchain_community.utilities.sql_database.SQLDatabase object at 0x000001D15C9749B0>), ListSQLDatabaseTool(db=<langchain_community.utilities.sql_database.SQLDatabase object at 0x000001D15C9749B0>), QuerySQLCheckerTool(description='Use this tool to double check if your query is correct before executing it. Always use this tool before executing a query with sql_db_query!', db=<langchain_community.utilities.sql_database.SQLDatabase object at 0x000001D15C9749B0>, llm=ChatOpenAI(client=<openai.resources.chat.completions.Completions object at 0x000001D17B4453D0>, async_client=<openai.resources.chat.completions.AsyncCompletions object at 0x000001D17B446D80>, temperature=0.0, openai_api_key=SecretStr('**********'), openai_proxy=''), llm_chain=LLMChain(prompt=PromptTemplate(input_variables=['dialect', 'query'], template='\n{query}\nDouble check the {dialect} query above for common mistakes, including:\n- Using NOT IN with NULL values\n- Using UNION when UNION ALL should have been used\n- Using BETWEEN for exclusive ranges\n- Data type mismatch in predicates\n- Properly quoting identifiers\n- Using the correct number of arguments for functions\n- Casting to the correct data type\n- Using the proper columns for joins\n\nIf there are any of the above mistakes, rewrite the query. If there are no mistakes, just reproduce the original query.\n\nOutput the final SQL query only.\n\nSQL Query: '), llm=ChatOpenAI(client=<openai.resources.chat.completions.Completions object at 0x000001D17B4453D0>, async_client=<openai.resources.chat.completions.AsyncCompletions object at 0x000001D17B446D80>, temperature=0.0, openai_api_key=SecretStr('**********'), openai_proxy='')))]
```

æ‰§è¡Œï¼šagent_executor.invoke("Describe the full_llm_cache table")

```
> Entering new SQL Agent Executor chain...

Invoking: `sql_db_schema` with `{'table_names': 'full_llm_cache'}`

CREATE TABLE full_llm_cache (
	prompt VARCHAR NOT NULL, 
	llm VARCHAR NOT NULL, 
	idx INTEGER NOT NULL, 
	response VARCHAR, 
	PRIMARY KEY (prompt, llm, idx)
)

/*
3 rows from full_llm_cache table:
prompt	llm	idx	response
[{"lc": 1, "type": "constructor", "id": ["langchain", "schema", "messages", "HumanMessage"], "kwargs	{"id": ["langchain", "chat_models", "openai", "ChatOpenAI"], "kwargs": {"max_retries": 2, "model_nam	0	{"lc": 1, "type": "constructor", "id": ["langchain", "schema", "output", "ChatGeneration"], "kwargs"
*/The `full_llm_cache` table has the following structure:

- `prompt`: A VARCHAR field that is part of the primary key. It cannot be NULL.
- `llm`: A VARCHAR field that is also part of the primary key. It cannot be NULL.
- `idx`: An INTEGER field that is part of the primary key as well. It cannot be NULL.
- `response`: A VARCHAR field that can contain NULL values.

Here are some sample rows from the `full_llm_cache` table:

| prompt | llm | idx | response |
|--------|-----|-----|----------|
| [{"lc": 1, "type": "constructor", "id": ["langchain", "schema", "messages", "HumanMessage"], "kwargs | {"id": ["langchain", "chat_models", "openai", "ChatOpenAI"], "kwargs": {"max_retries": 2, "model_nam | 0 | {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "output", "ChatGeneration"], "kwargs" |

> Finished chain.
```

# LangChainå¼€å‘Agentæ™ºèƒ½ä½“

## åˆ›å»ºå’Œè¿è¡Œ Agent

å•ç‹¬æ¥è¯´ï¼Œè¯­è¨€æ¨¡å‹æ— æ³•é‡‡å–è¡ŒåŠ¨ - å®ƒä»¬åªèƒ½è¾“å‡ºæ–‡æœ¬ã€‚LangChain çš„ä¸€ä¸ªé‡è¦ç”¨ä¾‹æ˜¯åˆ›å»º**ä»£ç†**ã€‚ä»£ç†æ˜¯ä½¿ç”¨ LLM ä½œä¸ºæ¨ç†å¼•æ“çš„ç³»

ç»Ÿï¼Œç”¨äºç¡®å®šåº”é‡‡å–å“ªäº›è¡ŒåŠ¨ä»¥åŠè¿™äº›è¡ŒåŠ¨çš„è¾“å…¥åº”è¯¥æ˜¯ä»€ä¹ˆã€‚ç„¶åå¯ä»¥å°†è¿™äº›è¡ŒåŠ¨çš„ç»“æœåé¦ˆç»™ä»£ç†ï¼Œå¹¶ç¡®å®šæ˜¯å¦éœ€è¦æ›´å¤šè¡ŒåŠ¨ï¼Œæˆ–è€…

æ˜¯å¦å¯ä»¥ç»“æŸã€‚æ„å»ºä¸€ä¸ªå¯ä»¥ä¸å¤šç§ä¸åŒå·¥å…·è¿›è¡Œäº¤äº’çš„ä»£ç†ï¼šä¸€ä¸ªæ˜¯æœ¬åœ°æ•°æ®åº“ï¼Œå¦ä¸€ä¸ªæ˜¯æœç´¢å¼•æ“ã€‚èƒ½å¤Ÿå‘è¯¥ä»£ç†æé—®ï¼Œè§‚å¯Ÿå®ƒè°ƒç”¨

å·¥å…·ï¼Œå¹¶ä¸å®ƒè¿›è¡Œå¯¹è¯ã€‚ä¸‹é¢å°†ä»‹ç»ä½¿ç”¨ LangChain ä»£ç†è¿›è¡Œæ„å»ºã€‚LangChain ä»£ç†é€‚åˆå…¥é—¨ï¼Œä½†åœ¨ä¸€å®šç¨‹åº¦ä¹‹åï¼Œå¸Œæœ›æ‹¥æœ‰å®ƒä»¬æ— æ³•

æä¾›çš„çµæ´»æ€§å’Œæ§åˆ¶æ€§ã€‚è¦ä½¿ç”¨æ›´é«˜çº§çš„ä»£ç†ï¼Œæˆ‘ä»¬å»ºè®®æŸ¥çœ‹LangGraph

### æ¦‚å¿µ

æˆ‘ä»¬å°†æ¶µç›–çš„æ¦‚å¿µåŒ…æ‹¬ï¼š

- ä½¿ç”¨[è¯­è¨€æ¨¡å‹](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#chat-models)ï¼Œç‰¹åˆ«æ˜¯å®ƒä»¬çš„å·¥å…·è°ƒç”¨èƒ½åŠ›
- åˆ›å»º[æ£€ç´¢å™¨](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#retrievers)ä»¥å‘æˆ‘ä»¬çš„ä»£ç†å…¬å¼€ç‰¹å®šä¿¡æ¯
- ä½¿ç”¨æœç´¢[å·¥å…·](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#tools)åœ¨çº¿æŸ¥æ‰¾ä¿¡æ¯
- [èŠå¤©å†å²](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#chat-history)ï¼Œå…è®¸èŠå¤©æœºå™¨äººâ€œè®°ä½â€è¿‡å»çš„äº¤äº’ï¼Œå¹¶åœ¨å›ç­”åç»­é—®é¢˜æ—¶è€ƒè™‘å®ƒä»¬ã€‚
- ä½¿ç”¨[LangSmith](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#langsmith)è°ƒè¯•å’Œè·Ÿè¸ªæ‚¨çš„åº”ç”¨ç¨‹åº

### å®‰è£…

è¦å®‰è£… LangChainï¼Œè¯·è¿è¡Œï¼š

```python
pip install langchain
```

#### LangSmith

ä½¿ç”¨ LangChain æ„å»ºçš„è®¸å¤šåº”ç”¨ç¨‹åºå°†åŒ…å«å¤šä¸ªæ­¥éª¤ï¼Œå…¶ä¸­ä¼šå¤šæ¬¡è°ƒç”¨ LLMã€‚éšç€è¿™äº›åº”ç”¨ç¨‹åºå˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œèƒ½å¤Ÿæ£€æŸ¥é“¾æˆ–ä»£ç†å†…

éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆå˜å¾—è‡³å…³é‡è¦ã€‚è¿™æ ·åšçš„æœ€ä½³æ–¹å¼æ˜¯ä½¿ç”¨[LangSmith](https://smith.langchain.com/)ã€‚åœ¨ä¸Šé¢çš„é“¾æ¥æ³¨å†Œåï¼Œè¯·ç¡®ä¿è®¾ç½®æ‚¨çš„ç¯å¢ƒå˜é‡ä»¥å¼€å§‹è®°å½•è·Ÿè¸ªï¼š

```
export LANGCHAIN_TRACING_V2="true"
export LANGCHAIN_API_KEY="..."
```

### å®šä¹‰å·¥å…·

é¦–å…ˆéœ€è¦åˆ›å»ºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„å·¥å…·ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸¤ä¸ªå·¥å…·ï¼š[Tavily](http://www.aidoczh.com/langchain/v0.2/docs/integrations/tools/tavily_search/)ï¼ˆç”¨äºåœ¨çº¿æœç´¢ï¼‰ï¼Œç„¶åæ˜¯æˆ‘ä»¬å°†åˆ›å»ºçš„æœ¬åœ°ç´¢å¼•ä¸Šçš„æ£€ç´¢å™¨ã€‚

#### Tavily

LangChain ä¸­æœ‰ä¸€ä¸ªå†…ç½®å·¥å…·ï¼Œå¯ä»¥è½»æ¾ä½¿ç”¨ Tavily æœç´¢å¼•æ“ä½œä¸ºå·¥å…·ã€‚è¿™éœ€è¦ä¸€ä¸ª API å¯†é’¥ - ä»–ä»¬æœ‰ä¸€ä¸ªå…è´¹çš„å±‚çº§ï¼Œ

```python
from langchain_community.tools import TavilySearchResults

from docs.S.LangChainå­¦ä¹ è®°å½•.demo.getchat import get_key

search = TavilySearchResults(tavily_api_key=get_key("tavily_api_key") ,max_results=2)

print(search.invoke("ä¸Šæµ·çš„å¤©æ°”æ€ä¹ˆæ ·"))
```

```
[{'url': 'http://sh.cma.gov.cn/sh/tqyb/jrtq/', 'content': 'ä¸Šæµ·ä»Šå¤©æ°”æ¸©åº¦30â„ƒï½38â„ƒï¼Œåå—é£é£åŠ›4-5çº§ï¼Œæœ‰å¤šäº‘å’Œé›·é˜µé›¨çš„å¯èƒ½ã€‚ç”Ÿæ´»æ°”è±¡æŒ‡æ•°æ˜¾ç¤ºï¼Œæ°”æ¸©é«˜ï¼Œäººä½“æ„Ÿè§‰ä¸èˆ’é€‚ï¼Œä¸é€‚å®œæˆ·å¤–æ´»åŠ¨ã€‚'}]
```

#### Retriever

Retriever æ˜¯ langchain åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºæ£€ç´¢å·¥å…·ã€‚æ£€ç´¢å·¥å…·çš„ä¸»è¦ç”¨é€”æ˜¯ä»å¤§å‹æ–‡æœ¬é›†åˆæˆ–çŸ¥è¯†åº“ä¸­æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ã€‚å®ƒä»¬é€šå¸¸ç”¨

äºé—®ç­”ç³»ç»Ÿã€å¯¹è¯ä»£ç†å’Œå…¶ä»–éœ€è¦ä»å¤§é‡æ–‡æœ¬æ•°æ®ä¸­æå–ä¿¡æ¯çš„åº”ç”¨ç¨‹åºã€‚å¯ä»¥åœ¨è‡ªå·±çš„ä¸€äº›æ•°æ®ä¸Šåˆ›å»ºä¸€ä¸ªRetrieverã€‚æœ‰å…³æ¯ä¸ªæ­¥éª¤çš„

æ›´æ·±å…¥è§£é‡Šï¼Œè¯·å‚é˜…æ­¤æ•™ç¨‹ã€‚

```python
from langchain_community.document_loaders import WebBaseLoader
from langchain_community.vectorstores import FAISS
from langchain_openai import OpenAIEmbeddings
from langchain_text_splitters import RecursiveCharacterTextSplitter
loader = WebBaseLoader("https://www.thepaper.cn/newsdetail_forward_28688049")

docs = loader.load()

documents = RecursiveCharacterTextSplitter(
    chunk_size=200, chunk_overlap=20
).split_documents(docs)

vector = FAISS.from_documents(documents, OpenAIEmbeddings(
        base_url=get_key("base_url"),
        api_key=get_key("api_key")
))

retriever = vector.as_retriever()

print(retriever.invoke("iphone16çš„ä»·æ ¼")[0])
```

```
page_content='16äº”ç§é¢œè‰²ï¼Œ5999å…ƒèµ·å”®ä¸­å›½å®˜ç½‘æ˜¾ç¤ºï¼ŒiPhone 16å’ŒiPhone 16 Plusèµ·å”®ä»·åˆ†åˆ«ä¸º5999å…ƒå’Œ6999å…ƒã€‚iPhone 16å’ŒiPhone 16 Pluså…±æœ‰äº”ç§é¢œè‰²å¯é€‰ï¼Œåˆ†åˆ«ä¸ºé»‘è‰²ã€ç™½è‰²ã€ç²‰è‰²ã€æ·±é’è‰²å’Œç¾¤é’è‰²ã€‚æ‘„åƒå¤´æ’åˆ—æ–¹å¼ä»æ­¤å‰çš„å¯¹è§’å¼åˆ†å¸ƒå˜ä¸ºå‚ç›´æ’åˆ—ã€‚iPhone16ç³»åˆ—å±å¹•æ–¹é¢ï¼Œè‹¹æœä»‹ç»ï¼ŒiPhone 16ä½¿ç”¨äº†è‹¹æœæœ€ç¡¬çš„å¼ºåº¦ç»ç’ƒï¼Œå¯ä¿æŠ¤æ˜¾ç¤ºå±å…å—åˆ®ä¼¤ã€‚iPhone' metadata={'source': 'https://www.thepaper.cn/newsdetail_forward_28688049', 'title': 'iPhone 16å‘å¸ƒï¼šå”®ä»·5999å…ƒèµ·ï¼Œæ–°å¢æ²™æ¼ é‡‘é…è‰²ï¼ŒAIåŠŸèƒ½æ¥äº†_10%å…¬å¸_æ¾æ¹ƒæ–°é—»-The Paper', 'description': 'åŒ—äº¬æ—¶é—´9æœˆ10æ—¥å‡Œæ™¨ï¼Œè‹¹æœå…¬å¸å¬å¼€ç§‹å­£ç‰¹åˆ«æ´»åŠ¨ï¼Œæ­£å¼å‘å¸ƒiPhone 16ç³»åˆ—æ‰‹æœºå’ŒApple Watch Series 10ç³»åˆ—æ‰‹è¡¨ï¼Œä»¥åŠAirPods 4', 'language': 'No language found.'}
```

#### å·¥å…·

æ—¢ç„¶éƒ½åˆ›å»ºå¥½äº†ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå·¥å…·åˆ—è¡¨ï¼Œä»¥ä¾¿åœ¨ä¸‹æ¸¸ä½¿ç”¨ã€‚

```python
tools = [search, retriever_tool]
```

## ä½¿ç”¨è¯­è¨€æ¨¡å‹

æ¥ä¸‹æ¥ï¼Œå¦‚ä½•ä½¿ç”¨è¯­è¨€æ¨¡å‹æ¥è°ƒç”¨å·¥å…·ã€‚LangChainæ”¯æŒè®¸å¤šå¯ä»¥äº’æ¢ä½¿ç”¨çš„ä¸åŒè¯­è¨€æ¨¡å‹ - é€‰æ‹©æƒ³è¦ä½¿ç”¨çš„è¯­è¨€æ¨¡å‹ï¼

```python
model = get_chat('gpt-4o')

response = model.invoke([HumanMessage(content="ä½ å¥½")])
print(response.content)
```

å¯ä»¥é€šè¿‡ä¼ å…¥æ¶ˆæ¯åˆ—è¡¨æ¥è°ƒç”¨è¯­è¨€æ¨¡å‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå“åº”æ˜¯ä¸€ä¸ª`content`å­—ç¬¦ä¸²ã€‚

```python
content='ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼ŸğŸ˜Š' 
```

å¯ä»¥çœ‹çœ‹å¦‚ä½•ä½¿è¿™ä¸ªæ¨¡å‹èƒ½å¤Ÿè°ƒç”¨å·¥å…·ã€‚ä¸ºäº†ä½¿å…¶å…·å¤‡è¿™ç§èƒ½åŠ›ï¼Œä½¿ç”¨`.bind_tools`æ¥è®©è¯­è¨€æ¨¡å‹äº†è§£è¿™äº›å·¥å…·ã€‚

```python
model_with_tools = model.bind_tools(tools)
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨æ¨¡å‹äº†ã€‚è®©æˆ‘ä»¬é¦–å…ˆç”¨ä¸€ä¸ªæ™®é€šçš„æ¶ˆæ¯æ¥è°ƒç”¨å®ƒï¼Œçœ‹çœ‹å®ƒçš„å“åº”ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹`content`å­—æ®µå’Œ`tool_calls`å­—æ®µã€‚

```python
tools = [search, retriever_tool]

model = get_chat('gpt-4o')
#
# response = model.invoke([HumanMessage(content="ä½ å¥½")])
# print(response)

model_with_tools = model.bind_tools(tools)

response = model_with_tools.invoke([HumanMessage(content="ä½ æ˜¯è°")])

print(response.content)
print(response.tool_calls)
```

```
æˆ‘æ˜¯ä¸€ä¸ªç”±äººå·¥æ™ºèƒ½é©±åŠ¨çš„åŠ©æ‰‹ï¼Œå¯ä»¥å›ç­”ä½ çš„é—®é¢˜ã€æä¾›ä¿¡æ¯å’Œå¸®åŠ©è§£å†³é—®é¢˜ã€‚ä½ å¯ä»¥é—®æˆ‘ä»»ä½•äº‹æƒ…ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ
[]
```

å°è¯•ä½¿ç”¨ä¸€äº›æœŸæœ›è°ƒç”¨å·¥å…·çš„è¾“å…¥æ¥è°ƒç”¨å®ƒã€‚

```python
response = model_with_tools.invoke([HumanMessage(content="ä»Šå¤©äº¬ä¸œçš„è‚¡ä»·")])

print(response.content)
print(response.tool_calls)
```

å¯ä»¥çœ‹åˆ°ç°åœ¨æ²¡æœ‰å†…å®¹ï¼Œä½†æœ‰ä¸€ä¸ªå·¥å…·è°ƒç”¨ï¼è¦æ±‚æˆ‘ä»¬è°ƒç”¨Tavily Searchå·¥å…·ã€‚è¿™å¹¶ä¸æ˜¯åœ¨è°ƒç”¨è¯¥å·¥å…· - å®ƒåªæ˜¯å‘Šè¯‰æˆ‘ä»¬è¦è°ƒç”¨ã€‚ä¸ºäº†å®

é™…è°ƒç”¨å®ƒï¼Œæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„ä»£ç†ç¨‹åºã€‚

## åˆ›å»ºä»£ç†ç¨‹åº

æ—¢ç„¶æˆ‘ä»¬å·²ç»å®šä¹‰äº†å·¥å…·å’ŒLLMï¼Œå¯ä»¥åˆ›å»ºä»£ç†ç¨‹åºã€‚å°†ä½¿ç”¨ä¸€ä¸ªå·¥å…·è°ƒç”¨ä»£ç†ç¨‹åº - æœ‰å…³æ­¤ç±»ä»£ç†ç¨‹åºä»¥åŠå…¶ä»–é€‰é¡¹çš„æ›´å¤šä¿¡

æ¯ï¼Œè¯·å‚é˜…[æ­¤æŒ‡å—](http://www.aidoczh.com/langchain/v0.2/docs/concepts/#agent_types/)ã€‚å¯ä»¥é¦–å…ˆé€‰æ‹©è¦ç”¨æ¥æŒ‡å¯¼ä»£ç†ç¨‹åºçš„æç¤ºã€‚å¦‚æœæƒ³æŸ¥çœ‹æ­¤æç¤ºçš„å†…å®¹å¹¶è®¿é—®LangSmithã€‚

```python
#ç¤ºä¾‹ï¼šagent_tools_create.py
from langchain import hub
# è·å–è¦ä½¿ç”¨çš„æç¤º - æ‚¨å¯ä»¥ä¿®æ”¹è¿™ä¸ªï¼
prompt = hub.pull("hwchase17/openai-functions-agent")
prompt.messages
```

```
[SystemMessagePromptTemplate(prompt=PromptTemplate(input_variables=[], input_types={}, partial_variables={}, template='You are a helpful assistant'), additional_kwargs={}), MessagesPlaceholder(variable_name='chat_history', optional=True), HumanMessagePromptTemplate(prompt=PromptTemplate(input_variables=['input'], input_types={}, partial_variables={}, template='{input}'), additional_kwargs={}), MessagesPlaceholder(variable_name='agent_scratchpad')]
```

## è¿è¡Œä»£ç†

ç°åœ¨ï¼Œå¯ä»¥åœ¨å‡ ä¸ªæŸ¥è¯¢ä¸Šè¿è¡Œä»£ç†ï¼è¯·æ³¨æ„ï¼Œç›®å‰è¿™äº›éƒ½æ˜¯**æ— çŠ¶æ€**æŸ¥è¯¢ï¼ˆå®ƒä¸ä¼šè®°ä½å…ˆå‰çš„äº¤äº’ï¼‰ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å½“ä¸éœ€è¦è°ƒç”¨

å·¥å…·æ—¶å®ƒå¦‚ä½•å›åº”ï¼š

```python
from langchain.agents import AgentExecutor, create_openai_functions_agent
prompt = hub.pull("hwchase17/openai-functions-agent")

agent = create_openai_functions_agent(model, tools, prompt)

agent_executor = AgentExecutor(
    agent=agent,
    tools=tools,
    verbose=True,
)

print(agent_executor.invoke({"input": "ä½ å¥½"}))
```

```python
{'input': 'ä½ å¥½', 'output': 'ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ'}
```

ç°åœ¨è®©å°è¯•ä¸€ä¸ªåº”è¯¥è°ƒç”¨æ£€ç´¢å™¨çš„ç¤ºä¾‹ï¼š

```python
print(agent_executor.invoke({"input": "ä¸Šæµ·å¤©æ°”"}))
{'input': 'ä¸Šæµ·å¤©æ°”', 'output': 'å½“å‰ä¸Šæµ·çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š\n\n- æ¸©åº¦èŒƒå›´ï¼š19Â°C è‡³ 27Â°C\n- å¤©æ°”çŠ¶å†µï¼šæ™´\n\nå¦‚æœæ‚¨éœ€è¦æ›´è¯¦ç»†çš„å¤©æ°”é¢„æŠ¥ï¼Œå¯ä»¥è®¿é—®[å¤©æ°”ç½‘ä¸Šæµ·å¤©æ°”é¢„æŠ¥](https://www.tianqi.com/shanghai/)æŸ¥çœ‹æœªæ¥å‡ å¤©çš„è¯¦ç»†å¤©æ°”æƒ…å†µã€‚'}
```

è¯¦ç»†è°ƒç”¨ä¿¡æ¯

```
> Entering new AgentExecutor chain...

Invoking: `tavily_search` with `{'query': 'ä¸Šæµ·å¤©æ°”'}`

{'query': 'ä¸Šæµ·å¤©æ°”', 'follow_up_questions': None, 'answer': None, 'images': [], 'results': [{'title': 'ã€ä¸Šæµ·å¤©æ°”é¢„æŠ¥ã€‘ä¸Šæµ·å¤©æ°”é¢„æŠ¥ä¸€å‘¨,ä¸Šæµ·å¤©æ°”é¢„æŠ¥15å¤©,30å¤©,ä»Šå¤©,æ˜å¤©,7å¤©,10å¤©,æœªæ¥ä¸Šæµ·ä¸€å‘¨å¤©æ°”é¢„æŠ¥æŸ¥è¯¢â€”å¤©æ°”ç½‘', 'url': 'https://www.tianqi.com/shanghai/', 'content': '20â„ƒ æ™´19 ~ 27â„ƒ æ™´19 ~ 27â„ƒ æ™´18 ~ 26â„ƒ æ™´19 ~ 28â„ƒ æ™´18 ~ 27â„ƒ æ™´18 ~ 27â„ƒ æ™´19 ~ 27â„ƒ æ™´18 ~ 26â„ƒ æ™´16 ~ 28â„ƒ æ™´19 ~ 27â„ƒ æ™´16 ~ 25â„ƒ æ™´15 ~ 26â„ƒ æ™´18 ~ 27â„ƒ æ™´18 ~ 26â„ƒ æ™´18 ~ 27â„ƒ æ™´18 ~ 27â„ƒ æ™´18 ~ 27â„ƒ æ™´17 ~ 27â„ƒ æ™´17 ~ 27â„ƒ æ™´18 ~ 28â„ƒ æ™´15 ~ 28â„ƒ æ™´17 ~ 28â„ƒ æ™´15 ~ 25â„ƒ å¤šäº‘17 ~ 27â„ƒ å¤šäº‘18 ~ 24â„ƒ æ™´17 ~ 28â„ƒ æ™´17 ~ 28â„ƒ æ™´17 ~ 24â„ƒ æ™´19 ~ 28â„ƒ æ™´15 ~ 29â„ƒ ### â€¢ Vankooæ»‘é›ªå·¥å‚æ»‘é›ªåœº ### â€¢ è€ç å¤´åˆ›æ„å›­åŒº ### â€¢ ä¸Šæµ·åŸéšåº™ ### â€¢ ä¸Šæµ·ç§‘æŠ€é¦† ### â€¢ æœ±å®¶è§’å¤é•‡ ### â€¢ é¡¾æ‘å…¬å›­ ### â€¢ è±«å›­ ### â€¢ ç”°å­åŠ ### â€¢ ä¸–åšä¼š ä¸¾æŠ¥é‚®ç®±:kf@tianqi.com æœ¬ç«™éƒ¨åˆ†æ–‡å­—å†…å®¹ã€å›¾ç‰‡é€‰å–è‡ªç½‘ç»œï¼Œå¦‚ä¾µæƒè¯·è”ç³»åˆ é™¤ï¼Œè”ç³»é‚®ç®±:kf@tianqi.com', 'score': 0.7872945, 'raw_content': None}, {'title': 'ä¸Šæµ·å¤©æ°”é¢„æŠ¥,ä¸Šæµ·7å¤©å¤©æ°”é¢„æŠ¥,ä¸Šæµ·15å¤©å¤©æ°”é¢„æŠ¥,ä¸Šæµ·å¤©æ°”æŸ¥è¯¢', 'url': 'https://www.weather.com.cn/weather/101020100.shtml', 'content': 'Ã¥\x8fÂ°Ã©Â£\x8eÃ¨Â·Â¯Ã¥Â¾\x84 Ã§Â©ÂºÃ©\x97Â´Ã¥Â¤Â©Ã¦Â°\x94 Ã¥\x9bÂ¾Ã§\x89\x87 Ã¤Â¸\x93Ã©Â¢\x98 Ã§\x8eÂ¯Ã¥Â¢\x83 Ã¦\x97\x85Ã¦Â¸Â¸ Ã§Â¢Â³Ã¤Â¸\xadÃ¥\x92\x8c Ã¥\x85Â¨Ã¥\x9bÂ½ Ã¥\x91Â¨Ã¨Â¾Â¹Ã¦\x99Â¯Ã§\x82Â¹ 31/22Ã¢\x84\x83 31/23Ã¢\x84\x83 25/23Ã¢\x84\x83 26/21Ã¢\x84\x83 27/20Ã¢\x84\x83 24/22Ã¢\x84\x83 23/21Ã¢\x84\x83 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã§\x9f\xadÃ¨Â¡Â«Ã£\x80\x81Ã§\x9f\xadÃ¨Â£Â¤Ã§\xad\x89Ã¦Â¸\x85Ã¥\x87\x89Ã¥Â¤\x8fÃ¥\xadÂ£Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¦\x97 Ã©\x9bÂ¨Ã¤Â¸\x94Ã©Â£\x8eÃ¥\x8a\x9bÃ¨Â¾\x83Ã¥Â°\x8fÃ¯Â¼\x8cÃ¦\x98\x93Ã¤Â¿\x9dÃ¦\x8c\x81Ã¦Â¸\x85Ã¦Â´\x81Ã¥ÂºÂ¦Ã£\x80\x82 Ã¦Â¶\x82Ã¦\x93Â¦SPFÃ¥Â¤Â§Ã¤Âº\x8e15Ã£\x80\x81PA+Ã©\x98Â²Ã¦\x99\x92Ã¦\x8aÂ¤Ã¨\x82Â¤Ã¥\x93\x81Ã£\x80\x82 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã§\x9f\xadÃ¨Â¡Â«Ã£\x80\x81Ã§\x9f\xadÃ¨Â£Â¤Ã§\xad\x89Ã¦Â¸\x85Ã¥\x87\x89Ã¥Â¤\x8fÃ¥\xadÂ£Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã©\x95Â¿Ã¨Â¢\x96Ã¨Â¡Â¬Ã¨Â¡Â«Ã¥\x8d\x95Ã¨Â£Â¤Ã§\xad\x89Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¨Â¾\x90Ã¥Â°\x84Ã¥Â¼Â±Ã¯Â¼\x8cÃ¦Â¶\x82Ã¦\x93Â¦SPF8-12Ã©\x98Â²Ã¦\x99\x92Ã¦\x8aÂ¤Ã¨\x82Â¤Ã¥\x93\x81Ã£\x80\x82 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã©\x95Â¿Ã¨Â¢\x96Ã¨Â¡Â¬Ã¨Â¡Â«Ã¥\x8d\x95Ã¨Â£Â¤Ã§\xad\x89Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¨Â¾\x90Ã¥Â°\x84Ã¥Â¼Â±Ã¯Â¼\x8cÃ¦Â¶\x82Ã¦\x93Â¦SPF8-12Ã©\x98Â²Ã¦\x99\x92Ã¦\x8aÂ¤Ã¨\x82Â¤Ã¥\x93\x81Ã£\x80\x82 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã©\x95Â¿Ã¨Â¢\x96Ã¨Â¡Â¬Ã¨Â¡Â«Ã¥\x8d\x95Ã¨Â£Â¤Ã§\xad\x89Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¨Â¾\x90Ã¥Â°\x84Ã¥Â¼Â±Ã¯Â¼\x8cÃ¦Â¶\x82Ã¦\x93Â¦SPF8-12Ã©\x98Â²Ã¦\x99\x92Ã¦\x8aÂ¤Ã¨\x82Â¤Ã¥\x93\x81Ã£\x80\x82 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã¨\x96\x84Ã¥Â¤\x96Ã¥Â¥\x97Ã¦\x88\x96Ã§\x89\x9bÃ¤Â»\x94Ã¨Â£Â¤Ã§\xad\x89Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¨Â¾\x90Ã¥Â°\x84Ã¥Â¼Â±Ã¯Â¼\x8cÃ¦Â¶\x82Ã¦\x93Â¦SPF8-12Ã©\x98Â²Ã¦\x99\x92Ã¦\x8aÂ¤Ã¨\x82Â¤Ã¥\x93\x81Ã£\x80\x82 Ã¥Â»ÂºÃ¨Â®Â®Ã§Â©Â¿Ã¨\x96\x84Ã¥Â¤\x96Ã¥Â¥\x97Ã¦\x88\x96Ã§\x89\x9bÃ¤Â»\x94Ã¨Â£Â¤Ã§\xad\x89Ã¦\x9c\x8dÃ¨Â£\x85Ã£\x80\x82 Ã¨Â¾\x90Ã¥Â°\x84Ã¥Â¼Â±Ã¯Â¼\x8cÃ¦Â¶\x82Ã¦\x93Â¦SPF8-12Ã©\x98Â²Ã¦\x99\x92Ã¦\x8aÂ¤Ã¨\x82Â¤Ã¥\x93\x81Ã£\x80\x82 # Ã¥\x91Â¨Ã¨Â¾Â¹Ã¥\x9cÂ°Ã¥\x8cÂº | Ã¥\x91Â¨Ã¨Â¾Â¹Ã¦\x99Â¯Ã§\x82Â¹ 2025-06-05 07:30Ã¦\x9bÂ´Ã¦\x96Â° # Ã¥\x91Â¨Ã¨Â¾Â¹Ã¥\x9cÂ°Ã¥\x8cÂº | Ã¥\x91Â¨Ã¨Â¾Â¹Ã¦\x99Â¯Ã§\x82Â¹ 2025-06-05 07:30Ã¦\x9bÂ´Ã¦\x96Â° # Ã©Â«\x98Ã¦Â¸\x85Ã¥\x9bÂ¾Ã©\x9b\x86 Ã©\x9d\x92Ã¦ÂµÂ·Ã¨Â¥Â¿Ã¥Â®\x81Ã¥\x87ÂºÃ§\x8eÂ°Ã¦\x97Â¥Ã¦\x99\x95Ã¦\x99Â¯Ã¨Â§\x82 Ã¥\x85\x89Ã§\x8eÂ¯Ã©\x97ÂªÃ¨\x80\x80Ã¥Â¤Â©Ã§Â©Âº Ã¥\x8c\x85Ã§Â½\x97Ã¤Â¸\x87Ã¢\x80\x9cÃ©Â¦\x85Ã¢\x80\x9dÃ§Â²Â½Ã¤ÂºÂ«Ã§Â«Â¯Ã¥\x8d\x88Ã¥Â¥Â½Ã¦\x97Â¶Ã¥\x85\x89 Ã¥\x85Â¨Ã¥\x9bÂ½Ã¥Â¤Â§Ã©\x83Â¨Ã¦\x99Â´Ã¥Â¤\x9aÃ©\x9bÂ¨Ã¥Â°\x91 Ã¥\x8c\x97Ã¦\x96Â¹Ã¥Â¹Â²Ã§\x83\xadÃ¦\x9aÂ´Ã¦\x99\x92Ã¥\x8d\x97Ã¦\x96Â¹Ã©\x97Â·Ã§\x83\xadÃ©\x9aÂ¾Ã¨\x80\x90 ## Ã¥\x85Â¨Ã¥\x9bÂ½Ã¥Â¤Â§Ã©\x83Â¨Ã¦\x99Â´Ã¥Â¤\x9aÃ©\x9bÂ¨Ã¥Â°\x91 Ã¥\x8c\x97Ã¦\x96Â¹Ã¥Â¹Â²Ã§\x83\xadÃ¦\x9aÂ´Ã¦\x99\x92Ã¥\x8d\x97Ã¦\x96Â¹Ã©\x97Â·Ã§\x83\xadÃ©\x9aÂ¾Ã¨\x80\x90 Ã©\x95Â¿Ã¦Â±\x9fÃ¤Â¸\xadÃ¤Â¸\x8bÃ¦Â¸Â¸Ã¤Â»\x8aÃ¥Â¤Â©Ã¤Â»\x8dÃ¤Â¸ÂºÃ©\x99\x8dÃ©\x9bÂ¨Ã¦ Â¸Ã¥Â¿\x83Ã¥\x8cÂº Ã¥\x8d\x8eÃ¥\x8d\x97Ã¥Â¤Â©Ã¦Â°\x94Ã©\x97Â·Ã§\x83\xadÃ¥Â¤\x9aÃ¥\x9cÂ°Ã¤Â½\x93Ã¦\x84\x9fÃ¦\x88\x96Ã¨Â¶\x8540Ã¢\x84\x83 ## Ã©\x95Â¿Ã¦Â±\x9fÃ¤Â¸\xadÃ¤Â¸\x8bÃ¦Â¸Â¸Ã¤Â»\x8aÃ¥Â¤Â©Ã¤Â»\x8dÃ¤Â¸ÂºÃ©\x99\x8dÃ©\x9bÂ¨Ã¦ Â¸Ã¥Â¿\x83Ã¥\x8cÂº Ã¥\x8d\x8eÃ¥\x8d\x97Ã¥Â¤Â©Ã¦Â°\x94Ã©\x97Â·Ã§\x83\xadÃ¥Â¤\x9aÃ¥\x9cÂ°Ã¤Â½\x93Ã¦\x84\x9fÃ¦\x88\x96Ã¨Â¶\x8540Ã¢\x84\x83 Ã¥\x8d\x97Ã¦\x96Â¹Ã¨Â¿\x9bÃ¥\x85Â¥Ã©\x99\x8dÃ©\x9bÂ¨Ã¦\x9c\x80Ã¥Â¼ÂºÃ¦\x97Â¶Ã¦Â®Âµ Ã¤Â¸\x9cÃ¥\x8c\x97Ã¦\x8c\x81Ã§Â»\xadÃ¦\x99Â´Ã§\x83\xadÃ©\x83Â¨Ã¥\x88\x86Ã¥\x9cÂ°Ã¥\x8cÂºÃ¦\x9c\x80Ã©Â«\x98Ã¦Â¸Â©Ã¦\x88\x96Ã¨Â¶\x8530Ã¢\x84\x83 ## Ã¥\x8d\x97Ã¦\x96Â¹Ã¨Â¿\x9bÃ¥\x85Â¥Ã©\x99\x8dÃ©\x9bÂ¨Ã¦\x9c\x80Ã¥Â¼ÂºÃ¦\x97Â¶Ã¦Â®Âµ Ã¤Â¸\x9cÃ¥\x8c\x97Ã¦\x8c\x81Ã§Â»\xadÃ¦\x99Â´Ã§\x83\xadÃ©\x83Â¨Ã¥\x88\x86Ã¥\x9cÂ°Ã¥\x8cÂºÃ¦\x9c\x80Ã©Â«\x98Ã¦Â¸Â©Ã¦\x88\x96Ã¨Â¶\x8530Ã¢\x84\x83 # Ã¦\x9bÂ´Ã¥Â¤\x9a>>Ã©Â«\x98Ã¦Â¸\x85Ã¥\x9bÂ¾Ã©\x9b\x86 Ã¥\x8c\x85Ã§Â½\x97Ã¤Â¸\x87Ã¢\x80\x9cÃ©Â¦\x85Ã¢\x80\x9dÃ§Â²Â½Ã¤ÂºÂ«Ã§Â«Â¯Ã¥\x8d\x88Ã¥Â¥Â½Ã¦\x97Â¶Ã¥\x85\x89 Ã¥\x85\xadÃ¤Â¸\x80Ã¥\x84Â¿Ã§Â«Â¥Ã¨\x8a\x82 Ã¨\x8aÂ±Ã¨\x8aÂ±Ã¦Â¸Â¸Ã¤Â¹\x90Ã¥\x9b\xadÃ¤Â¸\xadÃ§\x9a\x84Ã¥Â¿Â«Ã¤Â¹\x90Ã§\x9eÂ¬Ã©\x97Â´ Ã©\x9d\x92Ã¦ÂµÂ·Ã¨Â¥Â¿Ã¥Â®\x81Ã¥\x87ÂºÃ§\x8eÂ°Ã¦\x97Â¥Ã¦\x99\x95Ã¦\x99Â¯Ã¨Â§\x82 Ã¥\x85\x89Ã§\x8eÂ¯Ã©\x97ÂªÃ¨\x80\x80Ã¥Â¤Â©Ã§Â©Âº # >> Ã§\x94\x9fÃ¦Â´Â»Ã¦\x97\x85Ã¦Â¸Â¸ Ã¥Â°\x8fÃ¦Â»Â¡Ã¥\x85Â»Ã§\x94\x9f Ã¦Â³Â¨Ã©\x87\x8dÃ¢\x80\x9cÃ¦\x9cÂªÃ§\x97\x85Ã¥\x85\x88Ã©\x98Â²Ã¢\x80\x9d Ã¥Â¤Â§Ã§Â¾\x8eÃ¦\x96Â°Ã§\x96\x86Ã¢\x80\x94Ã¥Â¸\x95Ã§Â±Â³Ã¥Â°\x94Ã©Â«\x98Ã¥\x8e\x9fÃ¥Â¥Â½Ã©Â£\x8eÃ¥\x85\x89 #### Ã¦\x99Â¯Ã¥\x8cÂºÃ¥Â¤Â©Ã¦Â°\x94Ã¦Â°\x94Ã¦Â¸Â© Ã¦\x97\x85Ã¦Â¸Â¸Ã¦\x8c\x87Ã¦\x95Â° Ã¥\x85Â³Ã¤Âº\x8eÃ¦\x88\x91Ã¤Â»Â¬Ã¨\x81\x94Ã§Â³Â»Ã¦\x88\x91Ã¤Â»Â¬Ã§\x94Â¨Ã¦\x88Â·Ã¥\x8f\x8dÃ©Â¦\x88', 'score': 0.71040785, 'raw_content': None}], 'response_time': 1.07}å½“å‰ä¸Šæµ·çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š

- æ¸©åº¦èŒƒå›´ï¼š19Â°C è‡³ 27Â°C
- å¤©æ°”çŠ¶å†µï¼šæ™´

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹é“¾æ¥è·å–æ›´è¯¦ç»†çš„ä¸Šæµ·å¤©æ°”é¢„æŠ¥ï¼š
- [å¤©æ°”ç½‘ä¸Šæµ·å¤©æ°”é¢„æŠ¥](https://www.tianqi.com/shanghai/)
- [ä¸­å›½å¤©æ°”ç½‘ä¸Šæµ·å¤©æ°”é¢„æŠ¥](https://www.weather.com.cn/weather/101020100.shtml)
```

ç°åœ¨è®©å°è¯•ä¸€ä¸ªéœ€è¦è°ƒç”¨æœç´¢å·¥å…·çš„ç¤ºä¾‹ï¼š

```python
print(agent_executor.invoke({"input": "å¼ çˆ½è¿™ä¸ªæ€ä¹ˆæ ·"}))
```

```
{'input': 'å¼ çˆ½è¿™ä¸ªäººæ€ä¹ˆæ ·', 'output': 'å¯¹ä¸èµ·ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°å…³äºâ€œå¼ çˆ½â€è¿™ä¸ªäººçš„å…·ä½“ä¿¡æ¯ã€‚å¦‚æœæ‚¨èƒ½æä¾›æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯æˆ–è€…å…·ä½“çš„é¢†åŸŸï¼Œæˆ‘å¯ä»¥å¸®åŠ©æ‚¨è¿›è¡Œæ›´å‡†ç¡®çš„æœç´¢ã€‚'}
```

```
> Entering new AgentExecutor chain...

Invoking: `web_search` with `{'query': 'å¼ çˆ½ äººç‰©ä»‹ç»'}`


Intelligenceï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€åœ¨ç…§ç‰‡åº”ç”¨ä¸­æœç´¢ç‰¹å®šç…§ç‰‡ï¼Œè¿˜å¯ä»¥æœç´¢è§†é¢‘ç‰‡æ®µä¸­çš„ç‰¹å®šæ—¶åˆ»ã€‚æ­¤å¤–ï¼Œæ–°çš„æ¸…ç†å·¥å…·å¯ä»¥è¯†åˆ«å¹¶ç§»é™¤ç…§ç‰‡èƒŒæ™¯ä¸­çš„å¹²æ‰°ç‰©ä½“ï¼Œè€Œä¸ä¼šæ”¹å˜ä¸»ä½“ã€‚è‹¹æœè¿˜é‡ç‚¹ä»‹ç»äº†ä¸€é¡¹æ–°çš„ç”Ÿæˆè¡¨æƒ…ç¬¦å·çš„åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½å…è®¸ç”¨æˆ·é€šè¿‡è¾“å…¥å‡ ä¸ªå•è¯æ¥åˆ›å»ºè‡ªå®šä¹‰è¡¨æƒ…ç¬¦å·ã€‚ç”Ÿæˆè¡¨æƒ…ç¬¦å·å’Œæ–°çš„è§†è§‰æ™ºèƒ½ç­‰åŠŸèƒ½ä¹Ÿå°†åœ¨ç¨åæ¨å‡ºã€‚æˆªè‡³å‘ç¨¿ï¼Œè‹¹æœç›˜åè‚¡ä»·å¾®è·Œ0.14%ï¼ŒæŠ¥220.67ç¾å…ƒ/è‚¡ã€‚è´£ä»»ç¼–è¾‘ï¼šå­™æ‰¶å›¾ç‰‡

16æ–°å¢ç›¸æœºæ§åˆ¶åŠŸèƒ½è‹¹æœä»‹ç»ï¼Œç›¸æœºæ§åˆ¶åŠŸèƒ½å°†äºä»Šå¹´ç¨æ™šæ¨å‡ºä¸¤æ®µå¼å¿«é—¨ï¼Œè½»æŒ‰æ—¶ä¼šè‡ªåŠ¨é”å®šå¯¹ç„¦å’Œæ›å…‰ï¼Œè¿™æ ·åœ¨è°ƒæ•´æ„å›¾æ—¶æ‹æ‘„ä¸»ä½“å§‹ç»ˆå¯¹ç„¦æ¸…æ™°ã€‚å‘å¸ƒä¼šä¸Šå±•ç¤ºäº†æ­¤æ¬¡æ–°æ·»çš„åŠŸèƒ½â€œè§†è§‰æ™ºèƒ½â€ã€‚ä¸€æ—¦é€šè¿‡ç›¸æœºæ§åˆ¶æŒ‰é’®å¯åŠ¨ç›¸æœºï¼Œå®ƒä¾¿èƒ½å¤Ÿå¯¹ç›¸æœºæ‰€æ•æ‰åˆ°çš„ç”»é¢å±•å¼€åˆ†æã€‚ä¾‹å¦‚ï¼Œå°†é•œå¤´å¯¹å‡†é¤å…ï¼Œä¾¿èƒ½æå–å‡ºè¯¥é¤å…çš„è¯¦å°½ä¿¡æ¯ï¼›å¯¹å‡†ä¸€åªç‹—ï¼Œå³å¯æ˜¾ç¤ºå…¶å“ç§ç­‰ç›¸å…³ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œå¼€å‘äººå‘˜è¿˜å¯ä»¥å°†ç›¸æœºæ§åˆ¶å¼•å…¥Snapchatç­‰ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹

SHANGHAISIXTH TONEæ–°é—»æŠ¥æ–™æŠ¥æ–™çƒ­çº¿: 021-962866æŠ¥æ–™é‚®ç®±: news@thepaper.cnæ²ªICPå¤‡14003370å·æ²ªå…¬ç½‘å®‰å¤‡31010602000299å·äº’è”ç½‘æ–°é—»ä¿¡æ¯æœåŠ¡è®¸å¯è¯ï¼š31120170006å¢å€¼ç”µä¿¡ä¸šåŠ¡ç»è¥è®¸å¯è¯ï¼šæ²ªB2-2017116Â© 2014-2025 ä¸Šæµ·ä¸œæ–¹æŠ¥ä¸šæœ‰é™å…¬å¸åé¦ˆ

15é‡‡ç”¨çš„A16ä»¿ç”ŸèŠ¯ç‰‡ï¼Œæ€§èƒ½è·¨ä»£æå‡ï¼Œé©±åŠ¨æ‘„å½±é£æ ¼å’Œç›¸æœºæ§åˆ¶ç­‰æ–°é”æ‹æ‘„åŠŸèƒ½ï¼Œæ¸¸æˆä½“éªŒè·ƒå‡ä¸»æœºçº§ï¼Œè€Œä¸”èƒ½æ•ˆè¡¨ç°éå‡¡ï¼Œç”µæ± ç»­èˆªæ›´å‡ºè‰²ã€‚å½±åƒæ–¹é¢ï¼ŒiPhone 16ç³»åˆ—é…å¤‡4800ä¸‡åƒç´ ä¸»æ‘„åƒå¤´ï¼Œå¯ä»¥æ‹æ‘„èåˆ2400ä¸‡åƒç´ ç…§ç‰‡ã€‚åŒæ—¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™é¢—ä¸»æ‘„æ‹æ‘„2å€ç…§ç‰‡ï¼Œè¿˜èƒ½æ‹æ‘„æœæ¯”è§†ç•Œ4Kå¯¹ä¸èµ·ï¼Œæˆ‘æ²¡æœ‰æ‰¾åˆ°å…³äºâ€œå¼ çˆ½â€è¿™ä¸ªäººçš„å…·ä½“ä¿¡æ¯ã€‚å¦‚æœæ‚¨èƒ½æä¾›æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯æˆ–è€…å…·ä½“çš„é¢†åŸŸï¼Œæˆ‘å¯ä»¥å¸®åŠ©æ‚¨è¿›è¡Œæ›´å‡†ç¡®çš„æœç´¢ã€‚
```

## æ·»åŠ è®°å¿†

å¦‚å‰æ‰€è¿°ï¼Œæ­¤ä»£ç†æ˜¯æ— çŠ¶æ€çš„ã€‚è¿™æ„å‘³ç€å®ƒä¸ä¼šè®°ä½å…ˆå‰çš„äº¤äº’ã€‚è¦ç»™å®ƒè®°å¿†ï¼Œéœ€è¦ä¼ é€’å…ˆå‰çš„`chat_history`ã€‚æ³¨æ„ï¼šç”±äºä½¿ç”¨æç¤ºï¼Œ

å®ƒéœ€è¦è¢«ç§°ä¸º`chat_history`ã€‚å¦‚æœä½¿ç”¨ä¸åŒçš„æç¤ºï¼Œå¯ä»¥æ›´æ”¹å˜é‡å

```python
response = agent_executor.invoke({"input": "æˆ‘æ˜¯å¼ çˆ½", "chat_history": []})

print(response)
```

```
{'input': 'æˆ‘æ˜¯å¼ çˆ½', 'chat_history': [], 'output': 'ä½ å¥½ï¼Œå¼ çˆ½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ'}
```

```python
response = agent_executor.invoke(
    {
        "chat_history": [
            HumanMessage(content="æˆ‘æ˜¯å¼ çˆ½"),
            AIMessage(content="ä½ å¥½ï¼Œå¼ çˆ½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ")
        ],
        "input": "æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ"
    }

)

print(response)
```

```
{'chat_history': [HumanMessage(content='æˆ‘æ˜¯å¼ çˆ½', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ å¥½ï¼Œå¼ çˆ½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ', additional_kwargs={}, response_metadata={})], 'input': 'æˆ‘çš„åå­—æ˜¯ä»€ä¹ˆï¼Ÿ', 'output': 'ä½ åˆšæ‰å‘Šè¯‰æˆ‘ä½ çš„åå­—æ˜¯å¼ çˆ½ã€‚å¦‚æœæœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼'}
```

å¦‚æœæƒ³è¦è‡ªåŠ¨è·Ÿè¸ªè¿™äº›æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶åŒ…è£…åœ¨ä¸€ä¸ªRunnableWithMessageHistoryä¸­

```python
from langchain_community.chat_message_histories import ChatMessageHistory
from langchain_core.chat_history import BaseChatMessageHistory
from langchain_core.runnables.history import RunnableWithMessageHistory

store = {}

def get_session_history(session_id: str) -> BaseChatMessageHistory:
    if session_id not in store:
        store[session_id] = ChatMessageHistory()
    return store[session_id]
```

éœ€è¦æŒ‡å®šä¸¤ä¸ªäº‹é¡¹ï¼š

- `input_messages_key`ï¼šç”¨äºå°†è¾“å…¥æ·»åŠ åˆ°å¯¹è¯å†å²è®°å½•ä¸­çš„é”®ã€‚
- `history_messages_key`ï¼šç”¨äºå°†åŠ è½½çš„æ¶ˆæ¯æ·»åŠ åˆ°å…¶ä¸­çš„é”®ã€‚

```python
agent_with_chat_history = RunnableWithMessageHistory(
    agent_executor,
    get_session_history,
    input_messages_key="input",
    history_messages_key="chat_history"
)

response = agent_with_chat_history.invoke(
    {"input": "æˆ‘çš„åå­—æ˜¯å¼ çˆ½"},
    config={"configurable": {"session_id": "abcd123"}}
)

print(response)
```

```
{'input': 'æˆ‘çš„åå­—æ˜¯å¼ çˆ½', 'chat_history': [], 'output': 'ä½ å¥½ï¼Œå¼ çˆ½ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ'}
```

```python
response = agent_with_chat_history.invoke(
    {"input": "æˆ‘çš„åå­—å«ä»€ä¹ˆ"},
    config={"configurable": {"session_id": "abcd123"}}
)

print(response)
```

```
{'input': 'æˆ‘çš„åå­—å«ä»€ä¹ˆ', 'chat_history': [HumanMessage(content='æˆ‘çš„åå­—æ˜¯å¼ çˆ½', additional_kwargs={}, response_metadata={}), AIMessage(content='ä½ å¥½ï¼Œå¼ çˆ½ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ', additional_kwargs={}, response_metadata={})], 'output': 'ä½ çš„åå­—æ˜¯å¼ çˆ½ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼'}
```

# LangChainåŸºäºRAGå®ç°æ–‡æ¡£é—®ç­”

## RAGæ˜¯ä»€ä¹ˆï¼Ÿ 

å¤§è¯­è¨€æ¨¡å‹æ‰€å®ç°çš„æœ€å¼ºå¤§åº”ç”¨ä¹‹ä¸€æ˜¯å¤æ‚çš„é—®ç­”(Q&A)èŠå¤©æœºå™¨äººã€‚è¿™äº›åº”ç”¨èƒ½å¤Ÿå›ç­”å…³äºç‰¹å®šæºä¿¡æ¯çš„é—®é¢˜ã€‚è¿™äº›åº”ç”¨ä½¿ç”¨ä¸€ç§ç§°ä¸º

æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)çš„æŠ€æœ¯ã€‚

RAGæ˜¯ä¸€ç§ç”¨é¢å¤–æ•°æ®å¢å¼ºå¤§è¯­è¨€æ¨¡å‹çŸ¥è¯†çš„æŠ€æœ¯ã€‚

å¤§è¯­è¨€æ¨¡å‹å¯ä»¥å¯¹å¹¿æ³›çš„ä¸»é¢˜è¿›è¡Œæ¨ç†ï¼Œä½†å®ƒä»¬çš„çŸ¥è¯†ä»…é™äºè®­ç»ƒæ—¶æˆªæ­¢æ—¥æœŸå‰çš„å…¬å¼€æ•°æ®ã€‚å¦‚æœä½ æƒ³æ„å»ºèƒ½å¤Ÿå¯¹ç§æœ‰æ•°æ®æˆ–æ¨¡å‹æˆªæ­¢æ—¥

æœŸåå¼•å…¥çš„æ•°æ®è¿›è¡Œæ¨ç†çš„äººå·¥æ™ºèƒ½åº”ç”¨ï¼Œä½ éœ€è¦ç”¨ç‰¹å®šä¿¡æ¯æ¥å¢å¼ºæ¨¡å‹çš„çŸ¥è¯†ã€‚æ£€ç´¢é€‚å½“ä¿¡æ¯å¹¶å°†å…¶æ’å…¥æ¨¡å‹æç¤ºçš„è¿‡ç¨‹è¢«ç§°ä¸ºæ£€ç´¢å¢

å¼ºç”Ÿæˆï¼ˆRAGï¼‰ã€‚

LangChainæœ‰è®¸å¤šç»„ä»¶æ—¨åœ¨å¸®åŠ©æ„å»ºé—®ç­”åº”ç”¨ï¼Œä»¥åŠæ›´å¹¿æ³›çš„RAGåº”ç”¨ã€‚

![](../å›¾ç‰‡/1736307607675-cacaf074-0f77-407c-b09b-4c45972617b4.png)

## RAGå·¥ä½œæµ

ä¸€ä¸ªå…¸å‹çš„RAGåº”ç”¨æœ‰ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š

**ç´¢å¼•(Indexing)**ï¼šä»æ•°æ®æºè·å–æ•°æ®å¹¶å»ºç«‹ç´¢å¼•çš„ç®¡é“(pipeline)ã€‚*è¿™é€šå¸¸åœ¨ç¦»çº¿çŠ¶æ€ä¸‹è¿›è¡Œã€‚*

**æ£€ç´¢å’Œç”Ÿæˆ(Retrieval and generation)**ï¼šå®é™…çš„RAGé“¾ï¼Œåœ¨è¿è¡Œæ—¶æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ï¼Œä»ç´¢å¼•ä¸­æ£€ç´¢ç›¸å…³æ•°æ®ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™æ¨¡å‹ã€‚

ä»åŸå§‹æ•°æ®åˆ°ç­”æ¡ˆçš„æœ€å¸¸è§å®Œæ•´é¡ºåºå¦‚ä¸‹ï¼š

### ç´¢å¼•(Indexing) 

1. **åŠ è½½(Load)**ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®ã€‚è¿™æ˜¯é€šè¿‡æ–‡æ¡£åŠ è½½å™¨[Document Loaders](https://blog.frognew.com/library/agi/langchain/components/document-loaders.html)å®Œæˆçš„ã€‚
2. **åˆ†å‰²(Split)**ï¼šæ–‡æœ¬åˆ†å‰²å™¨[Text splitters](https://python.langchain.com/docs/concepts/#text-splitters)å°†å¤§å‹æ–‡æ¡£(`Documents`)åˆ†æˆæ›´å°çš„å—(chunks)ã€‚è¿™å¯¹äºç´¢å¼•æ•°æ®å’Œå°†å…¶ä¼ é€’ç»™æ¨¡å‹éƒ½å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤§å—æ•°æ®æ›´éš¾æœç´¢ï¼Œè€Œä¸”ä¸é€‚åˆæ¨¡å‹æœ‰é™çš„ä¸Šä¸‹æ–‡çª—å£ã€‚
3. **å­˜å‚¨(Store)**ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨å’Œç´¢å¼•æˆ‘ä»¬çš„åˆ†å‰²(splits)ï¼Œä»¥ä¾¿åç»­å¯ä»¥å¯¹å…¶è¿›è¡Œæœç´¢ã€‚è¿™é€šå¸¸ä½¿ç”¨å‘é‡å­˜å‚¨[VectorStore](https://blog.frognew.com/library/agi/langchain/components/vector-stores.html)å’ŒåµŒå…¥æ¨¡å‹[Embeddings model](https://blog.frognew.com/library/agi/langchain/components/embedding-models.html)æ¥å®Œæˆã€‚

![img](../å›¾ç‰‡/1736306619642-e71bb3f9-95bf-4658-9f28-5568685d1304.png)

### æ£€ç´¢å’Œç”Ÿæˆ(Retrieval and generation)  

4æ£€ç´¢(Retrieve)ï¼šç»™å®šç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨æ£€ç´¢å™¨[Retriever](https://blog.frognew.com/library/agi/langchain/components/retrievers.html)ä»å­˜å‚¨ä¸­æ£€ç´¢ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µã€‚

5ç”Ÿæˆ(Generate)ï¼š [ChatModel](https://blog.frognew.com/library/agi/langchain/components/chat-models.html)ä½¿ç”¨åŒ…å«é—®é¢˜å’Œæ£€ç´¢åˆ°çš„æ•°æ®çš„æç¤ºæ¥ç”Ÿæˆç­”æ¡ˆã€‚

![img](../å›¾ç‰‡/1736306619770-c7136d46-502f-45ff-b182-550407c5a866.png)

## æ–‡æ¡£é—®ç­” 

### å®ç°æµç¨‹ 

ä¸€ä¸ª RAG ç¨‹åºçš„ APP ä¸»è¦æœ‰ä»¥ä¸‹æµç¨‹ï¼š

1. ç”¨æˆ·åœ¨ RAG å®¢æˆ·ç«¯ä¸Šä¼ ä¸€ä¸ªtxtæ–‡ä»¶
2. æœåŠ¡å™¨ç«¯æ¥æ”¶å®¢æˆ·ç«¯æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨æœåŠ¡ç«¯
3. æœåŠ¡å™¨ç«¯ç¨‹åºå¯¹æ–‡ä»¶è¿›è¡Œè¯»å–
4. å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ‹†åˆ†ï¼Œé˜²æ­¢ä¸€æ¬¡æ€§å¡ç»™ Embedding æ¨¡å‹è¶… token é™åˆ¶
5. æŠŠ Embedding åçš„å†…å®¹å­˜å‚¨åœ¨å‘é‡æ•°æ®åº“ï¼Œç”Ÿæˆæ£€ç´¢å™¨
6. ç¨‹åºå‡†å¤‡å°±ç»ªï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œæé—®
7. ç”¨æˆ·æå‡ºé—®é¢˜ï¼Œå¤§æ¨¡å‹è°ƒç”¨æ£€ç´¢å™¨æ£€ç´¢æ–‡æ¡£ï¼ŒæŠŠç›¸å…³ç‰‡æ®µæ‰¾å‡ºæ¥åï¼Œç»„ç»‡åï¼Œå›å¤ç”¨æˆ·ã€‚

![img](../å›¾ç‰‡/1723195691886-f74e18ee-ffb5-4395-92dc-1fb569317281.png)

### ä»£ç å®ç° 

ä½¿ç”¨ Streamlit å®ç°æ–‡ä»¶ä¸Šä¼ ï¼Œæˆ‘è¿™é‡Œåªå®ç°äº† txt æ–‡ä»¶ä¸Šä¼ ï¼Œå…¶å®è¿™é‡Œå¯ä»¥åœ¨ [type](https://so.csdn.net/so/search?q=type&spm=1001.2101.3001.7020) å‚æ•°é‡Œé¢è®¾ç½®å¤šä¸ªæ–‡ä»¶ç±»å‹ï¼Œåœ¨åé¢çš„æ£€ç´¢å™¨æ–¹æ³•é‡Œ

é¢é’ˆå¯¹æ¯ä¸ªç±»å‹è¿›è¡Œå¤„ç†å³å¯ã€‚

#### å®ç°æ–‡ä»¶ä¸Šä¼ 

```
import streamlit as st

# ä¸Šä¼ txtæ–‡ä»¶ï¼Œå…è®¸ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
uploaded_files = st.sidebar.file_uploader(
    label="ä¸Šä¼ txtæ–‡ä»¶", type=["txt"], accept_multiple_files=True
)
if not uploaded_files:
    st.info("è¯·å…ˆä¸Šä¼ æŒ‰TXTæ–‡æ¡£ã€‚")
    st.stop()
```

#### å®ç°æ£€ç´¢å™¨ 

æ³¨æ„ chunk_size æœ€å¤§è®¾ç½®æ•°å€¼å–å†³äº Embedding æ¨¡å‹å…è®¸å•è¯çš„æœ€å¤§å­—ç¬¦æ•°é™åˆ¶ã€‚

```
import tempfile
import os
from langchain.document_loaders import TextLoader
from langchain_community.embeddings import QianfanEmbeddingsEndpoint
from langchain_chroma import Chroma
from langchain_text_splitters import RecursiveCharacterTextSplitter

# å®ç°æ£€ç´¢å™¨
@st.cache_resource(ttl="1h")
def configure_retriever(uploaded_files):
    # è¯»å–ä¸Šä¼ çš„æ–‡æ¡£ï¼Œå¹¶å†™å…¥ä¸€ä¸ªä¸´æ—¶ç›®å½•
    docs = []
    temp_dir = tempfile.TemporaryDirectory(dir=r"D:\\")
    for file in uploaded_files:
        temp_filepath = os.path.join(temp_dir.name, file.name)
        with open(temp_filepath, "wb") as f:
            f.write(file.getvalue())
        loader = TextLoader(temp_filepath, encoding="utf-8")
        docs.extend(loader.load())

    # è¿›è¡Œæ–‡æ¡£åˆ†å‰²
    text_splitter = RecursiveCharacterTextSplitter(chunk_size=300, chunk_overlap=30)
    splits = text_splitter.split_documents(docs)

    # è¿™é‡Œä½¿ç”¨äº†OpenAIå‘é‡æ¨¡å‹
    embeddings = OpenAIEmbeddings()
    vectordb = Chroma.from_documents(splits, embeddings)

    retriever = vectordb.as_retriever()

    return retriever


retriever = configure_retriever(uploaded_files)
```

#### åˆ›å»ºæ£€ç´¢å·¥å…· 

langchain æä¾›äº† create_retriever_tool å·¥å…·ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚

```
# åˆ›å»ºæ£€ç´¢å·¥å…·
from langchain.tools.retriever import create_retriever_tool

tool = create_retriever_tool(
    retriever,
    "æ–‡æ¡£æ£€ç´¢",
    "ç”¨äºæ£€ç´¢ç”¨æˆ·æå‡ºçš„é—®é¢˜ï¼Œå¹¶åŸºäºæ£€ç´¢åˆ°çš„æ–‡æ¡£å†…å®¹è¿›è¡Œå›å¤.",
)
tools = [tool]
```

#### åˆ›å»º React Agent 

```
instructions = """æ‚¨æ˜¯ä¸€ä¸ªè®¾è®¡ç”¨äºæŸ¥è¯¢æ–‡æ¡£æ¥å›ç­”é—®é¢˜çš„ä»£ç†ã€‚
æ‚¨å¯ä»¥ä½¿ç”¨æ–‡æ¡£æ£€ç´¢å·¥å…·ï¼Œå¹¶åŸºäºæ£€ç´¢å†…å®¹æ¥å›ç­”é—®é¢˜
æ‚¨å¯èƒ½ä¸æŸ¥è¯¢æ–‡æ¡£å°±çŸ¥é“ç­”æ¡ˆï¼Œä½†æ˜¯æ‚¨ä»ç„¶åº”è¯¥æŸ¥è¯¢æ–‡æ¡£æ¥è·å¾—ç­”æ¡ˆã€‚
å¦‚æœæ‚¨ä»æ–‡æ¡£ä¸­æ‰¾ä¸åˆ°ä»»ä½•ä¿¡æ¯ç”¨äºå›ç­”é—®é¢˜ï¼Œåˆ™åªéœ€è¿”å›â€œæŠ±æ­‰ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘è¿˜ä¸çŸ¥é“ã€‚â€ä½œä¸ºç­”æ¡ˆã€‚
"""

base_prompt_template = """
{instructions}

TOOLS:
------

You have access to the following tools:

{tools}

To use a tool, please use the following format:

â€¢```
Thought: Do I need to use a tool? Yes
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
â€¢```

When you have a response to say to the Human, or if you do not need to use a tool, you MUST use the format:

â€¢```
Thought: Do I need to use a tool? No
Final Answer: [your response here]
â€¢```

Begin!

Previous conversation history:
{chat_history}

New input: {input}
{agent_scratchpad}"""

base_prompt = PromptTemplate.from_template(base_prompt_template)

prompt = base_prompt.partial(instructions=instructions)

# åˆ›å»ºllm
llm = ChatOpenAI()

# åˆ›å»ºreact Agent
agent = create_react_agent(llm, tools, prompt)

agent_executor = AgentExecutor(agent=agent, tools=tools, memory=memory, verbose=False)
```

#### å®ç° Agent å›å¤ 

è·å–ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å›å¤ç”¨æˆ·ï¼Œè¿™é‡Œä½¿ç”¨ StreamlitCallbackHandler å®ç°äº† React æ¨ç†å›è°ƒï¼Œå¯ä»¥è®©æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹å¯è§ã€‚

```
# åˆ›å»ºèŠå¤©è¾“å…¥æ¡†
user_query = st.chat_input(placeholder="è¯·å¼€å§‹æé—®å§!")

if user_query:
    st.session_state.messages.append({"role": "user", "content": user_query})
    st.chat_message("user").write(user_query)

    with st.chat_message("assistant"):
        st_cb = StreamlitCallbackHandler(st.container())
        config = {"callbacks": [st_cb]}
        response = agent_executor.invoke({"input": user_query}, config=config)
        st.session_state.messages.append({"role": "assistant", "content": response["output"]})
        st.write(response["output"])
```

#### æ•ˆæœ

![img](../å›¾ç‰‡/1736315492033-f4f64a03-fa04-4e70-9959-d7b94c08b9a1.png)

# LangGraphå¿«é€Ÿå…¥é—¨ä¸åº•å±‚åŸç†å‰–æ

## LangGraph

ğŸ¦œğŸ•¸ï¸LangGraph âš¡ ä»¥å›¾çš„æ–¹å¼æ„å»ºè¯­è¨€ä»£ç† âš¡

å®˜æ–¹æ–‡æ¡£åœ°å€ï¼šhttps://langchain-ai.github.io/langgraph/

LangGraph æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå…·æœ‰ LLMs çš„æœ‰çŠ¶æ€ã€å¤šè§’è‰²åº”ç”¨ç¨‹åºçš„åº“ï¼Œç”¨äºåˆ›å»ºä»£ç†å’Œå¤šä»£ç†å·¥ä½œæµã€‚ä¸å…¶ä»– LLM æ¡†æ¶ç›¸æ¯”ï¼Œå®ƒæä¾›äº†ä»¥ä¸‹æ ¸å¿ƒä¼˜åŠ¿ï¼šå¾ªç¯ã€å¯æ§æ€§å’ŒæŒä¹…æ€§ã€‚

LangGraph å…è®¸æ‚¨å®šä¹‰æ¶‰åŠå¾ªç¯çš„æµç¨‹ï¼Œè¿™å¯¹äºå¤§å¤šæ•°ä»£ç†æ¶æ„è‡³å…³é‡è¦ã€‚ä½œä¸ºä¸€ç§éå¸¸åº•å±‚çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†å¯¹åº”ç”¨ç¨‹åºçš„æµç¨‹å’ŒçŠ¶æ€çš„ç²¾ç»†æ§åˆ¶ï¼Œè¿™å¯¹åˆ›å»ºå¯é çš„ä»£ç†è‡³å…³é‡è¦ã€‚æ­¤å¤–ï¼ŒLangGraph åŒ…å«å†…ç½®çš„æŒä¹…æ€§ï¼Œå¯ä»¥å®ç°é«˜çº§çš„â€œäººæœºäº¤äº’â€å’Œå†…å­˜åŠŸèƒ½ã€‚

LangGraph æ˜¯ LangChain çš„é«˜çº§åº“ï¼Œä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å¸¦æ¥å¾ªç¯[è®¡ç®—èƒ½åŠ›](https://so.csdn.net/so/search?q=è®¡ç®—èƒ½åŠ›&spm=1001.2101.3001.7020)ã€‚å®ƒè¶…è¶Šäº† LangChain çš„çº¿æ€§å·¥ä½œæµï¼Œé€šè¿‡å¾ªç¯æ”¯æŒå¤æ‚çš„ä»»åŠ¡å¤„ç†ã€‚

- **çŠ¶æ€**ï¼šç»´æŠ¤è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ï¼Œå®ç°åŸºäºç´¯ç§¯æ•°æ®çš„åŠ¨æ€å†³ç­–ã€‚
- **èŠ‚ç‚¹**ï¼šä»£è¡¨è®¡ç®—æ­¥éª¤ï¼Œæ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼Œå¯å®šåˆ¶ä»¥é€‚åº”ä¸åŒå·¥ä½œæµã€‚
- **è¾¹**ï¼šè¿æ¥èŠ‚ç‚¹ï¼Œå®šä¹‰è®¡ç®—æµç¨‹ï¼Œæ”¯æŒæ¡ä»¶é€»è¾‘ï¼Œå®ç°å¤æ‚å·¥ä½œæµ

![img](../å›¾ç‰‡/1736316942140-ab9413c2-b2f4-4e8d-a3c3-a0700c92784f.jpeg)

### ä¸»è¦åŠŸèƒ½

- **å¾ªç¯å’Œåˆ†æ”¯**ï¼šåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®ç°å¾ªç¯å’Œæ¡ä»¶è¯­å¥ã€‚
- **æŒä¹…æ€§**ï¼šåœ¨å›¾ä¸­çš„æ¯ä¸ªæ­¥éª¤ä¹‹åè‡ªåŠ¨ä¿å­˜çŠ¶æ€ã€‚åœ¨ä»»ä½•æ—¶å€™æš‚åœå’Œæ¢å¤å›¾æ‰§è¡Œä»¥æ”¯æŒé”™è¯¯æ¢å¤ã€â€œäººæœºäº¤äº’â€å·¥ä½œæµã€æ—¶é—´æ—…è¡Œç­‰ç­‰ã€‚
- **â€œäººæœºäº¤äº’â€**ï¼šä¸­æ–­å›¾æ‰§è¡Œä»¥æ‰¹å‡†æˆ–ç¼–è¾‘ä»£ç†è®¡åˆ’çš„ä¸‹ä¸€ä¸ªåŠ¨ä½œã€‚
- **æµæ”¯æŒ**ï¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹äº§ç”Ÿè¾“å‡ºæ—¶æµå¼ä¼ è¾“è¾“å‡ºï¼ˆåŒ…æ‹¬ä»¤ç‰Œæµå¼ä¼ è¾“ï¼‰ã€‚
- **ä¸ LangChain é›†æˆ**ï¼šLangGraph ä¸ [LangChain](https://github.com/langchain-ai/langchain/) å’Œ [LangSmith](https://docs.smith.langchain.com/) æ— ç¼é›†æˆï¼ˆä½†ä¸éœ€è¦å®ƒä»¬ï¼‰ã€‚

### å®‰è£…

```plain
pip install -U langgraph
```

### ç¤ºä¾‹

LangGraph çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯çŠ¶æ€ã€‚æ¯æ¬¡å›¾æ‰§è¡Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªçŠ¶æ€ï¼Œè¯¥çŠ¶æ€åœ¨å›¾ä¸­çš„èŠ‚ç‚¹æ‰§è¡Œæ—¶ä¼ é€’ï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨æ‰§è¡Œåä½¿ç”¨å…¶è¿”å›å€¼æ›´æ–°æ­¤å†…éƒ¨çŠ¶æ€ã€‚å›¾æ›´æ–°å…¶å†…éƒ¨çŠ¶æ€çš„æ–¹å¼ç”±æ‰€é€‰å›¾ç±»å‹æˆ–è‡ªå®šä¹‰å‡½æ•°å®šä¹‰ã€‚

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¯ä»¥ä½¿ç”¨æœç´¢å·¥å…·çš„ç®€å•ä»£ç†ç¤ºä¾‹ã€‚

```python
pip install langchain-openai
setx OPENAI_BASE_URL "https://api.openai.com/v1"
setx OPENAI_API_KEY "sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
```

å¯ä»¥é€‰æ‹©è®¾ç½® [LangSmith](https://docs.smith.langchain.com/) ä»¥å®ç°æœ€ä½³çš„å¯è§‚å¯Ÿæ€§ã€‚

```plain
setx LANGSMITH_TRACING "true"
setx LANGSMITH_API_KEY "xxxxxxxxxxxxxxxx"
#ç¤ºä¾‹ï¼šlanggraph_hello.py
from typing import Literal
from langchain_core.messages import HumanMessage
from langchain_core.tools import tool
from langchain_openai import ChatOpenAI
# pip install langgraph
from langgraph.checkpoint.memory import MemorySaver
from langgraph.graph import END, StateGraph, MessagesState
from langgraph.prebuilt import ToolNode

# å®šä¹‰å·¥å…·å‡½æ•°ï¼Œç”¨äºä»£ç†è°ƒç”¨å¤–éƒ¨å·¥å…·
@tool
def search(query: str):
    """æ¨¡æ‹Ÿä¸€ä¸ªæœç´¢å·¥å…·"""
    if "ä¸Šæµ·" in query.lower() or "Shanghai" in query.lower():
        return "ç°åœ¨30åº¦ï¼Œæœ‰é›¾."
    return "ç°åœ¨æ˜¯35åº¦ï¼Œé˜³å…‰æ˜åªšã€‚"


# å°†å·¥å…·å‡½æ•°æ”¾å…¥å·¥å…·åˆ—è¡¨
tools = [search]

# åˆ›å»ºå·¥å…·èŠ‚ç‚¹
tool_node = ToolNode(tools)

# 1.åˆå§‹åŒ–æ¨¡å‹å’Œå·¥å…·ï¼Œå®šä¹‰å¹¶ç»‘å®šå·¥å…·åˆ°æ¨¡å‹
model = ChatOpenAI(model="gpt-4o", temperature=0).bind_tools(tools)

# å®šä¹‰å‡½æ•°ï¼Œå†³å®šæ˜¯å¦ç»§ç»­æ‰§è¡Œ
def should_continue(state: MessagesState) -> Literal["tools", END]:
    messages = state['messages']
    last_message = messages[-1]
    # å¦‚æœLLMè°ƒç”¨äº†å·¥å…·ï¼Œåˆ™è½¬åˆ°â€œtoolsâ€èŠ‚ç‚¹
    if last_message.tool_calls:
        return "tools"
    # å¦åˆ™ï¼Œåœæ­¢ï¼ˆå›å¤ç”¨æˆ·ï¼‰
    return END


# å®šä¹‰è°ƒç”¨æ¨¡å‹çš„å‡½æ•°
def call_model(state: MessagesState):
    messages = state['messages']
    response = model.invoke(messages)
    # è¿”å›åˆ—è¡¨ï¼Œå› ä¸ºè¿™å°†è¢«æ·»åŠ åˆ°ç°æœ‰åˆ—è¡¨ä¸­
    return {"messages": [response]}

# 2.ç”¨çŠ¶æ€åˆå§‹åŒ–å›¾ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„çŠ¶æ€å›¾
workflow = StateGraph(MessagesState)
# 3.å®šä¹‰å›¾èŠ‚ç‚¹ï¼Œå®šä¹‰æˆ‘ä»¬å°†å¾ªç¯çš„ä¸¤ä¸ªèŠ‚ç‚¹
workflow.add_node("agent", call_model)
workflow.add_node("tools", tool_node)

# 4.å®šä¹‰å…¥å£ç‚¹å’Œå›¾è¾¹
# è®¾ç½®å…¥å£ç‚¹ä¸ºâ€œagentâ€
# è¿™æ„å‘³ç€è¿™æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„èŠ‚ç‚¹
workflow.set_entry_point("agent")

# æ·»åŠ æ¡ä»¶è¾¹
workflow.add_conditional_edges(
    # é¦–å…ˆï¼Œå®šä¹‰èµ·å§‹èŠ‚ç‚¹ã€‚æˆ‘ä»¬ä½¿ç”¨`agent`ã€‚
    # è¿™æ„å‘³ç€è¿™äº›è¾¹æ˜¯åœ¨è°ƒç”¨`agent`èŠ‚ç‚¹åé‡‡å–çš„ã€‚
    "agent",
    # æ¥ä¸‹æ¥ï¼Œä¼ é€’å†³å®šä¸‹ä¸€ä¸ªè°ƒç”¨èŠ‚ç‚¹çš„å‡½æ•°ã€‚
    should_continue,
)

# æ·»åŠ ä»`tools`åˆ°`agent`çš„æ™®é€šè¾¹ã€‚
# è¿™æ„å‘³ç€åœ¨è°ƒç”¨`tools`åï¼Œæ¥ä¸‹æ¥è°ƒç”¨`agent`èŠ‚ç‚¹ã€‚
workflow.add_edge("tools", 'agent')

# åˆå§‹åŒ–å†…å­˜ä»¥åœ¨å›¾è¿è¡Œä¹‹é—´æŒä¹…åŒ–çŠ¶æ€
checkpointer = MemorySaver()

# 5.ç¼–è¯‘å›¾
# è¿™å°†å…¶ç¼–è¯‘æˆä¸€ä¸ªLangChainå¯è¿è¡Œå¯¹è±¡ï¼Œ
# è¿™æ„å‘³ç€ä½ å¯ä»¥åƒä½¿ç”¨å…¶ä»–å¯è¿è¡Œå¯¹è±¡ä¸€æ ·ä½¿ç”¨å®ƒã€‚
# æ³¨æ„ï¼Œæˆ‘ä»¬ï¼ˆå¯é€‰åœ°ï¼‰åœ¨ç¼–è¯‘å›¾æ—¶ä¼ é€’å†…å­˜
app = workflow.compile(checkpointer=checkpointer)

# 6.æ‰§è¡Œå›¾ï¼Œä½¿ç”¨å¯è¿è¡Œå¯¹è±¡
final_state = app.invoke(
    {"messages": [HumanMessage(content="ä¸Šæµ·çš„å¤©æ°”æ€ä¹ˆæ ·?")]},
    config={"configurable": {"thread_id": 42}}
)
# ä» final_state ä¸­è·å–æœ€åä¸€æ¡æ¶ˆæ¯çš„å†…å®¹
result = final_state["messages"][-1].content
print(result)
final_state = app.invoke(
    {"messages": [HumanMessage(content="æˆ‘é—®çš„é‚£ä¸ªåŸå¸‚?")]},
    config={"configurable": {"thread_id": 42}}
)
result = final_state["messages"][-1].content
print(result)
ä¸Šæµ·ç°åœ¨çš„å¤©æ°”æ˜¯30åº¦ï¼Œæœ‰é›¾ã€‚
```

ç°åœ¨ï¼Œå½“æˆ‘ä»¬ä¼ é€’ç›¸åŒçš„ `"thread_id"` æ—¶ï¼Œå¯¹è¯ä¸Šä¸‹æ–‡å°†é€šè¿‡ä¿å­˜çš„çŠ¶æ€ï¼ˆå³å­˜å‚¨çš„æ¶ˆæ¯åˆ—è¡¨ï¼‰ä¿ç•™ä¸‹æ¥ã€‚

```python
final_state = app.invoke(
    {"messages": [HumanMessage(content="æˆ‘é—®çš„é‚£ä¸ªåŸå¸‚?")]},
    config={"configurable": {"thread_id": 42}}
)
result = final_state["messages"][-1].content
print(result)
ä½ é—®çš„æ˜¯ä¸Šæµ·çš„å¤©æ°”ã€‚ä¸Šæµ·ç°åœ¨çš„å¤©æ°”æ˜¯30åº¦ï¼Œæœ‰é›¾ã€‚
```

### é€æ­¥åˆ†è§£

#### 1. åˆå§‹åŒ–æ¨¡å‹å’Œå·¥å…·

- æˆ‘ä»¬ä½¿ç”¨ `ChatOpenAI` ä½œä¸ºæˆ‘ä»¬çš„ LLMã€‚**æ³¨æ„ï¼š**æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¨¡å‹çŸ¥é“å¯ä»¥ä½¿ç”¨å“ªäº›å·¥å…·ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† LangChain å·¥å…·è½¬æ¢ä¸º OpenAI å·¥å…·è°ƒç”¨æ ¼å¼æ¥å®Œæˆæ­¤æ“ä½œï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ `.bind_tools()` æ–¹æ³•ã€‚
- æˆ‘ä»¬å®šä¹‰è¦ä½¿ç”¨çš„å·¥å…·â€”â€”åœ¨æœ¬ä¾‹ä¸­æ˜¯æœç´¢å·¥å…·ã€‚åˆ›å»ºè‡ªå·±çš„å·¥å…·éå¸¸å®¹æ˜“â€”â€”è¯·å‚é˜…æ­¤å¤„çš„æ–‡æ¡£äº†è§£å¦‚ä½•æ“ä½œ [æ­¤å¤„](http://python.langchain.ac.cn/docs/modules/agents/tools/custom_tools)ã€‚

#### 2. ç”¨çŠ¶æ€åˆå§‹åŒ–å›¾

- æˆ‘ä»¬é€šè¿‡ä¼ é€’çŠ¶æ€æ¨¡å¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º `MessagesState`ï¼‰æ¥åˆå§‹åŒ–å›¾ï¼ˆ`StateGraph`ï¼‰ã€‚
- `MessagesState` æ˜¯ä¸€ä¸ªé¢„æ„å»ºçš„çŠ¶æ€æ¨¡å¼ï¼Œå®ƒå…·æœ‰ä¸€ä¸ªå±æ€§ï¼Œä¸€ä¸ª LangChain `Message` å¯¹è±¡åˆ—è¡¨ï¼Œä»¥åŠå°†æ¯ä¸ªèŠ‚ç‚¹çš„æ›´æ–°åˆå¹¶åˆ°çŠ¶æ€ä¸­çš„é€»è¾‘ã€‚

#### 3. å®šä¹‰å›¾èŠ‚ç‚¹

æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªä¸»è¦èŠ‚ç‚¹

- `agent` èŠ‚ç‚¹ï¼šè´Ÿè´£å†³å®šé‡‡å–ä»€ä¹ˆï¼ˆå¦‚æœæœ‰ï¼‰è¡ŒåŠ¨ã€‚
- è°ƒç”¨å·¥å…·çš„ `tools` èŠ‚ç‚¹ï¼šå¦‚æœä»£ç†å†³å®šé‡‡å–è¡ŒåŠ¨ï¼Œæ­¤èŠ‚ç‚¹å°†æ‰§è¡Œè¯¥è¡ŒåŠ¨ã€‚

#### 4. å®šä¹‰å…¥å£ç‚¹å’Œå›¾è¾¹

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å›¾æ‰§è¡Œçš„å…¥å£ç‚¹â€”â€”`agent` èŠ‚ç‚¹ã€‚

ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ™®é€šè¾¹å’Œä¸€ä¸ªæ¡ä»¶è¾¹ã€‚æ¡ä»¶è¾¹æ„å‘³ç€ç›®çš„åœ°å–å†³äºå›¾çŠ¶æ€ï¼ˆ`MessageState`ï¼‰çš„å†…å®¹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç›®çš„åœ°åœ¨ä»£ç†ï¼ˆLLMï¼‰å†³å®šä¹‹å‰æ˜¯æœªçŸ¥çš„ã€‚

- æ¡ä»¶è¾¹ï¼šè°ƒç”¨ä»£ç†åï¼Œæˆ‘ä»¬åº”è¯¥è¦ä¹ˆ

- a. å¦‚æœä»£ç†è¯´è¦é‡‡å–è¡ŒåŠ¨ï¼Œåˆ™è¿è¡Œå·¥å…·
- b. å¦‚æœä»£ç†æ²¡æœ‰è¦æ±‚è¿è¡Œå·¥å…·ï¼Œåˆ™å®Œæˆï¼ˆå›å¤ç”¨æˆ·ï¼‰ã€‚

- æ™®é€šè¾¹ï¼šè°ƒç”¨å·¥å…·åï¼Œå›¾åº”è¯¥å§‹ç»ˆè¿”å›åˆ°ä»£ç†ä»¥å†³å®šä¸‹ä¸€æ­¥æ“ä½œã€‚

#### 5. ç¼–è¯‘å›¾

- å½“æˆ‘ä»¬ç¼–è¯‘å›¾æ—¶ï¼Œæˆ‘ä»¬å°†å…¶è½¬æ¢ä¸º LangChain Runnableï¼Œè¿™ä¼šè‡ªåŠ¨å¯ç”¨ä½¿ç”¨æ‚¨çš„è¾“å…¥è°ƒç”¨ `.invoke()`ã€`.stream()` å’Œ `.batch()`ã€‚
- æˆ‘ä»¬è¿˜å¯ä»¥é€‰æ‹©ä¼ é€’æ£€æŸ¥ç‚¹å¯¹è±¡ä»¥åœ¨å›¾è¿è¡Œä¹‹é—´æŒä¹…åŒ–çŠ¶æ€ï¼Œå¹¶å¯ç”¨å†…å­˜ã€â€œäººæœºäº¤äº’â€å·¥ä½œæµã€æ—¶é—´æ—…è¡Œç­‰ç­‰ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `MemorySaver`â€”â€”ä¸€ä¸ªç®€å•çš„å†…å­˜ä¸­æ£€æŸ¥ç‚¹ã€‚

#### 6. æ‰§è¡Œå›¾

1. LangGraph å°†è¾“å…¥æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çŠ¶æ€ï¼Œç„¶åå°†çŠ¶æ€ä¼ é€’ç»™å…¥å£ç‚¹èŠ‚ç‚¹ `"agent"`ã€‚
2. `"agent"` èŠ‚ç‚¹æ‰§è¡Œï¼Œè°ƒç”¨èŠå¤©æ¨¡å‹ã€‚
3. èŠå¤©æ¨¡å‹è¿”å› `AIMessage`ã€‚LangGraph å°†å…¶æ·»åŠ åˆ°çŠ¶æ€ä¸­ã€‚
4. å›¾å¾ªç¯ä»¥ä¸‹æ­¥éª¤ï¼Œç›´åˆ° `AIMessage` ä¸Šä¸å†æœ‰ `tool_calls`ã€‚
   - å¦‚æœ `AIMessage` å…·æœ‰ `tool_calls`ï¼Œåˆ™ `"tools"` èŠ‚ç‚¹æ‰§è¡Œã€‚
   - `"agent"` èŠ‚ç‚¹å†æ¬¡æ‰§è¡Œå¹¶è¿”å› `AIMessage`ã€‚
5. æ‰§è¡Œè¿›åº¦åˆ°ç‰¹æ®Šçš„ `END` å€¼ï¼Œå¹¶è¾“å‡ºæœ€ç»ˆçŠ¶æ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°æ‰€æœ‰èŠå¤©æ¶ˆæ¯çš„åˆ—è¡¨ä½œä¸ºè¾“å‡ºã€‚

# LangGraphå¿«é€Ÿæ„å»ºAgentå·¥ä½œæµåº”ç”¨

## Agentå·¥ä½œæµ 

ä¸‹é¢å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªâ€œè®¡åˆ’å¹¶æ‰§è¡Œâ€é£æ ¼çš„ä»£ç†ã€‚ è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå€Ÿé‰´äº† [è®¡åˆ’å’Œè§£å†³](https://arxiv.org/abs/2305.04091) è®ºæ–‡ä»¥åŠ [Baby-AGI](https://github.com/yoheinakajima/babyagi) é¡¹ç›®ã€‚

æ ¸å¿ƒæ€æƒ³æ˜¯å…ˆåˆ¶å®šä¸€ä¸ªå¤šæ­¥éª¤è®¡åˆ’ï¼Œç„¶åé€é¡¹æ‰§è¡Œã€‚ å®Œæˆä¸€é¡¹ç‰¹å®šä»»åŠ¡åï¼Œæ‚¨å¯ä»¥é‡æ–°å®¡è§†è®¡åˆ’å¹¶æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚

ä¸€èˆ¬çš„è®¡ç®—å›¾å¦‚ä¸‹æ‰€ç¤º

![img](../å›¾ç‰‡/1736320177627-8176e6dc-9c06-4266-93e6-9dba2c8e24ca.png)

è¿™ä¸å…¸å‹çš„ [ReAct](https://arxiv.org/abs/2210.03629) é£æ ¼çš„ä»£ç†è¿›è¡Œäº†æ¯”è¾ƒï¼Œåœ¨è¯¥ä»£ç†ä¸­ï¼Œæ‚¨ä¸€æ¬¡æ€è€ƒä¸€æ­¥ã€‚ è¿™ç§â€œè®¡åˆ’å¹¶æ‰§è¡Œâ€é£æ ¼ä»£ç†çš„ä¼˜åŠ¿åœ¨äº

1. æ˜ç¡®çš„é•¿æœŸè§„åˆ’ï¼ˆå³ä½¿æ˜¯çœŸæ­£å¼ºå¤§çš„ LLM ä¹Ÿå¯èƒ½éš¾ä»¥åšåˆ°ï¼‰
2. èƒ½å¤Ÿä½¿ç”¨æ›´å°/æ›´å¼±çš„æ¨¡å‹æ¥æ‰§è¡Œæ­¥éª¤ï¼Œä»…åœ¨è§„åˆ’æ­¥éª¤ä¸­ä½¿ç”¨æ›´å¤§/æ›´å¥½çš„æ¨¡å‹

ä»¥ä¸‹æ¼”ç»ƒæ¼”ç¤ºäº†å¦‚ä½•åœ¨ LangGraph ä¸­å®ç°è¿™ä¸€ç‚¹ã€‚ ç”Ÿæˆçš„ä»£ç†å°†ç•™ä¸‹ç±»ä¼¼ä»¥ä¸‹ç¤ºä¾‹çš„è½¨è¿¹ï¼š ([é“¾æ¥](https://smith.langchain.com/public/d46e24d3-dda6-44d5-9550-b618fca4e0d4/r)).

### è®¾ç½® 

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ã€‚

```
pip install --quiet -U langgraph langchain-community langchain-openai tavily-python
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸º OpenAIï¼ˆæˆ‘ä»¬å°†ä½¿ç”¨çš„ LLMï¼‰å’Œ Tavilyï¼ˆæˆ‘ä»¬å°†ä½¿ç”¨çš„æœç´¢å·¥å…·ï¼‰è®¾ç½® API å¯†é’¥

å¯ä»¥é€‰æ‹©è®¾ç½® LangSmith è·Ÿè¸ªçš„ API å¯†é’¥ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ä¸€æµçš„å¯è§‚å¯Ÿæ€§ã€‚

```
setx TAVILY_API_KEY ""
# Optional, add tracing in LangSmith
setx LANGCHAIN_TRACING_V2 "true"
setx LANGCHAIN_API_KEY ""
```

### å®šä¹‰å·¥å…· 

æˆ‘ä»¬å°†é¦–å…ˆå®šä¹‰è¦ä½¿ç”¨çš„å·¥å…·ã€‚ å¯¹äºè¿™ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Tavily å†…ç½®çš„æœç´¢å·¥å…·ã€‚ ä½†æ˜¯ï¼Œåˆ›å»ºè‡ªå·±çš„å·¥å…·éå¸¸å®¹æ˜“ - è¯·å‚é˜…æœ‰å…³å¦‚ä½•æ“ä½œçš„æ–‡æ¡£ [æ­¤å¤„](http://python.langchain.ac.cn/v0.2/docs/how_to/custom_tools)ã€‚

```
#ç¤ºä¾‹ï¼šplan_execute.py
from langchain_community.tools.tavily_search import TavilySearchResults
# åˆ›å»ºTavilySearchResultså·¥å…·ï¼Œè®¾ç½®æœ€å¤§ç»“æœæ•°ä¸º1
tools = [TavilySearchResults(max_results=1)]
```

### å®šä¹‰æˆ‘ä»¬çš„æ‰§è¡Œä»£ç† 

ç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºè¦ç”¨äºæ‰§è¡Œä»»åŠ¡çš„æ‰§è¡Œä»£ç†ã€‚ è¯·æ³¨æ„ï¼Œå¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†å¯¹æ¯ä¸ªä»»åŠ¡ä½¿ç”¨ç›¸åŒçš„æ‰§è¡Œä»£ç†ï¼Œä½†è¿™å¹¶éå¿…é¡»å¦‚æ­¤ã€‚

```python
from langchain_community.tools import TavilySearchResults
from langgraph.prebuilt import create_react_agent
from docs.S.LangChainå­¦ä¹ è®°å½•.demo.getchat import get_key, get_chat

LANGSMITH_API_KEY = get_chat('LANGSMITH_API_KEY')

# å·¥å…·
tools = [TavilySearchResults(tavily_api_key=get_key("tavily_api_key"))]

# æ¨¡å‹
llm = get_chat("gpt-4o")

# åˆ›å»º agent
agent_executor = create_react_agent(llm, tools)

response = agent_executor.invoke(
    {
        "messages": [("user", "ä¸–ç•Œé¦–å¯Œæœ‰å¤šå°‘é’±")]
    }
)

print(response)
```

```
{'messages': [HumanMessage(content='ä¸–ç•Œé¦–å¯Œæœ‰å¤šå°‘é’±', additional_kwargs={}, response_metadata={}, id='d2271b42-957b-4c3d-9a2b-5f019c5c9517'), AIMessage(content='', additional_kwargs={'tool_calls': [{'id': 'call_ak7YG4vLPT2ylQCXCscWEJ0B', 'function': {'arguments': '{"query":"current net worth of the richest person in the world"}', 'name': 'tavily_search_results_json', 'parameters': None}, 'type': 'function'}], 'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 84, 'total_tokens': 112, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BiteZffzxaHDnbxOBQwJfrD5FhKrU', 'service_tier': None, 'finish_reason': 'tool_calls', 'logprobs': None}, id='run--f8397354-3cc6-41e7-bbcd-a676deed5731-0', tool_calls=[{'name': 'tavily_search_results_json', 'args': {'query': 'current net worth of the richest person in the world'}, 'id': 'call_ak7YG4vLPT2ylQCXCscWEJ0B', 'type': 'tool_call'}], usage_metadata={'input_tokens': 84, 'output_tokens': 28, 'total_tokens': 112, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}), ToolMessage(content='[{"title": "Who is the richest person in the world? See Elon Musk\'s net worth", "url": "https://www.statesman.com/story/news/state/2025/04/14/who-is-the-richest-person-in-the-world-wealthiest-forbes-ranking-list-2025-net-worth-elon-musk/83042795007/", "content": "## Who is the richest person in the world? Hint: He\'s a Texan\\n\\n![Tesla CEO Elon Musk attends a Cabinet meeting at the White House on March 24, 2025.]()\\n\\n**Elon Musk** holds the title of the world\'s richest person . He has a net worth of $365.3 billion as of April 2025, [according to the latest Forbes data](https://www.forbes.com/real-time-billionaires/#310717713d78). [...] |  |  |  |  |  |\\n| --- | --- | --- | --- | --- |\\n| **Rank** | **Name** | **Total net worth** | **Entity** | **Country/Region** |\\n| 1 | Elon Musk | $365.3B | Tesla, SpaceX | United States |\\n| 2 | Jeff Bezos | $198.3B | Amazon | United States |\\n| 3 | Mark Zuckerberg | $185.5B | Facebook | United States |\\n| 4 | Larry Ellison | $164.7B | Oracle | United States |\\n| 5 | Warren Buffett | $160.0B | Berkshire Hathaway | United States |\\n| 6 | Bernard Arnault & family | $150.8B | LVMH | France | [...] In 2023, Bettencourt Meyers once again surpassed Walton, who dropped to the third-place spot due to American socialite Julia Koch, who inherited Koch, Inc. ownership stakes from her late husband David Koch. Koch, 62, was estimated to be worth $74.2 billion in the latest Forbes ranking.\\n\\n## LIST: World\'s 10 wealthiest people\\n\\nAll but one of Earth\'s 10 richest people reside in the U.S. Here\'s their rankings and net worth as of April 11, as reported by Forbes:", "score": 0.8649622}, {"title": "Richest people in the world 2025 - Statista", "url": "https://www.statista.com/statistics/272047/top-25-global-billionaires/", "content": "As of March 2025, Elon Musk had a net worth valued at 328.5 billion US dollars, making him the richest man in the world.", "score": 0.850382}, {"title": "Top 10 Richest People in the World 2025: Elon Musk, Jeff Bezos ...", "url": "https://www.indmoney.com/blog/us-stocks/top-10-richest-people-in-the-world", "content": "Tesla founder Elon Musk is the richest man in the world with a net worth of $420 billion, closely followed by Jeff Bezos at $266 billion.", "score": 0.81630427}, {"title": "World\'s 10 Richest People: List Of The Wealthiest Billionaires", "url": "https://www.bankrate.com/investing/worlds-richest-people/", "content": "These billionaires reached their lofty heights through hard work, great ideas, serendipity and plenty of careful planning along the way.\\n\\nHere are the worldâ€™s 10 richest people and some of their key investments, according to the [Bloomberg Billionaires Index](https://www.bloomberg.com/billionaires/), as of June 11, 2025.\\n\\n## 1. Elon Musk: $369 billion [...] ### Editorial disclosure\\n\\nAll reviews are prepared by our staff. Opinions expressed are solely\\nthose of the reviewer and have not been reviewed or approved by any\\nadvertiser. The information, including any rates, terms and fees\\nassociated with financial products, presented in the review is accurate\\nas of the date of publication.\\n\\n# The worldâ€™s 10 richest people: The wealthiest have $100 billion or more [...] | Person | Wealth | Key investments |\\n| --- | --- | --- |\\n| **1. Elon Musk** | $369 billion | Tesla, SpaceX, Twitter (since renamed X) |\\n| **2. Mark Zuckerberg** | $245 billion | Meta Platforms |\\n| **3. Jeff Bezos** | $234 billion | Amazon, Blue Origin |\\n| **4. Larry Ellison** | $200 billion | Oracle |\\n| **5. Bill Gates** | $177 billion | Microsoft |\\n| **6. Steve Ballmer** | $163 billion | Microsoft |\\n| **7. Larry Page** | $160 billion | Alphabet |", "score": 0.7050753}, {"title": "The Top 10 Richest People In The World In 2025 - Forbes India", "url": "https://www.forbesindia.com/article/explainers/top-10-richest-people-world/85541/1", "content": "| **Name & Rank** | **Net Worth (in $ Billions)** | **Companies/ Source of Wealth** | **Country** |\\n| --- | --- | --- | --- |\\n| #1 Elon Musk | $356.7 | Tesla, SpaceX, X | United States |\\n| #2 Jeff Bezos | $221.0 | Amazon, Blue Origin, The Washington Post, IMDB, Audible | United States |\\n| #3 Mark Zuckerberg | $216.4 | Meta Platforms, Inc. (Facebook, Instagram, WhatsApp) | United States |\\n| #4 Larry Ellison | $191.4 | Oracle Corporation | United States | [...] | **Name & Rank** | **Net Worth (in $ Billions)** | **Companies/ Source of Wealth** | **Country** |\\n| --- | --- | --- | --- |\\n| #1 Elon Musk | $356.7 | Tesla, SpaceX, X | United States |\\n| #2 Jeff Bezos | $221.0 | Amazon, Blue Origin, The Washington Post, IMDB, Audible | United States |\\n| #3 Mark Zuckerberg | $216.4 | Meta Platforms, Inc. (Facebook, Instagram, WhatsApp) | United States |\\n| #4 Larry Ellison | $191.4 | Oracle Corporation | United States | [...] | **Name & Rank** | **Net Worth (in $ Billions)** | **Companies/ Source of Wealth** | **Country** |\\n| --- | --- | --- | --- |\\n| #1 Elon Musk | $356.7 | Tesla, SpaceX, X | United States |\\n| #2 Jeff Bezos | $221.0 | Amazon, Blue Origin, The Washington Post, IMDB, Audible | United States |\\n| #3 Mark Zuckerberg | $216.4 | Meta Platforms, Inc. (Facebook, Instagram, WhatsApp) | United States |\\n| #4 Larry Ellison | $191.4 | Oracle Corporation | United States |", "score": 0.7011614}]', name='tavily_search_results_json', id='32c7e94f-3742-436f-8286-274cca874131', tool_call_id='call_ak7YG4vLPT2ylQCXCscWEJ0B', artifact={'query': 'current net worth of the richest person in the world', 'follow_up_questions': None, 'answer': None, 'images': [], 'results': [{'url': 'https://www.statesman.com/story/news/state/2025/04/14/who-is-the-richest-person-in-the-world-wealthiest-forbes-ranking-list-2025-net-worth-elon-musk/83042795007/', 'title': "Who is the richest person in the world? See Elon Musk's net worth", 'content': "## Who is the richest person in the world? Hint: He's a Texan\n\n![Tesla CEO Elon Musk attends a Cabinet meeting at the White House on March 24, 2025.]()\n\n**Elon Musk** holds the title of the world's richest person . He has a net worth of $365.3 billion as of April 2025, [according to the latest Forbes data](https://www.forbes.com/real-time-billionaires/#310717713d78). [...] |  |  |  |  |  |\n| --- | --- | --- | --- | --- |\n| **Rank** | **Name** | **Total net worth** | **Entity** | **Country/Region** |\n| 1 | Elon Musk | $365.3B | Tesla, SpaceX | United States |\n| 2 | Jeff Bezos | $198.3B | Amazon | United States |\n| 3 | Mark Zuckerberg | $185.5B | Facebook | United States |\n| 4 | Larry Ellison | $164.7B | Oracle | United States |\n| 5 | Warren Buffett | $160.0B | Berkshire Hathaway | United States |\n| 6 | Bernard Arnault & family | $150.8B | LVMH | France | [...] In 2023, Bettencourt Meyers once again surpassed Walton, who dropped to the third-place spot due to American socialite Julia Koch, who inherited Koch, Inc. ownership stakes from her late husband David Koch. Koch, 62, was estimated to be worth $74.2 billion in the latest Forbes ranking.\n\n## LIST: World's 10 wealthiest people\n\nAll but one of Earth's 10 richest people reside in the U.S. Here's their rankings and net worth as of April 11, as reported by Forbes:", 'score': 0.8649622, 'raw_content': None}, {'url': 'https://www.statista.com/statistics/272047/top-25-global-billionaires/', 'title': 'Richest people in the world 2025 - Statista', 'content': 'As of March 2025, Elon Musk had a net worth valued at 328.5 billion US dollars, making him the richest man in the world.', 'score': 0.850382, 'raw_content': None}, {'url': 'https://www.indmoney.com/blog/us-stocks/top-10-richest-people-in-the-world', 'title': 'Top 10 Richest People in the World 2025: Elon Musk, Jeff Bezos ...', 'content': 'Tesla founder Elon Musk is the richest man in the world with a net worth of $420 billion, closely followed by Jeff Bezos at $266 billion.', 'score': 0.81630427, 'raw_content': None}, {'url': 'https://www.bankrate.com/investing/worlds-richest-people/', 'title': "World's 10 Richest People: List Of The Wealthiest Billionaires", 'content': 'These billionaires reached their lofty heights through hard work, great ideas, serendipity and plenty of careful planning along the way.\n\nHere are the worldâ€™s 10 richest people and some of their key investments, according to the [Bloomberg Billionaires Index](https://www.bloomberg.com/billionaires/), as of June 11, 2025.\n\n## 1. Elon Musk: $369 billion [...] ### Editorial disclosure\n\nAll reviews are prepared by our staff. Opinions expressed are solely\nthose of the reviewer and have not been reviewed or approved by any\nadvertiser. The information, including any rates, terms and fees\nassociated with financial products, presented in the review is accurate\nas of the date of publication.\n\n# The worldâ€™s 10 richest people: The wealthiest have $100 billion or more [...] | Person | Wealth | Key investments |\n| --- | --- | --- |\n| **1. Elon Musk** | $369 billion | Tesla, SpaceX, Twitter (since renamed X) |\n| **2. Mark Zuckerberg** | $245 billion | Meta Platforms |\n| **3. Jeff Bezos** | $234 billion | Amazon, Blue Origin |\n| **4. Larry Ellison** | $200 billion | Oracle |\n| **5. Bill Gates** | $177 billion | Microsoft |\n| **6. Steve Ballmer** | $163 billion | Microsoft |\n| **7. Larry Page** | $160 billion | Alphabet |', 'score': 0.7050753, 'raw_content': None}, {'url': 'https://www.forbesindia.com/article/explainers/top-10-richest-people-world/85541/1', 'title': 'The Top 10 Richest People In The World In 2025 - Forbes India', 'content': '| **Name & Rank** | **Net Worth (in $ Billions)** | **Companies/ Source of Wealth** | **Country** |\n| --- | --- | --- | --- |\n| #1 Elon Musk | $356.7 | Tesla, SpaceX, X | United States |\n| #2 Jeff Bezos | $221.0 | Amazon, Blue Origin, The Washington Post, IMDB, Audible | United States |\n| #3 Mark Zuckerberg | $216.4 | Meta Platforms, Inc. (Facebook, Instagram, WhatsApp) | United States |\n| #4 Larry Ellison | $191.4 | Oracle Corporation | United States | [...] | **Name & Rank** | **Net Worth (in $ Billions)** | **Companies/ Source of Wealth** | **Country** |\n| --- | --- | --- | --- |\n| #1 Elon Musk | $356.7 | Tesla, SpaceX, X | United States |\n| #2 Jeff Bezos | $221.0 | Amazon, Blue Origin, The Washington Post, IMDB, Audible | United States |\n| #3 Mark Zuckerberg | $216.4 | Meta Platforms, Inc. (Facebook, Instagram, WhatsApp) | United States |\n| #4 Larry Ellison | $191.4 | Oracle Corporation | United States | [...] | **Name & Rank** | **Net Worth (in $ Billions)** | **Companies/ Source of Wealth** | **Country** |\n| --- | --- | --- | --- |\n| #1 Elon Musk | $356.7 | Tesla, SpaceX, X | United States |\n| #2 Jeff Bezos | $221.0 | Amazon, Blue Origin, The Washington Post, IMDB, Audible | United States |\n| #3 Mark Zuckerberg | $216.4 | Meta Platforms, Inc. (Facebook, Instagram, WhatsApp) | United States |\n| #4 Larry Ellison | $191.4 | Oracle Corporation | United States |', 'score': 0.7011614, 'raw_content': None}], 'response_time': 4.06}), AIMessage(content='æˆªè‡³2025å¹´4æœˆï¼ŒåŸƒéš†Â·é©¬æ–¯å…‹ï¼ˆElon Muskï¼‰æ˜¯ä¸–ç•Œé¦–å¯Œï¼Œä»–çš„å‡€èµ„äº§ä¸º3653äº¿ç¾å…ƒã€‚', additional_kwargs={'refusal': None}, response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 1621, 'total_tokens': 1654, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}, 'input_tokens': 0, 'output_tokens': 0, 'input_tokens_details': None}, 'model_name': 'gpt-4o', 'system_fingerprint': 'fp_ee1d74bde0', 'id': 'chatcmpl-BitefbZ2ju6whsNWfeHSlRRBYy2cC', 'service_tier': None, 'finish_reason': 'stop', 'logprobs': None}, id='run--5f377fa5-4e40-4639-b94d-70b8880366ec-0', usage_metadata={'input_tokens': 1621, 'output_tokens': 33, 'total_tokens': 1654, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}})]}
```

### å®šä¹‰çŠ¶æ€ 

å®šä¹‰è¦è·Ÿè¸ªæ­¤ä»£ç†çš„çŠ¶æ€å¼€å§‹ã€‚é¦–å…ˆï¼Œéœ€è¦è·Ÿè¸ªå½“å‰è®¡åˆ’ã€‚ å°†å…¶è¡¨ç¤ºä¸ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚æ¥ä¸‹æ¥ï¼Œåº”è¯¥è·Ÿè¸ªå…ˆå‰æ‰§è¡Œçš„æ­¥éª¤ã€‚ è®©å…¶è¡¨ç¤ºä¸ºå…ƒ

ç»„åˆ—è¡¨ï¼ˆè¿™äº›å…ƒç»„å°†åŒ…å«æ­¥éª¤åŠå…¶ç»“æœï¼‰æœ€åï¼Œéœ€è¦ä¸€äº›çŠ¶æ€æ¥è¡¨ç¤ºæœ€ç»ˆå“åº”ä»¥åŠåŸå§‹è¾“å…¥ã€‚

```python
import operator
from typing import Annotated, List, Tuple, TypedDict

# å®šä¹‰ç±» ç”¨äºå­˜å‚¨è¾“å…¥ã€è®¡åˆ’ã€è¿‡å»çš„æ­¥éª¤å’Œå“åº”
class PlanExecute(TypedDict):
    input: str
    plan: List[str]
    past_steps: Annotated[List[Tuple], operator.add]
    response: str
```

### è§„åˆ’æ­¥éª¤ 

ç°åœ¨è®©è€ƒè™‘åˆ›å»ºè§„åˆ’æ­¥éª¤ã€‚ è¿™å°†ä½¿ç”¨å‡½æ•°è°ƒç”¨æ¥åˆ›å»ºè®¡åˆ’ã€‚

```python
# å®šä¹‰planæ¨¡å‹
class Plan(BaseModel):
    """æœªæ¥è¦æ‰§è¡Œçš„è®¡åˆ’"""
    steps: List[str] = Field(
        description="éœ€è¦æ‰§è¡Œçš„ä¸åŒæ­¥éª¤ï¼Œåº”è¯¥æŒ‰é¡ºåºæ’åº"
    )

# åˆ›å»ºè®¡åˆ’ç”Ÿæˆæ¨¡ç‰ˆ
planner_prompt = ChatPromptTemplate.from_messages(
    [
        (
            "system",
            """å¯¹äºç»™å®šçš„ç›®æ ‡ï¼Œæå‡ºä¸€ä¸ªç®€å•çš„é€æ­¥è®¡åˆ’ã€‚è¿™ä¸ªè®¡åˆ’åº”è¯¥åŒ…å«ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œå¦‚æœæ­£ç¡®æ‰§è¡Œå°†å¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚ä¸è¦æ·»åŠ ä»»ä½•å¤šä½™çš„æ­¥éª¤ã€‚æœ€åä¸€æ­¥çš„ç»“æœåº”è¯¥æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚ç¡®ä¿æ¯ä¸€æ­¥éƒ½æœ‰æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ - ä¸è¦è·³è¿‡æ­¥éª¤ã€‚""",
        ),
        ("placeholder", "{messages}"),
    ]
)

planner = planner_prompt | llm.with_structured_output(Plan)

response = planner.invoke(
    {
        "messages": [
            ("user", "é©¬äº‘çš„å®¶ä¹¡æ˜¯å“ª")
        ]
    }
)

print(response)
```

```
steps=['æŸ¥æ‰¾é©¬äº‘çš„å‡ºç”Ÿåœ°ä¿¡æ¯ã€‚', 'ç¡®è®¤é©¬äº‘çš„å‡ºç”Ÿåœ°æ˜¯ä¸­å›½æµ™æ±Ÿçœæ­å·å¸‚ã€‚', 'å¾—å‡ºç»“è®ºï¼šé©¬äº‘çš„å®¶ä¹¡æ˜¯æµ™æ±Ÿçœæ­å·å¸‚ã€‚']
```

### é‡æ–°è§„åˆ’æ­¥éª¤ 

ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªæ ¹æ®ä¸Šä¸€æ­¥ç»“æœé‡æ–°åˆ¶å®šè®¡åˆ’çš„æ­¥éª¤ã€‚

```python
# å®šä¹‰planæ¨¡å‹
class Plan(BaseModel):
    """æœªæ¥è¦æ‰§è¡Œçš„è®¡åˆ’"""
    steps: List[str] = Field(
        description="éœ€è¦æ‰§è¡Œçš„ä¸åŒæ­¥éª¤ï¼Œåº”è¯¥æŒ‰é¡ºåºæ’åº"
    )

# å®šä¹‰å“åº”æ¨¡å‹
class Response(BaseModel):
    """ç”¨æˆ·å“åº”"""
    response: str

# å®šä¹‰è¦æ‰§è¡Œçš„è¡Œä¸º
class Act(BaseModel):
    """è¦æ‰§è¡Œçš„è¡Œä¸º"""
    action: Union[Response, Plan] = Field(
        description="è¦æ‰§è¡Œçš„è¡Œä¸ºã€‚å¦‚æœè¦å›åº”ç”¨æˆ·ï¼Œä½¿ç”¨Responseã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥ä½¿ç”¨å·¥å…·è·å–ç­”æ¡ˆï¼Œä½¿ç”¨Planã€‚"
    )

# åˆ›å»ºä¸€ä¸ªé‡æ–°è®¡åˆ’çš„æç¤ºè¯æ¨¡ç‰ˆ
replanner_prompt = ChatPromptTemplate.from_template(
    """
    å¯¹äºç»™å®šçš„ç›®æ ‡ï¼Œæå‡ºä¸€ä¸ªç®€å•çš„é€æ­¥è®¡åˆ’ã€‚è¿™ä¸ªè®¡åˆ’åº”è¯¥åŒ…å«ç‹¬ç«‹çš„ä»»åŠ¡ï¼Œå¦‚æœæ­£ç¡®æ‰§è¡Œå°†å¾—å‡ºæ­£ç¡®çš„ç­”æ¡ˆã€‚ä¸è¦æ·»åŠ ä»»ä½•å¤šä½™çš„æ­¥éª¤ã€‚æœ€åä¸€æ­¥çš„ç»“æœåº”è¯¥æ˜¯æœ€ç»ˆç­”æ¡ˆã€‚ç¡®ä¿æ¯ä¸€æ­¥éƒ½æœ‰æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ - ä¸è¦è·³è¿‡æ­¥éª¤ã€‚
    
    ä½ çš„ç›®æ ‡æ˜¯ï¼š
    {input}
    
    ä½ çš„åŸè®¡åˆ’æ˜¯ï¼š
    {plan}
    
    ä½ ç›®å‰å·²å®Œæˆçš„æ­¥éª¤æ˜¯ï¼š
    {past_steps}
    
    ç›¸åº”åœ°æ›´æ–°ä½ çš„è®¡åˆ’ã€‚å¦‚æœä¸éœ€è¦æ›´å¤šæ­¥éª¤å¹¶ä¸”å¯ä»¥è¿”å›ç»™ç”¨æˆ·ï¼Œé‚£ä¹ˆå°±è¿™æ ·å›åº”ã€‚å¦‚æœéœ€è¦ï¼Œå¡«å†™è®¡åˆ’ã€‚åªæ·»åŠ ä»ç„¶éœ€è¦å®Œæˆçš„æ­¥éª¤ã€‚ä¸è¦è¿”å›å·²å®Œæˆçš„æ­¥éª¤ä½œä¸ºè®¡åˆ’çš„ä¸€éƒ¨åˆ†ã€‚
    """
)

# ä½¿ç”¨æŒ‡å®šæç¤ºè¯åˆ›å»ºä¸€ä¸ªé‡æ–°è®¡åˆ’ç”Ÿæˆå™¨
replanner = replanner_prompt | llm.with_structured_output(Act)
```

### åˆ›å»ºå›¾ 

```python
# å®šä¹‰ä¸»å‡½æ•°
async def main():
    # å®šä¹‰æ‰§è¡Œæ­¥éª¤å‡½æ•°
    async def execute_step(state: PlanExecute):
        plan = state["plan"]
        plan_str = "\n".join(f"P{i + 1}. {step}" for i, step in enumerate(plan))
        task = plan[0]
        task_formatted = f"""
        å¯¹äºä»¥ä¸‹è®¡åˆ’
        {plan_str}\n\n ä½ çš„ä»»åŠ¡æ˜¯æ‰§è¡Œç¬¬{1}æ­¥ï¼Œ{task}.
        """
        agent_response = await agent_executor.ainvoke(
            {"messages": [("user", task_formatted)]}
        )
        return {
            "past_steps": state["past_steps"] + [(task, agent_response["messages"][-1].content)]
        }

    # å®šä¹‰ç”Ÿæˆè®¡åˆ’å‡½æ•°
    async def plan_step(state: PlanExecute):
        plan = await planner.ainvoke(
            {"messages": [("user", state["input"])]}
        )
        return {"plan": plan.steps}

    # å®šä¹‰é‡æ–°ç”Ÿæˆè®¡åˆ’æ­¥éª¤
    async def replan_step(state: PlanExecute):
        output = await planner.ainvoke(state)
        if isinstance(output.action, Response):
            return {"response": output.action.response}
        else:
            return {"plan": output.action.steps}

    # å®šä¹‰åˆ¤æ–­å‡½æ•°
    def should_end(state: PlanExecute) -> Literal["agent", "__end__"]:
        if "response" in state and state["response"]:
            return "__end__"
        else:
            return "agent"

    # åˆ›å»ºä¸€ä¸ªçŠ¶æ€å›¾
    workflow = StateGraph(PlanExecute)

    # æ·»åŠ è®¡åˆ’èŠ‚ç‚¹
    workflow.add_node("planner", plan_step)

    # æ·»åŠ ä¸€ä¸ªæ­¥éª¤èŠ‚ç‚¹
    workflow.add_node("agent", execute_step)

    # æ·»åŠ é‡æ–°è®¡åˆ’ç”ŸæˆèŠ‚ç‚¹
    workflow.add_node("replan", replan_step)

    # æ·»åŠ å¼€å§‹å’Œè®¡åˆ’èŠ‚ç‚¹çš„è¾¹
    workflow.add_edge(START, "planner")

    # æ·»åŠ è®¡åˆ’å’Œagentçš„è¾¹
    workflow.add_edge("planner", "agent")

    # æ·»åŠ agentå’Œé‡æ–°è®¡åˆ’èŠ‚ç‚¹çš„è¾¹
    workflow.add_edge("agent", "replan")

    # æ·»åŠ æ¡ä»¶å˜
    workflow.add_conditional_edges(
        "replan",
        should_end
    )

    # ç¼–è¯‘çŠ¶æ€å›¾ï¼Œç”Ÿæˆå¯è¿è¡Œå¯¹è±¡
    app = workflow.compile()

    # ä¿å­˜ç”Ÿæˆçš„å›¾ç‰‡
    graph_png = app.get_graph().draw_mermaid_png()
    with open("plan.png", "wb") as f:
        f.write(graph_png)

asyncio.run(main())
```

![img](../å›¾ç‰‡/1724582939404-0dc86760-5031-4d42-b758-76645090fc5f.png)

```python
# è®¾ç½®é€’å½’é™åˆ¶
    config = {"recursion_limit": 50}

    # å®šä¹‰è¾“å…¥
    inputs = {"input": "xtransferçš„åˆ›å§‹äººçš„å®¶ä¹¡æ˜¯å“ªï¼Ÿç”¨ä¸­æ–‡å›å¤"}

    # æ‰§è¡Œ
    async for event in app.astream(inputs, config=config):
        for k, v in event.items():
            if k != "__end__":
                print(v)
```

```
{'plan': ['è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'ç¡®è®¤åˆ›å§‹äººçš„å®¶ä¹¡ä¿¡æ¯åï¼Œç”¨ä¸­æ–‡è®°å½•ä¸‹æ¥ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚')]}
{'plan': ['æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'ç¡®è®¤åˆ›å§‹äººçš„å®¶ä¹¡ä¿¡æ¯åï¼Œç”¨ä¸­æ–‡è®°å½•ä¸‹æ¥ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚')]}
{'plan': ['é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'ç¡®è®¤åˆ›å§‹äººçš„å®¶ä¹¡ä¿¡æ¯åï¼Œç”¨ä¸­æ–‡è®°å½•ä¸‹æ¥ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚')]}
{'plan': ['å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'ç¡®è®¤åˆ›å§‹äººçš„å®¶ä¹¡ä¿¡æ¯åï¼Œç”¨ä¸­æ–‡è®°å½•ä¸‹æ¥ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚')]}
{'plan': ['æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'ä½¿ç”¨åˆ›å§‹äººçš„å§“ååœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'ç¡®è®¤åˆ›å§‹äººçš„å®¶ä¹¡ä¿¡æ¯åï¼Œç”¨ä¸­æ–‡è®°å½•ä¸‹æ¥ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚')]}
{'plan': ['ä½¿ç”¨åˆ›å§‹äººé‚“å›½æ ‡çš„å§“ååœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'ç¡®è®¤é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯åï¼Œç”¨ä¸­æ–‡è®°å½•ä¸‹æ¥ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('ä½¿ç”¨åˆ›å§‹äººé‚“å›½æ ‡çš„å§“ååœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'åœ¨æœç´¢ç»“æœä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æ˜ç¡®æåˆ°é‚“å›½æ ‡å®¶ä¹¡çš„ä¿¡æ¯ã€‚æœç´¢ç»“æœä¸»è¦æ¶‰åŠé‚“å›½æ ‡çš„èŒä¸šç”Ÿæ¶¯å’Œå…¬å¸æ´»åŠ¨ã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„è°ƒæŸ¥æˆ–è®¿é—®å…¶ä»–æ¥æºã€‚')]}
{'plan': ['è”ç³»xTransferçš„å…¬å…±å…³ç³»æˆ–åª’ä½“è”ç³»äººï¼Œè¯¢é—®é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ã€‚', 'è®¿é—®ç¤¾äº¤åª’ä½“å¹³å°ï¼ŒæŸ¥çœ‹é‚“å›½æ ‡çš„ä¸ªäººèµ„æ–™æˆ–å‘å¸ƒçš„å†…å®¹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„çº¿ç´¢ã€‚', 'å¦‚æœä»¥ä¸Šæ–¹æ³•æ— æ•ˆï¼Œè€ƒè™‘è”ç³»ç›¸å…³è¡Œä¸šçš„ä¸“ä¸šäººå£«æˆ–è®°è€…ï¼Œè¯¢é—®ä»–ä»¬æ˜¯å¦æœ‰å…³äºé‚“å›½æ ‡å®¶ä¹¡çš„ä¿¡æ¯ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('ä½¿ç”¨åˆ›å§‹äººé‚“å›½æ ‡çš„å§“ååœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'åœ¨æœç´¢ç»“æœä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æ˜ç¡®æåˆ°é‚“å›½æ ‡å®¶ä¹¡çš„ä¿¡æ¯ã€‚æœç´¢ç»“æœä¸»è¦æ¶‰åŠé‚“å›½æ ‡çš„èŒä¸šç”Ÿæ¶¯å’Œå…¬å¸æ´»åŠ¨ã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„è°ƒæŸ¥æˆ–è®¿é—®å…¶ä»–æ¥æºã€‚'), ('è”ç³»xTransferçš„å…¬å…±å…³ç³»æˆ–åª’ä½“è”ç³»äººï¼Œè¯¢é—®é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ã€‚', "To contact xTransfer's public relations or media contact, you can reach out to Maggie Ng, the Public Relations Director. Here are her contact details:\n\n- **Email**: [maggie.ng@xtransfer.com](mailto:maggie.ng@xtransfer.com)\n- **Phone**: +852 6287 2989\n\nYou can use this information to inquire about Deng Guobiao's hometown.")]}
{'plan': ['è”ç³»xTransferçš„å…¬å…±å…³ç³»æˆ–åª’ä½“è”ç³»äººï¼Œè¯¢é—®é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ã€‚']}
{'past_steps': [('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('ä½¿ç”¨åˆ›å§‹äººé‚“å›½æ ‡çš„å§“ååœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'åœ¨æœç´¢ç»“æœä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æ˜ç¡®æåˆ°é‚“å›½æ ‡å®¶ä¹¡çš„ä¿¡æ¯ã€‚æœç´¢ç»“æœä¸»è¦æ¶‰åŠé‚“å›½æ ‡çš„èŒä¸šç”Ÿæ¶¯å’Œå…¬å¸æ´»åŠ¨ã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„è°ƒæŸ¥æˆ–è®¿é—®å…¶ä»–æ¥æºã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('è®¿é—®xTransferçš„å®˜æ–¹ç½‘ç«™æˆ–ç›¸å…³çš„å…¬å¸ä»‹ç»é¡µé¢ã€‚', 'ä½ å¯ä»¥è®¿é—® [XTransfer çš„å®˜æ–¹ç½‘ç«™](https://www.xtransfer.cn/) æ¥è·å–æ›´å¤šå…³äºå…¬å¸çš„ä¿¡æ¯ã€‚'), ('æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ï¼Œé€šå¸¸åœ¨â€œå…³äºæˆ‘ä»¬â€æˆ–â€œå›¢é˜Ÿä»‹ç»â€éƒ¨åˆ†ã€‚', 'è¯·æä¾›å…¬å¸åç§°æˆ–å®˜æ–¹ç½‘ç«™çš„é“¾æ¥ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…³äºå…¬å¸åˆ›å§‹äººçš„ä¿¡æ¯ã€‚'), ('é˜…è¯»åˆ›å§‹äººçš„ä¸ªäººç®€ä»‹ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾å…¶ä¸ªäººç®€ä»‹ã€‚'), ('å¦‚æœå®˜æ–¹ç½‘ç«™æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æœç´¢ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œé€šå¸¸ä¼šæåˆ°åˆ›å§‹äººçš„èƒŒæ™¯ã€‚', 'è¯·æä¾›åˆ›å§‹äººçš„å§“åæˆ–ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘å¯ä»¥å¸®åŠ©æ‚¨æŸ¥æ‰¾ä»–ä»¬çš„èƒŒæ™¯ä¿¡æ¯ã€‚'), ('æœç´¢xTransferåˆ›å§‹äººçš„å§“åã€‚', 'xTransferçš„åˆ›å§‹äººæ˜¯é‚“å›½æ ‡ã€‚'), ('ä½¿ç”¨åˆ›å§‹äººé‚“å›½æ ‡çš„å§“ååœ¨æœç´¢å¼•æ“ä¸­æŸ¥æ‰¾ç›¸å…³æ–°é—»æŠ¥é“æˆ–é‡‡è®¿ï¼Œå¯»æ‰¾æœ‰å…³å…¶å®¶ä¹¡çš„ä¿¡æ¯ã€‚', 'åœ¨æœç´¢ç»“æœä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æ˜ç¡®æåˆ°é‚“å›½æ ‡å®¶ä¹¡çš„ä¿¡æ¯ã€‚æœç´¢ç»“æœä¸»è¦æ¶‰åŠé‚“å›½æ ‡çš„èŒä¸šç”Ÿæ¶¯å’Œå…¬å¸æ´»åŠ¨ã€‚å¦‚æœéœ€è¦è¿›ä¸€æ­¥ç¡®è®¤é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ï¼Œå¯èƒ½éœ€è¦æ›´æ·±å…¥çš„è°ƒæŸ¥æˆ–è®¿é—®å…¶ä»–æ¥æºã€‚'), ('è”ç³»xTransferçš„å…¬å…±å…³ç³»æˆ–åª’ä½“è”ç³»äººï¼Œè¯¢é—®é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ã€‚', "To contact xTransfer's public relations or media contact, you can reach out to Maggie Ng, the Public Relations Director. Here are her contact details:\n\n- **Email**: [maggie.ng@xtransfer.com](mailto:maggie.ng@xtransfer.com)\n- **Phone**: +852 6287 2989\n\nYou can use this information to inquire about Deng Guobiao's hometown."), ('è”ç³»xTransferçš„å…¬å…±å…³ç³»æˆ–åª’ä½“è”ç³»äººï¼Œè¯¢é—®é‚“å›½æ ‡çš„å®¶ä¹¡ä¿¡æ¯ã€‚', "To contact xTransfer's public relations or media contact, you can reach out to Maggie Ng, the Public Relations Director. Here are her contact details:\n\n- **Email**: [maggie.ng@xtransfer.com](mailto:maggie.ng@xtransfer.com)\n- **Phone**: +852 6287 2989\n\nYou can use this information to inquire about Deng Guobiao's hometown.")]}
{'response': 'é‚“å›½æ ‡çš„å®¶ä¹¡æ˜¯ä¸­å›½å¹¿ä¸œçœæ½®å·å¸‚ã€‚'}
```

# LangGraphåŸºäºRAGæ„å»ºæ™ºèƒ½å®¢æœåº”ç”¨

AI é¢†åŸŸæ­£ä»åŸºç¡€çš„ RAG ç³»ç»Ÿå‘æ›´æ™ºèƒ½çš„ AI æ™ºèƒ½ä½“è¿›åŒ–ï¼Œåè€…èƒ½å¤„ç†æ›´å¤æ‚çš„ä»»åŠ¡å¹¶é€‚åº”æ–°ä¿¡æ¯ã€‚LangGraph ä½œä¸º LangChain åº“çš„æ‰©

å±•ï¼ŒåŠ©åŠ›å¼€å‘è€…æ„å»ºå…·æœ‰[çŠ¶æ€ç®¡ç†](https://so.csdn.net/so/search?q=çŠ¶æ€ç®¡ç†&spm=1001.2101.3001.7020)å’Œå¾ªç¯è®¡ç®—èƒ½åŠ›çš„å…ˆè¿› AI ç³»ç»Ÿã€‚

## LangGraphæµç¨‹ 

LangGraph æ˜¯ LangChain çš„é«˜çº§åº“ï¼Œä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å¸¦æ¥å¾ªç¯[è®¡ç®—èƒ½åŠ›](https://so.csdn.net/so/search?q=è®¡ç®—èƒ½åŠ›&spm=1001.2101.3001.7020)ã€‚å®ƒè¶…è¶Šäº† LangChain çš„çº¿æ€§å·¥ä½œæµï¼Œé€šè¿‡å¾ªç¯æ”¯æŒå¤

æ‚çš„ä»»åŠ¡å¤„ç†ã€‚

- çŠ¶æ€ï¼šç»´æŠ¤è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡ï¼Œå®ç°åŸºäºç´¯ç§¯æ•°æ®çš„åŠ¨æ€å†³ç­–ã€‚
- èŠ‚ç‚¹ï¼šä»£è¡¨è®¡ç®—æ­¥éª¤ï¼Œæ‰§è¡Œç‰¹å®šä»»åŠ¡ï¼Œå¯å®šåˆ¶ä»¥é€‚åº”ä¸åŒå·¥ä½œæµã€‚
- è¾¹ï¼šè¿æ¥èŠ‚ç‚¹ï¼Œå®šä¹‰è®¡ç®—æµç¨‹ï¼Œæ”¯æŒæ¡ä»¶é€»è¾‘ï¼Œå®ç°å¤æ‚å·¥ä½œæµã€‚

![img](../å›¾ç‰‡/1736319173136-48cbaf41-afd6-4d2d-a249-2f71a79764eb.png)

LangGraph ç®€åŒ–äº† AI å¼€å‘ï¼Œè‡ªåŠ¨ç®¡ç†çŠ¶æ€ï¼Œä¿æŒä¸Šä¸‹æ–‡ï¼Œä½¿ AI èƒ½æ™ºèƒ½å“åº”å˜åŒ–ã€‚å®ƒè®©å¼€å‘è€…ä¸“æ³¨äºåˆ›æ–°ï¼Œè€ŒéæŠ€æœ¯ç»†èŠ‚ï¼ŒåŒæ—¶ç¡®ä¿åº”

ç”¨ç¨‹åºçš„é«˜æ€§èƒ½å’Œå¯é æ€§ã€‚

## RAGæµç¨‹ 

![img](../å›¾ç‰‡/1736320029950-6383031c-dee2-494b-8b86-3f10de2e6cc4.png)

ä¸€ä¸ªå…¸å‹çš„RAGåº”ç”¨æœ‰ä¸¤ä¸ªä¸»è¦ç»„æˆéƒ¨åˆ†ï¼š

ç´¢å¼•(Indexing)ï¼šä»æ•°æ®æºè·å–æ•°æ®å¹¶å»ºç«‹ç´¢å¼•çš„ç®¡é“(pipeline)ã€‚è¿™é€šå¸¸åœ¨ç¦»çº¿çŠ¶æ€ä¸‹è¿›è¡Œã€‚

æ£€ç´¢å’Œç”Ÿæˆ(Retrieval and generation)ï¼šå®é™…çš„RAGé“¾ï¼Œåœ¨è¿è¡Œæ—¶æ¥æ”¶ç”¨æˆ·æŸ¥è¯¢ï¼Œä»ç´¢å¼•ä¸­æ£€ç´¢ç›¸å…³æ•°æ®ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™æ¨¡å‹ã€‚

ä»åŸå§‹æ•°æ®åˆ°ç­”æ¡ˆçš„æœ€å¸¸è§å®Œæ•´é¡ºåºå¦‚ä¸‹ï¼š

## ç´¢å¼•(Indexing)  

1. åŠ è½½(Load)ï¼šé¦–å…ˆæˆ‘ä»¬éœ€è¦åŠ è½½æ•°æ®ã€‚è¿™æ˜¯é€šè¿‡æ–‡æ¡£åŠ è½½å™¨[Document Loaders](https://blog.frognew.com/library/agi/langchain/components/document-loaders.html)å®Œæˆçš„ã€‚
2. åˆ†å‰²(Split)ï¼šæ–‡æœ¬åˆ†å‰²å™¨[Text splitters](https://python.langchain.com/docs/concepts/#text-splitters)å°†å¤§å‹æ–‡æ¡£(Documents)åˆ†æˆæ›´å°çš„å—(chunks)ã€‚è¿™å¯¹äºç´¢å¼•æ•°æ®å’Œå°†å…¶ä¼ é€’ç»™æ¨¡å‹éƒ½å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¤§å—æ•°æ®æ›´éš¾æœç´¢ï¼Œè€Œä¸”ä¸é€‚åˆæ¨¡å‹æœ‰é™çš„ä¸Šä¸‹æ–‡çª—å£ã€‚
3. å­˜å‚¨(Store)ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ°æ–¹æ¥å­˜å‚¨å’Œç´¢å¼•æˆ‘ä»¬çš„åˆ†å‰²(splits)ï¼Œä»¥ä¾¿åç»­å¯ä»¥å¯¹å…¶è¿›è¡Œæœç´¢ã€‚è¿™é€šå¸¸ä½¿ç”¨å‘é‡å­˜å‚¨[VectorStore](https://blog.frognew.com/library/agi/langchain/components/vector-stores.html)å’ŒåµŒå…¥æ¨¡å‹[Embeddings model](https://blog.frognew.com/library/agi/langchain/components/embedding-models.html)æ¥å®Œæˆã€‚

![img](../å›¾ç‰‡/1736306619642-e71bb3f9-95bf-4658-9f28-5568685d1304-20250601195106405.png)

## æ£€ç´¢å’Œç”Ÿæˆ(Retrieval and generation)  

1. æ£€ç´¢(Retrieve)ï¼šç»™å®šç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨æ£€ç´¢å™¨[Retriever](https://blog.frognew.com/library/agi/langchain/components/retrievers.html)ä»å­˜å‚¨ä¸­æ£€ç´¢ç›¸å…³çš„æ–‡æœ¬ç‰‡æ®µã€‚
2. ç”Ÿæˆ(Generate)ï¼š [ChatModel](https://blog.frognew.com/library/agi/langchain/components/chat-models.html)ä½¿ç”¨åŒ…å«é—®é¢˜å’Œæ£€ç´¢åˆ°çš„æ•°æ®çš„æç¤ºæ¥ç”Ÿæˆç­”æ¡ˆã€‚

![img](../å›¾ç‰‡/1736306619770-c7136d46-502f-45ff-b182-550407c5a866-20250601195152608.png)

## LangGraphåŸºäºRAGæ„å»ºæ™ºèƒ½å®¢æœ 

### å®¢æœç•Œé¢ 

![image.p](../å›¾ç‰‡/1736322106188-57bd9147-41ba-4377-aa37-8a25105ba5a3-9194589.png)

### è¿è¡Œç¯å¢ƒ 

å»ºè®®ä½¿ç”¨ Python>=3.10

å¯å‚è€ƒå¦‚ä¸‹å‘½ä»¤è¿›è¡Œç¯å¢ƒåˆ›å»º

```
conda create -n agent python=3.10 -y
conda activate agent
```

### å®‰è£…ä¾èµ– 

```
pip install -r requirements.txt
```

### é…ç½®OpenAI ç¯å¢ƒå˜é‡ 

#### Mac å¯¼å…¥ç¯å¢ƒå˜é‡ 

```
export OPENAI_BASE_URL='https://api.openai.com/v1'
export OPENAI_API_KEY='sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'
```

### è¿è¡Œé¡¹ç›® 

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œè¿è¡Œwebui

```
streamlit run rag.py
```

### éªŒè¯æ•ˆæœ 

å¦‚ä½•æŸ¥è¯¢è´¦æˆ·ä½™é¢ï¼Ÿ

![img](../å›¾ç‰‡/1736322106188-57bd9147-41ba-4377-aa37-8a25105ba5a3.png)

# HuggingFace æ ¸å¿ƒç»„ä»¶åŠåº”ç”¨å®æˆ˜

## ä¸€ã€Hugging Face ç®€ä»‹

å®˜ç½‘ï¼šhttps://huggingface.co/

Hugging Face æ˜¯ä¸€ä¸ªå¼€æºçš„ AI ç¤¾åŒºç½‘ç«™ï¼Œç«™å†…å‡ ä¹å›Šæ‹¬äº†æ‰€æœ‰å¸¸è§çš„ AI å¼€æºæ¨¡å‹ï¼Œå·ç§°ï¼šä¸€ç½‘æ‰“å°½ï¼Œåº”æœ‰å°½æœ‰ï¼Œå…¨éƒ¨å¼€æºã€‚

![img](../å›¾ç‰‡/1736329281540-79e3d7dd-7330-45da-bedb-b8a5988019b6.png)

åœ¨ Hugging Face ä¸­å¯ä»¥ä¸‹è½½åˆ°ä¼—å¤šå¼€æºçš„é¢„è®­ç»ƒå¤§æ¨¡å‹ï¼Œæ¨¡å‹æœ¬èº«åŒ…å«ç›¸å…³ä¿¡æ¯å’Œå‚æ•°ï¼Œå¯ä»¥æ‹¿æ¥åšå¾®è°ƒå’Œé‡æ–°è®­ç»ƒï¼Œéå¸¸æ–¹ä¾¿ã€‚

![img](../å›¾ç‰‡/1736329281532-d5807167-9ab1-4fdb-ade0-e32f9ec26c79.png)

## äºŒã€Hugging Face æ ¸å¿ƒç»„ä»¶

![img](../å›¾ç‰‡/1736329281595-47360d0f-4018-4626-a02e-cc7bcd73e8af.png)

Hugging Face æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ **Transformersã€Datasetã€Tokenizer**ï¼Œæ­¤å¤–è¿˜æœ‰ä¸€äº›è¾…åŠ©å·¥å…·ï¼Œå¦‚ **Accelerate**ï¼Œç”¨äºåŠ é€Ÿæ·±åº¦å­¦ä¹ è®­ç»ƒ

è¿‡ç¨‹ã€‚

æ›´å¤šå†…å®¹å¯ä»¥å» Hugging Face å®˜ç½‘ä¸Šå‘æ˜ï¼Œä¸‹é¢é‡ç‚¹ä»‹ç»ä¸‹å®ƒçš„ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚

### 1ã€Hugging Face Transformers

Transformers æ˜¯ Hugging Face çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ï¼Œæä¾›äº†é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹å’Œç›¸å…³å·¥å…·ï¼Œä½¿å¾—ç ”ç©¶è€…å’Œå·¥ç¨‹å¸ˆèƒ½å¤Ÿ

è½»æ¾çš„è®­ç»ƒå’Œä½¿ç”¨æµ·é‡çš„ NLP æ¨¡å‹ã€‚

å¸¸ç”¨çš„æ¨¡å‹åŒ…æ‹¬ BERTã€GPTã€XLNetã€RoBERTa ç­‰ï¼Œå¹¶æä¾›äº†æ¨¡å‹çš„å„ç§ç‰ˆæœ¬ã€‚

é€šè¿‡ Transformers åº“ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç”¨è¿™äº›é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œæ–‡æœ¬åˆ†ç±»ã€å‘½åå®ä½“è¯†åˆ«ã€æœºå™¨ç¿»è¯‘ã€é—®ç­”ç³»ç»Ÿç­‰ NLP ä»»åŠ¡ã€‚

Transformers åº“æœ¬èº«è¿˜æä¾›æ–¹ä¾¿çš„ APIã€å®ä¾‹ä»£ç ã€æ–‡æ¡£ï¼Œè®©å¼€å‘è€…å­¦ä¹ å’Œä½¿ç”¨è¿™äº›æ¨¡å‹éƒ½å˜å¾—éå¸¸ç®€å•ï¼ŒåŒæ—¶å¼€å‘è€…ä¹Ÿå¯ä»¥ä¸Šä¼ è‡ªå·±

çš„é¢„è®­ç»ƒæ¨¡å‹å’Œ APIã€‚

```python
# é¦–å…ˆé€šè¿‡ pip ä¸‹è½½ç›¸å…³åº“ï¼špip install transformers

# å¯¼å…¥ transformers ç›¸å…³åº“
from transformers import AutoModelForSequenceClassification

# åˆå§‹åŒ–åˆ†è¯å™¨å’Œæ¨¡å‹
model_name = "bert-base-cased"
model = AutoModelForSequenceClassification.from_pretrained(model_name, num_labels=2)

# å°†ç¼–ç åçš„å¼ é‡è¾“å…¥æ¨¡å‹è¿›è¡Œé¢„æµ‹
outputs = model(**inputs)

# è·å–é¢„æµ‹ç»“æœå’Œæ ‡ç­¾
predictions = outputs.logits.argmax(dim=-1)
```

### 2ã€Hugging Face Dataset

Dataset æ˜¯ Hugging Face çš„å…¬å…±æ•°æ®é›†ä»“åº“ï¼Œä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ä¸€äº›æ•°æ®é›†ï¼ˆæ¬¢è¿è¡¥å……ï¼‰ï¼š

1. SQuADï¼šStanford å¤§å­¦å‘å¸ƒçš„é—®ç­”æ•°æ®é›†
2. IMBDBï¼šç”µå½±è¯„è®ºæ•°æ®é›†
3. CoNLL-2003ï¼šNER å‘½åå®ä½“è¯†åˆ«æ•°æ®é›†
4. GLUEï¼šå…¬å…±åŸºå‡†æµ‹è¯•é›†

Hugging Face Dataset ç®€åŒ–äº†æ•°æ®é›†çš„ä¸‹è½½ã€é¢„å¤„ç†è¿‡ç¨‹ï¼Œå¹¶å…·å¤‡æ•°æ®é›†åˆ†å‰²ã€é‡‡æ ·å’Œè¿­ä»£å™¨ç­‰åŠŸèƒ½ã€‚

```python
# é¦–å…ˆé€šè¿‡ pip ä¸‹è½½ç›¸å…³åº“ï¼špip install datasets

# å¯¼å…¥æ•°æ®é›†
from datasets import load_dataset

# ä¸‹è½½æ•°æ®é›†å¹¶æ‰“ä¹±æ•°æ®
dataset_name = "imdb"
dataset = load_dataset(dataset_name)
```

### 3ã€Hugging Face Tokenizer

Tokenizer æ˜¯ Hugging Face çš„åˆ†è¯å™¨ï¼Œå®ƒçš„ä»»åŠ¡æ˜¯å°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºä¸€ä¸ªä¸ªæ ‡è®°ï¼ˆtokensï¼‰ï¼Œå®ƒè¿˜èƒ½å¯¹æ–‡æœ¬åºåˆ—è¿›è¡Œæ¸…æ´—ã€æˆªæ–­å’Œå¡«å……

ç­‰é¢„å¤„ç†ï¼Œä»¥æ»¡è¶³æ¨¡å‹çš„è¾“å…¥è¦æ±‚ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯å°†æ–‡æœ¬åˆ†è§£ä¸ºæ›´å°çš„å•å…ƒï¼ˆé€šå¸¸æ˜¯è¯æˆ–å­è¯ï¼‰ï¼Œå¹¶å°†è¿™äº›å•å…ƒæ˜ å°„åˆ°æ•°å€¼è¡¨ç¤ºã€‚

ä»¥ä¸‹æ˜¯åˆ†è¯å™¨çš„ç®€å•è§£é‡Šï¼š

1. **æ–‡æœ¬åˆ†å‰²**ï¼šåˆ†è¯å™¨é¦–å…ˆå°†è¾“å…¥çš„æ–‡æœ¬åˆ†å‰²æˆæ›´å°çš„å•å…ƒã€‚ä¾‹å¦‚ï¼Œå¯¹äºå¥å­ "I love NLP"ï¼Œåˆ†è¯å™¨å¯èƒ½ä¼šå°†å…¶åˆ†å‰²ä¸º `["I", "love", "NLP"]`ã€‚
2. **è¯æ±‡æ˜ å°„**ï¼šåˆ†è¯å™¨ä¼šå°†æ¯ä¸ªå•å…ƒæ˜ å°„åˆ°ä¸€ä¸ªå”¯ä¸€çš„æ•°å€¼ç´¢å¼•ï¼Œè¿™äº›ç´¢å¼•é€šå¸¸æ¥è‡ªä¸€ä¸ªé¢„å®šä¹‰çš„è¯æ±‡è¡¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾è¯æ±‡è¡¨ä¸­ "I" çš„ç´¢å¼•æ˜¯ 1ï¼Œ"love" çš„ç´¢å¼•æ˜¯ 2ï¼Œ"NLP" çš„ç´¢å¼•æ˜¯ 3ï¼Œé‚£ä¹ˆåˆ†è¯å™¨ä¼šå°†å¥å­è½¬æ¢ä¸º `[1, 2, 3]`ã€‚
3. **å¤„ç†ç‰¹æ®Šæ ‡è®°**ï¼šåˆ†è¯å™¨è¿˜ä¼šå¤„ç†ä¸€äº›ç‰¹æ®Šçš„æ ‡è®°ï¼Œæ¯”å¦‚å¥å­å¼€å¤´çš„ `[CLS]` æ ‡è®°å’Œå¥å­ç»“å°¾çš„ `[SEP]` æ ‡è®°ï¼Œè¿™äº›æ ‡è®°åœ¨æŸäº›æ¨¡å‹ä¸­æ˜¯å¿…éœ€çš„ã€‚
4. **å¡«å……å’Œæˆªæ–­**ï¼šä¸ºäº†ä½¿è¾“å…¥çš„é•¿åº¦ä¸€è‡´ï¼Œåˆ†è¯å™¨å¯ä»¥å¯¹è¾ƒçŸ­çš„åºåˆ—è¿›è¡Œå¡«å……ï¼ˆæ·»åŠ ç‰¹æ®Šçš„å¡«å……æ ‡è®°ï¼‰æˆ–å¯¹è¾ƒé•¿çš„åºåˆ—è¿›è¡Œæˆªæ–­ã€‚

é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œåˆ†è¯å™¨å°†æ–‡æœ¬è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ•°å€¼æ ¼å¼ï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†å’Œé¢„æµ‹ã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®åŠ©ä½ ç†è§£åˆ†è¯

å™¨çš„ä½œç”¨ï¼

```python
# é¦–å…ˆé€šè¿‡ pip ä¸‹è½½ç›¸å…³åº“ï¼špip install transformers

# å¯¼å…¥åˆ†è¯å™¨
from transformers import AutoTokenizer

# åˆå§‹åŒ–åˆ†è¯å™¨å’Œæ¨¡å‹
tokenizer = AutoTokenizer.from_pretrained(model_name)

# å°†æ–‡æœ¬ç¼–ç ä¸ºæ¨¡å‹æœŸæœ›çš„å¼ é‡æ ¼å¼
inputs = tokenizer(dataset["train"]["text"][:10], 
                   padding=True, truncation=True, return_tensors="pt")
```

#### å¼ é‡æ¦‚å¿µ

åœ¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä¸­ï¼Œ"å¼ é‡"ï¼ˆTensorï¼‰æ˜¯ä¸€ä¸ªå¤šç»´æ•°ç»„çš„é€šç”¨æœ¯è¯­ã€‚å®ƒæ˜¯æ•°æ®çš„åŸºæœ¬ç»“æ„ï¼Œç±»ä¼¼äºæ ‡é‡ã€å‘é‡å’ŒçŸ©é˜µï¼Œä½†å¯ä»¥æ‰©å±•

åˆ°æ›´é«˜çš„ç»´åº¦ã€‚

ä»¥ä¸‹æ˜¯å¼ é‡çš„ç®€å•è§£é‡Šï¼š

1. **æ ‡é‡ï¼ˆ0ç»´å¼ é‡ï¼‰**ï¼šä¸€ä¸ªå•ä¸€çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œ`3` æˆ– `-1.5`ã€‚
2. **å‘é‡ï¼ˆ1ç»´å¼ é‡ï¼‰**ï¼šä¸€ç»„æœ‰åºçš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œ`[1, 2, 3]`ã€‚
3. **çŸ©é˜µï¼ˆ2ç»´å¼ é‡ï¼‰**ï¼šä¸€ä¸ªäºŒç»´æ•°ç»„ã€‚ä¾‹å¦‚ï¼š

```plain
[[1, 2, 3],
 [4, 5, 6]]
```

1. **é«˜ç»´å¼ é‡ï¼ˆ3ç»´åŠä»¥ä¸Šï¼‰**ï¼šå¯ä»¥æƒ³è±¡æˆå¤šå±‚çš„çŸ©é˜µã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª3ç»´å¼ é‡å¯ä»¥æ˜¯ä¸€ä¸ªçŸ©é˜µçš„é›†åˆã€‚

åœ¨ä½ çš„ä»£ç ä¸­ï¼Œ`inputs` æ˜¯ä¸€ä¸ªå¼ é‡ï¼Œå®ƒæ˜¯é€šè¿‡åˆ†è¯å™¨å°†æ–‡æœ¬æ•°æ®è½¬æ¢ä¸ºæ¨¡å‹å¯ä»¥ç†è§£çš„æ ¼å¼ã€‚è¿™ä¸ªå¼ é‡é€šå¸¸æ˜¯ä¸€ä¸ªäºŒç»´çš„ï¼Œå½¢çŠ¶ä¸º 

`[batch_size, sequence_length]`ï¼Œå…¶ä¸­ `batch_size` æ˜¯æ‰¹å¤„ç†çš„æ ·æœ¬æ•°é‡ï¼Œ`sequence_length` æ˜¯æ¯ä¸ªæ ·æœ¬çš„æœ€å¤§é•¿åº¦ã€‚è¿™ä¸ªå¼ é‡

åŒ…å«äº†æ–‡æœ¬çš„æ•°å€¼åŒ–è¡¨ç¤ºï¼Œé€šå¸¸æ˜¯è¯æ±‡è¡¨ä¸­æ¯ä¸ªè¯çš„ç´¢å¼•ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¨¡å‹å¯ä»¥å¤„ç†æ–‡æœ¬æ•°æ®å¹¶è¿›è¡Œé¢„æµ‹ã€‚

#### [CLS] [SEP]æ ‡è®°ä½œç”¨

åœ¨ä¸€äº›è‡ªç„¶è¯­è¨€å¤„ç†æ¨¡å‹ï¼ˆå¦‚BERTï¼‰ä¸­ï¼Œç‰¹æ®Šæ ‡è®° `[CLS]` å’Œ `[SEP]` è¢«ç”¨æ¥å¸®åŠ©æ¨¡å‹ç†è§£è¾“å…¥çš„ç»“æ„å’Œä¸Šä¸‹æ–‡ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„ä½œç”¨å’Œç®€

å•è§£é‡Šï¼š

1. `[CLS]` **æ ‡è®°**ï¼š

[CLS] çš„è‹±æ–‡å…¨ç§°æ˜¯ "Classification"ã€‚åœ¨ä¸­æ–‡ä¸­ï¼Œå®ƒé€šå¸¸è¢«ç¿»è¯‘ä¸ºâ€œåˆ†ç±»â€ã€‚è¿™ä¸ªæ ‡è®°åœ¨æ¨¡å‹ä¸­ç”¨äºè¡¨ç¤ºæ•´ä¸ªè¾“å…¥åºåˆ—çš„èšåˆä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯

åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ã€‚

- **ä½œç”¨**ï¼š`[CLS]` æ ‡è®°é€šå¸¸æ”¾åœ¨è¾“å…¥åºåˆ—çš„å¼€å¤´ï¼Œç”¨äºè¡¨ç¤ºæ•´ä¸ªåºåˆ—çš„èšåˆä¿¡æ¯ã€‚å¯¹äºåˆ†ç±»ä»»åŠ¡ï¼Œæ¨¡å‹ä¼šä½¿ç”¨ä¸ `[CLS]` æ ‡è®°å¯¹åº”çš„è¾“å‡ºå‘é‡æ¥è¿›è¡Œæœ€ç»ˆçš„åˆ†ç±»ã€‚
- **ä¾‹å­**ï¼šå‡è®¾ä½ æœ‰ä¸€ä¸ªå¥å­ "I love NLP"ï¼Œåœ¨è¾“å…¥åˆ°æ¨¡å‹ä¹‹å‰ï¼Œåˆ†è¯å™¨ä¼šå°†å…¶è½¬æ¢ä¸º `["[CLS]", "I", "love", "NLP"]`ã€‚æ¨¡å‹ä¼šç‰¹åˆ«å…³æ³¨ `[CLS]` çš„è¾“å‡ºï¼Œå› ä¸ºå®ƒä»£è¡¨äº†æ•´ä¸ªå¥å­çš„è¯­ä¹‰ã€‚

1. `[SEP]` **æ ‡è®°**ï¼š

[SEP] çš„è‹±æ–‡å…¨ç§°æ˜¯ "Separator"ã€‚åœ¨ä¸­æ–‡ä¸­ï¼Œå®ƒé€šå¸¸è¢«ç¿»è¯‘ä¸ºâ€œåˆ†éš”ç¬¦â€ã€‚è¿™ä¸ªæ ‡è®°ç”¨äºåˆ†éš”ä¸åŒçš„å¥å­æˆ–æ®µè½ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£å¥å­ä¹‹é—´çš„

è¾¹ç•Œã€‚

- **ä½œç”¨**ï¼š`[SEP]` æ ‡è®°ç”¨äºåˆ†éš”ä¸åŒçš„å¥å­æˆ–æ®µè½ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£å¥å­ä¹‹é—´çš„è¾¹ç•Œã€‚åœ¨å¥å­å¯¹ä»»åŠ¡ï¼ˆå¦‚é—®ç­”æˆ–å¥å­å¯¹åˆ†ç±»ï¼‰ä¸­ï¼Œ`[SEP]` æ ‡è®°ç”¨äºåˆ†éš”ä¸¤ä¸ªå¥å­ã€‚
- **ä¾‹å­**ï¼šå¦‚æœä½ æœ‰ä¸¤ä¸ªå¥å­ "I love NLP" å’Œ "It is fascinating"ï¼Œåœ¨è¾“å…¥åˆ°æ¨¡å‹ä¹‹å‰ï¼Œåˆ†è¯å™¨ä¼šå°†å…¶è½¬æ¢ä¸º `["[CLS]", "I", "love", "NLP", "[SEP]", "It", "is", "fascinating", "[SEP]"]`ã€‚è¿™æ ·ï¼Œæ¨¡å‹å°±èƒ½è¯†åˆ«å‡ºä¸¤ä¸ªå¥å­ä¹‹é—´çš„åˆ†ç•Œã€‚

é€šè¿‡ä½¿ç”¨è¿™äº›ç‰¹æ®Šæ ‡è®°ï¼Œæ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°ç†è§£è¾“å…¥çš„ç»“æ„å’Œä¸Šä¸‹æ–‡ï¼Œä»è€Œæé«˜å¤„ç†å’Œé¢„æµ‹çš„å‡†ç¡®æ€§ã€‚

## ä¸‰ã€Hugging Face åº”ç”¨å®æˆ˜

è¯¥åº”ç”¨å®æˆ˜æ˜¯é€šè¿‡ Hugging Face Transformers å®Œæˆä¸€ä¸ªå¾ˆç®€å•çš„æ–‡æœ¬åˆ†ç±»ä»»åŠ¡ï¼ˆé¢„æµ‹å½±è¯„æ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢ï¼‰ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```python
# 1. å¯¼å…¥å¿…è¦çš„åº“
from transformers import AutoTokenizer, AutoModelForSequenceClassification
from datasets import load_dataset

# 2. å®šä¹‰æ•°æ®é›†åç§°å’Œä»»åŠ¡ç±»å‹ï¼šä½¿ç”¨çš„æ˜¯ imdb å½±è¯„æ•°æ®é›†
dataset_name = "imdb"
task = "sentiment-analysis"

# 3. ä¸‹è½½æ•°æ®é›†å¹¶æ‰“ä¹±æ•°æ®
dataset = load_dataset(dataset_name)
dataset = dataset.shuffle()

# 4. åˆå§‹åŒ–åˆ†è¯å™¨å’Œæ¨¡å‹
model_name = "bert-base-cased"
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForSequenceClassification.from_pretrained(model_name, num_labels=2)

# 5. å°†æ–‡æœ¬ç¼–ç ä¸ºæ¨¡å‹æœŸæœ›çš„å¼ é‡æ ¼å¼
inputs = tokenizer(dataset["train"]["text"][:10], padding=True, truncation=True, return_tensors="pt")

# 6. å°†ç¼–ç åçš„å¼ é‡è¾“å…¥æ¨¡å‹è¿›è¡Œé¢„æµ‹
outputs = model(**inputs)

# 7. è·å–é¢„æµ‹ç»“æœå’Œæ ‡ç­¾
predictions = outputs.logits.argmax(dim=-1)
labels = dataset["train"]["label"][:10]

# 8. æ‰“å°é¢„æµ‹ç»“æœå’Œæ ‡ç­¾
for i, (prediction, label) in enumerate(zip(predictions, labels)):
    prediction_label = "æ­£é¢è¯„è®º" if prediction == 1 else "è´Ÿé¢è¯„è®º"
    true_label = "æ­£é¢è¯„è®º" if label == 1 else "è´Ÿé¢è¯„è®º"
    print(f"Example {i+1}: Prediction: {prediction_label}, True label: {true_label}")
```

æ³¨æ„ï¼šè¦è¿è¡Œä»£ç ï¼Œéœ€è¦å®‰è£…æœ€æ–°çš„ pytorch ã€transformers å’Œ datasetsã€‚

å°†ä»£ç æ–‡ä»¶ä¿å­˜ä¸ºï¼šhuggingface.pyï¼Œè¿è¡Œåç»“æœå¦‚ä¸‹ï¼ˆç¬¬ä¸€æ¬¡è¿è¡Œéœ€è¦ä» Hugging Face ä¸Šä¸‹è½½æ•°æ®é›†å’Œæ¨¡å‹ï¼Œéœ€è¦ä¸€ç‚¹æ—¶é—´ï¼‰ï¼š

```plain
C:\Users\Lenovo\anaconda3\envs\pytorch211\python.exe "huggingface.py"
Downloading readme: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7.81k/7.81k [00:00<?, ?B/s]
Downloading data: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 21.0M/21.0M [00:27<00:00, 753kB/s]
Downloading data: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 20.5M/20.5M [00:07<00:00, 2.88MB/s]
Downloading data: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 42.0M/42.0M [00:08<00:00, 5.13MB/s]
Generating train split: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 25000/25000 [00:00<00:00, 347815.24 examples/s]
Generating test split: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 25000/25000 [00:00<00:00, 481791.57 examples/s]
Generating unsupervised split: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 50000/50000 [00:00<00:00, 450755.18 examples/s]
C:\Users\Lenovo\anaconda3\envs\pytorch211\Lib\site-packages\huggingface_hub\file_download.py:149: UserWarning: `huggingface_hub` cache-system uses symlinks by default to efficiently store duplicated files but your machine does not support them in C:\Users\Lenovo\.cache\huggingface\hub\models--bert-base-cased. Caching files will still work but in a degraded version that might require more space on your disk. This warning can be disabled by setting the `HF_HUB_DISABLE_SYMLINKS_WARNING` environment variable. For more details, see https://huggingface.co/docs/huggingface_hub/how-to-cache#limitations.
To support symlinks on Windows, you either need to activate Developer Mode or to run Python as an administrator. In order to see activate developer mode, see this article: https://docs.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development
  warnings.warn(message)
Some weights of BertForSequenceClassification were not initialized from the model checkpoint at bert-base-cased and are newly initialized: ['classifier.bias', 'classifier.weight']
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Example 1: Prediction: æ­£é¢è¯„è®º, True label: æ­£é¢è¯„è®º
Example 2: Prediction: æ­£é¢è¯„è®º, True label: æ­£é¢è¯„è®º
Example 3: Prediction: æ­£é¢è¯„è®º, True label: è´Ÿé¢è¯„è®º
Example 4: Prediction: æ­£é¢è¯„è®º, True label: æ­£é¢è¯„è®º
Example 5: Prediction: æ­£é¢è¯„è®º, True label: æ­£é¢è¯„è®º
Example 6: Prediction: æ­£é¢è¯„è®º, True label: æ­£é¢è¯„è®º
Example 7: Prediction: æ­£é¢è¯„è®º, True label: è´Ÿé¢è¯„è®º
Example 8: Prediction: æ­£é¢è¯„è®º, True label: è´Ÿé¢è¯„è®º
Example 9: Prediction: æ­£é¢è¯„è®º, True label: è´Ÿé¢è¯„è®º
Example 10: Prediction: æ­£é¢è¯„è®º, True label: è´Ÿé¢è¯„è®º

Process finished with exit code 0
```

è¯¥å®æˆ˜ä¸»è¦æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ HuggingFaceï¼Œé¢„æµ‹ç»“æœå¹¶ä¸æ˜¯é‚£ä¹ˆå‡†ç¡®ï¼ˆå‡†ç¡®ç‡ 50%ï¼‰ï¼Œå› ä¸ºæ¨¡å‹æœ¬èº«è¿˜æœªåšè¿‡ç”µå½±è¯„è®ºç›¸å…³çš„å¾®è°ƒã€‚

Hugging Face ä¹Ÿæé†’æˆ‘ä»¬ï¼Œå¯èƒ½éœ€è¦ç”¨ä¸€äº›ä¸‹æ¸¸ä»»åŠ¡é‡æ–°è®­ç»ƒè¿™ä¸ªæ¨¡å‹ï¼ˆå³å¾®è°ƒï¼‰ï¼Œå†ç”¨å®ƒæ¥åšé¢„æµ‹å’Œæ¨ç†ï¼šYou should probably 

TRAIN this model on a down-stream task to be able to use it for predictions and inferenceã€‚

## å››ã€æ€»ç»“

Hugging Face æ˜¯å½“å‰æœ€çŸ¥åçš„ Transformer å·¥å…·åº“å’Œ AI å¼€æºæ¨¡å‹ç½‘ç«™ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è®©äººä»¬æ›´æ–¹ä¾¿åœ°ä½¿ç”¨å’Œå¼€å‘ AI æ¨¡å‹ã€‚

1. ä»€ä¹ˆæ˜¯ Hugging Faceï¼Ÿå®ƒçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ

- Hugging Face Hugging Face æ˜¯ä¸€ä¸ª AI ç¤¾åŒºç½‘ç«™ï¼Œç«™å†…å‡ ä¹å›Šæ‹¬äº†æ‰€æœ‰çš„ AI å¼€æºæ¨¡å‹ã€‚Hugging Face æ˜¯å½“å‰æœ€çŸ¥åçš„ 

  Transformer å·¥å…·åº“å’Œ AI å¼€æºæ¨¡å‹ç½‘ç«™ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è®©äººä»¬æ›´æ–¹ä¾¿åœ°ä½¿ç”¨å’Œå¼€å‘ AI æ¨¡å‹ã€‚

1. Hugging Face ä¸­åŒ…å«å“ªäº›çŸ¥åçš„é¢„è®­ç»ƒæ¨¡å‹?

- å¦‚ BERTã€GPTã€XLNetã€RoBERTa

1. å¦‚æœæˆ‘è¦åœ¨ Hugging Face ä¸­ä¸‹è½½ BERTï¼Œé‚£ä¹ˆ

- åªæœ‰ä¸€ç§ç‰ˆæœ¬ï¼Œè¿˜æ˜¯æœ‰å¤šç§ç‰ˆæœ¬å¯ä»¥é€‰æ‹©ï¼Ÿ

- å¤šç‰ˆæœ¬

- æ¯ä¸€ç§ç‰ˆæœ¬çš„ BERT ä¸­ï¼Œåªæœ‰ä¸€ç§æ ¼å¼è¿˜æ˜¯æœ‰å¤šç§æ ¼å¼å¯ä»¥é€‚åº”å¤šç§ä¸‹æ¸¸ä»»åŠ¡ï¼Ÿ

- å¤šç§æ ¼å¼

1. Hugging Face åº“ä¸­æœ‰å“ªäº›æœ‰ç”¨çš„ç»„ä»¶ï¼Ÿ

- æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼šTransformersã€Datasetã€Tokenizerï¼Œæ­¤å¤–è¿˜æœ‰ä¸€äº›è¾…åŠ©å·¥å…·ï¼Œå¦‚ Accelerate ç­‰
